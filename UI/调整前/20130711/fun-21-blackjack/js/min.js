(function(e){function t(){}if(!Object.defineProperty)throw"Font.js requires Object.defineProperty, which this browser does not support.";if(!document.createElement("canvas").getContext)throw"Font.js requires <canvas> and the Canvas2D API, which this browser does not support.";(function(e){function r(e,t){return this.slice(e,t)}function i(e,t){var n,r=e.length;arguments.length<2&&(t=0);for(n=0;n<r;++n,++t)this[t]=e[n]&255}function s(e){var t,n;if(typeof e=="number"){t=new Array(e);for(n=0;n<e;++n)t[n]=0}else t=e.slice(0);return t.subarray=r,t.buffer=t,t.byteLength=t.length,t.set=i,typeof e=="object"&&e.buffer&&(t.buffer=e.buffer),t}try{var t=new Uint8Array(1);return}catch(n){}e.Uint8Array=s,e.Uint32Array=s,e.Int32Array=s})(e),function(e){if(e.opera)return;if("response"in XMLHttpRequest.prototype||"mozResponseArrayBuffer"in XMLHttpRequest.prototype||"mozResponse"in XMLHttpRequest.prototype||"responseArrayBuffer"in XMLHttpRequest.prototype)return;var t;e.VBArray?t=function(){return new Uint8Array((new VBArray(this.responseBody)).toArray())}:t=function(){this.responseBody},Object.defineProperty(XMLHttpRequest.prototype,"response",{get:t})}(e),e.btoa||(e.btoa=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n,r,i,s,o,u,a,f,l=0,c=0,h="",p=[];if(!e)return e;do n=e.charCodeAt(l++),r=e.charCodeAt(l++),i=e.charCodeAt(l++),f=n<<16|r<<8|i,s=f>>18&63,o=f>>12&63,u=f>>6&63,a=f&63,p[c++]=t.charAt(s)+t.charAt(o)+t.charAt(u)+t.charAt(a);while(l<e.length);h=p.join("");var d=e.length%3;return(d?h.slice(0,d-3):h)+"===".slice(d||3)}),t.prototype.fontFamily="fjs"+(999999*Math.random()|0),t.prototype.url="",t.prototype.format="",t.prototype.data="",t.prototype.base64="AAEAAAAKAIAAAwAgT1MvMgAAAAAAAACsAAAAWGNtYXAAAAAAAAABBAAAACxnbHlmAAAAAAAAATAAAAAQaGVhZAAAAAAAAAFAAAAAOGhoZWEAAAAAAAABeAAAACRobXR4AAAAAAAAAZwAAAAIbG9jYQAAAAAAAAGkAAAACG1heHAAAAAAAAABrAAAACBuYW1lAAAAAAAAAcwAAAAgcG9zdAAAAAAAAAHsAAAAEAAEAAEAZAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAABAAMAAQAAAAwABAAgAAAABAAEAAEAAABB//8AAABB////wAABAAAAAAABAAAAAAAAAAAAAAAAMQAAAQAAAAAAAAAAAABfDzz1AAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAEAAgAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAIAAAAAQAAAAIAAQABAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAIAHgADAAEECQABAAAAAAADAAEECQACAAIAAAAAAAEAAAAAAAAAAAAAAAAAAA==",t.prototype.metrics={quadsize:0,leading:0,ascent:0,descent:0,weightclass:400},t.prototype.systemfont=!1,t.prototype.loaded=!1,t.prototype.onload=function(){},t.prototype.onerror=function(){},t.prototype.canvas=!1,t.prototype.context=!1,t.prototype.validate=function(e,t,n,r,i){if(i!==!1&&i<0){this.onerror("Requested system font '"+this.fontFamily+"' could not be loaded (it may not be installed).");return}var s=document.defaultView.getComputedStyle(e,""),o=s.getPropertyValue("width").replace("px","");o>0?(document.head.removeChild(t),document.body.removeChild(e),this.loaded=!0,this.onload()):setTimeout(function(){r.validate(e,t,n,r,i===!1?!1:i-50)},50)},t.prototype.ondownloaded=function(){var e=function(e){return String.fromCharCode(e)},t=function(t){if(t<256)return e(0)+e(t);var n=t>>8,r=t&255;return e(n)+e(r)},n=function(e){return e<0&&(e=4294967295+e+1),parseInt(e,10).toString(16)},r=function(e,t){return 256*e+t},i=function(e,t){var n=e>>7===1,r;return e&=127,r=256*e+t,n?r-32768:r},s=function(e,t,n,r){return 16777216*e+65536*t+256*n+r},o=function(e){},u=e(0)+e(1)+e(0)+e(0),a="OTTO",f=this.data,l=e(f[0])+e(f[1])+e(f[2])+e(f[3]),c=l===u,h=c?!1:l===a;if(c)this.format="truetype";else{if(!h){o("Error: file at "+this.url+" cannot be interpreted as OpenType font.");return}this.format="opentype"}var p=r(f[4],f[5]),d=12,v,m=d+16*p,g={},y;for(v=d;v<m;v+=16)y=e(f[v])+e(f[v+1])+e(f[v+2])+e(f[v+3]),g[y]={name:y,checksum:s(f[v+4],f[v+5],f[v+6],f[v+7]),offset:s(f[v+8],f[v+9],f[v+10],f[v+11]),length:s(f[v+12],f[v+13],f[v+14],f[v+15])};var b=function(e){return g[e]?e:(o("Error: font is missing the required OpenType '"+e+"' table."),!1)};y=b("head");if(y===!1)return;v=g[y].offset,g[y].version=""+f[v]+f[v+1]+f[v+2]+f[v+3];var w=r(f[v+18],f[v+19]);this.metrics.quadsize=w,y=b("hhea");if(y===!1)return;v=g[y].offset,g[y].version=""+f[v]+f[v+1]+f[v+2]+f[v+3],this.metrics.ascent=i(f[v+4],f[v+5])/w,this.metrics.descent=i(f[v+6],f[v+7])/w,this.metrics.leading=i(f[v+8],f[v+9])/w,y=b("OS/2");if(y===!1)return;v=g[y].offset,g[y].version=""+f[v]+f[v+1],this.metrics.weightclass=r(f[v+4],f[v+5]),y=b("cmap");if(y===!1)return;v=g[y].offset,g[y].version=""+f[v]+f[v+1],p=r(f[v+2],f[v+3]);var E,S,x,T,N,C=!1;for(var E=0;E<p;E++)S=v+4+E*8,x=r(f[S],f[S+1]),T=r(f[S+2],f[S+3]),N=s(f[S+4],f[S+5],f[S+6],f[S+7]),x===3&&T===1&&(C=N);var k="A";if(C!==!1){v+=C,l=r(f[v],f[v+1]);if(l===4){var L=r(f[v+6],f[v+7])/2,A=function(e){return[9,10,11,12,13,32,133,160,5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8232,8233,8239,8287,12288].indexOf(e)===-1},O=v+14,M=v+14+2*L,_=!1;for(;O<M;O+=2){_=r(f[O],f[O+1]);if(A(_))break;_=!1}if(_!==!1){k=String.fromCharCode(_);var D=-(_-1)+65536,P=btoa(e(0)+t(_)+t(65535)+t(0)+t(_)+t(65535)+t(D)+t(1));this.base64=this.base64.substring(0,380)+P+this.base64.substring(380+P.length)}}}this.bootstrapValidation(k,!1)},t.prototype.bootstrapValidation=function(e,t){var n=this.fontFamily+" testfont",r=document.createElement("style");r.setAttribute("type","text/css"),r.innerHTML="@font-face {\n  font-family: '"+n+"';\n"+"  src: url('data:application/x-font-ttf;base64,"+this.base64+"')\n"+"       format('truetype');}",document.head.appendChild(r);var i=!1;this.systemfont||(i=this.toStyleNode(),document.head.appendChild(i));var s=document.createElement("p");s.style.cssText="position: absolute; top: 0; left: 0; opacity: 0;",s.style.fontFamily="'"+this.fontFamily+"', '"+n+"'",s.innerHTML=e+e+e+e+e+e+e+e+e+e,document.body.appendChild(s);if(!document.defaultView.getComputedStyle)this.onload(),error("Error: document.defaultView.getComputedStyle is not supported by this browser.\nConsequently, Font.onload() cannot be trusted.");else{var o=this.systemfont?1e3:this.metrics.quadsize,u=document.createElement("canvas");u.width=o,u.height=o,this.canvas=u;var a=u.getContext("2d");a.font="1em '"+this.fontFamily+"'",a.fillStyle="white",a.fillRect(-1,-1,o+2,o+2),a.fillStyle="black",a.fillText("test text",50,o/2),this.context=a;var f=this,l=function(){f.validate(s,r,i,f,t)};setTimeout(l,50)}},t.prototype.processSystemFont=function(){this.systemfont=!0,this.metrics=!1,this.bootstrapValidation("A",1e3)},t.prototype.loadFont=function(){var e=this;if(this.url.indexOf(".")===-1){setTimeout(function(){e.processSystemFont()},10);return}var t=new XMLHttpRequest;t.open("GET",e.url,!0),t.responseType="arraybuffer",t.onload=function(n){var r=t.response;r?(e.data=new Uint8Array(r),e.ondownloaded()):e.onerror("Error downloading font resource from "+e.url)},t.send(null)},t.prototype.styleNode=!1,t.prototype.toStyleNode=function(){if(this.styleNode)return this.styleNode;this.styleNode=document.createElement("style"),this.styleNode.type="text/css";var e="@font-face {\n";return e+="  font-family: '"+this.fontFamily+"';\n",e+="  src: url('"+this.url+"') format('"+this.format+"');\n",e+="}",this.styleNode.innerHTML=e,this.styleNode},t.prototype.measureText=function(e,t){if(!this.loaded)return error("measureText() was called while the font was not yet loaded"),!1;this.context.font=t+"px '"+this.fontFamily+"'";var n=this.context.measureText(e);n.fontsize=t,n.ascent=0,n.descent=0,n.bounds={minx:0,maxx:n.width,miny:0,maxy:0},n.height=0;var r=[],i=n.width/this.metrics.quadsize;i<=1?r.push(e):r.push(e);var s=r.length,o;for(o=0;o<s;o++)this.measureSegment(r[o],t,n);return n},t.prototype.measureSegment=function(e,t,n){var r=function(e,t){return document.defaultView.getComputedStyle(e,null).getPropertyValue(t)},i,s=document.createElement("div");s.style.position="absolute",s.style.opacity=0,s.style.font=t+"px '"+this.fontFamily+"'";var o=10;s.innerHTML=e;for(i=1;i<o;i++)s.innerHTML+="<br/>"+e;document.body.appendChild(s),n.leading=1.2*t;var u=r(s,"height");u=u.replace("px",""),u>=t*o&&(n.leading=u/o|0),document.body.removeChild(s);if(/^\s*$/.test(e))return n;var a=this.canvas,f=this.context,l=this.systemfont?1e3:this.metrics.quadsize,c=l,h=l,p=l/2,d=50,v=(l-n.width)/2;v!==(v|0)&&(v|=0),f.fillStyle="white",f.fillRect(-d,-d,c+2*d,h+2*d),f.fillStyle="black",f.fillText(e,v,p);var m=n.width+d|0,g=4*t,y=v-d/2,b=p-g/2,w=f.getImageData(y,b,m,g).data,i=0,E=0,S=m*4,x=w.length,T=g/2;while(++i<x&&w[i]===255);var N=i/S|0;i=x-1;while(--i>0&&w[i]===255);var C=i/S|0;for(i=0,E=0;E<m&&w[i]===255;)i+=S,i>=x&&(E++,i=i-x+4);var k=E,L=1;for(i=x-3,E=0;E<m&&w[i]===255;)i-=S,i<0&&(E++,i=x-3-L++*4);var A=m-E;return n.ascent=T-N,n.descent=C-T,n.bounds={minx:k-d/2,maxx:A-d/2,miny:-n.descent,maxy:n.ascent},n.height=1+(C-N),n},Object.defineProperty(t.prototype,"src",{set:function(e){this.url=e,this.loadFont()}}),e.Font=t})(window);var viewporter;(function(){var e;viewporter={forceDetection:!1,preventPageScroll:!1,ACTIVE:function(){return/ipad/i.test(navigator.userAgent)?!1:/webos/i.test(navigator.userAgent)?!0:"ontouchstart"in window?!0:!1}(),READY:!1,isLandscape:function(){return window.orientation===90||window.orientation===-90},ready:function(e){window.addEventListener("viewportready",e,!1)},change:function(e){window.addEventListener("viewportchange",e,!1)},refresh:function(){e&&e.prepareVisualViewport()}};if(!viewporter.ACTIVE)return;var t=function(){var e=this;this.IS_ANDROID=/Android/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent);var t=function(){e.prepareVisualViewport();var t=window.orientation;window.addEventListener("orientationchange",function(){window.orientation!==t&&(e.prepareVisualViewport(),t=window.orientation)},!1),document.body.addEventListener("touchmove",function(e){viewporter.preventPageScroll&&e.preventDefault()},!1),document.body.addEventListener("touchstart",function(){viewporter.preventPageScroll&&e.prepareVisualViewport()},!1)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",function(){t()},!1):t()};t.prototype={getProfile:function(){if(viewporter.forceDetection)return null;for(var e in viewporter.profiles)if((new RegExp(e)).test(navigator.userAgent))return viewporter.profiles[e];return null},postProcess:function(){viewporter.READY=!0,this.triggerWindowEvent(this._firstUpdateExecuted?"viewportchange":"viewportready"),this._firstUpdateExecuted=!0},prepareVisualViewport:function(){var e=this;if(navigator.standalone)return this.postProcess();document.documentElement.style.minHeight="5000px";var t=window.innerHeight,n=this.getProfile(),r=viewporter.isLandscape()?"landscape":"portrait";window.scrollTo(0,e.IS_ANDROID?1:0);var i=40,s=window.setInterval(function(){function o(){return n?window.innerHeight===n[r]:!1}function u(){return window.innerHeight>t}window.scrollTo(0,e.IS_ANDROID?1:0),i--;if((e.IS_ANDROID?o():u())||i<0)document.documentElement.style.minHeight=window.innerHeight+"px",document.getElementById("viewporter").style.position="relative",document.getElementById("viewporter").style.height=window.innerHeight+"px",clearInterval(s),e.postProcess()},10)},triggerWindowEvent:function(e){var t=document.createEvent("Event");t.initEvent(e,!1,!1),window.dispatchEvent(t)}},e=new t})(),viewporter.profiles={MZ601:{portrait:696,landscape:1176},"GT-I9000|GT-I9100|Nexus S":{portrait:508,landscape:295},"GT-P1000":{portrait:657,landscape:400},"Desire_A8181|DesireHD_A9191":{portrait:533,landscape:320}};function PxLoader(e){e=e||{},e.statusInterval==null&&(e.statusInterval=5e3),e.loggingDelay==null&&(e.loggingDelay=2e4),e.noProgressTimeout==null&&(e.noProgressTimeout=Infinity);var t=[],n=[],r,i=+(new Date),s={QUEUED:0,WAITING:1,LOADED:2,ERROR:3,TIMEOUT:4},o=function(e){return e==null?[]:Array.isArray(e)?e:[e]};this.add=function(e){e.tags=new PxLoaderTags(e.tags),e.priority==null&&(e.priority=Infinity),t.push({resource:e,state:s.QUEUED})},this.addProgressListener=function(e,t){n.push({callback:e,tags:new PxLoaderTags(t)})},this.addCompletionListener=function(e,t){n.push({tags:new PxLoaderTags(t),callback:function(t){t.completedCount===t.totalCount&&e()}})};var u=function(e){e=o(e);var t=function(t){var n=t.resource,r=Infinity;for(var i=0;i<n.tags.length;i++)for(var s=0;s<Math.min(e.length,r);s++){if(n.tags[i]==e[s]&&s<r){r=s;if(r===0)break}if(r===0)break}return r};return function(e,n){var r=t(e),i=t(n);return r<i?-1:r>i?1:e.priority<n.priority?-1:e.priority>n.priority?1:0}};this.start=function(e){r=+(new Date);var n=u(e);t.sort(n);for(var i=0,o=t.length;i<o;i++){var f=t[i];f.status=s.WAITING,f.resource.start(this)}setTimeout(a,100)};var a=function(){var n=!1,r=+(new Date)-i,o=r>=e.noProgressTimeout,u=r>=e.loggingDelay;for(var f=0,l=t.length;f<l;f++){var h=t[f];if(h.status!==s.WAITING)continue;h.resource.checkStatus(),h.status===s.WAITING&&(o?h.resource.onTimeout():n=!0)}u&&n&&c(),n&&setTimeout(a,e.statusInterval)};this.isBusy=function(){for(var e=0,n=t.length;e<n;e++)if(t[e].status===s.QUEUED||t[e].status===s.WAITING)return!0;return!1};var f=function(e,r){var o=null;for(var u=0,a=t.length;u<a;u++)if(t[u].resource===e){o=t[u];break}if(o==null||o.status!==s.WAITING)return;o.status=r,i=+(new Date);var f=e.tags.length;for(var u=0,c=n.length;u<c;u++){var h=n[u],p;h.tags.length===0?p=!0:p=e.tags.contains(h.tags),p&&l(o,h)}};this.onLoad=function(e){f(e,s.LOADED)},this.onError=function(e){f(e,s.ERROR)},this.onTimeout=function(e){f(e,s.TIMEOUT)};var l=function(e,n){var r=0,i=0;for(var o=0,u=t.length;o<u;o++){var a=t[o],f=!1;n.tags.length===0?f=!0:f=a.resource.tags.contains(n.tags),f&&(i++,(a.status===s.LOADED||a.status===s.ERROR||a.status===s.TIMEOUT)&&r++)}n.callback({resource:e.resource,loaded:e.status===s.LOADED,error:e.status===s.ERROR,timeout:e.status===s.TIMEOUT,completedCount:r,totalCount:i})},c=this.log=function(e){if(!window.console)return;var n=Math.round((+(new Date)-r)/1e3);window.console.log("PxLoader elapsed: "+n+" sec");for(var i=0,o=t.length;i<o;i++){var u=t[i];if(!e&&u.status!==s.WAITING)continue;var a="PxLoader: #"+i+" "+u.resource.getName();switch(u.status){case s.QUEUED:a+=" (Not Started)";break;case s.WAITING:a+=" (Waiting)";break;case s.LOADED:a+=" (Loaded)";break;case s.ERROR:a+=" (Error)";break;case s.TIMEOUT:a+=" (Timeout)"}u.resource.tags.length>0&&(a+=" Tags: ["+u.resource.tags.join(",")+"]"),window.console.log(a)}}}function PxLoaderTags(e){this.array=[],this.object={},this.value=null,this.length=0;if(e!==null&&e!==undefined){if(Array.isArray(e))this.array=e;else if(typeof e=="object")for(var t in e)this.array.push(t);else this.array.push(e),this.value=e;this.length=this.array.length;for(var n=0;n<this.length;n++)this.object[this.array[n]]=!0}this.contains=function(e){if(this.length===0||e.length===0)return!1;if(this.length===1)return e.length===1?this.value===e.value:e.object.hasOwnProperty(this.value);if(e.length<this.length)return e.contains(this);for(var t in this.object)if(e.object[t])return!0;return!1}}Array.isArray||(Array.isArray=function(e){return Object.prototype.toString.call(e)=="[object Array]"});function PxLoaderImage(e,t,n){var r=this,i=null;this.img=new Image,this.tags=t,this.priority=n;var s=function(){r.img.readyState=="complete"&&(a(),i.onLoad(r))},o=function(){a(),i.onLoad(r)},u=function(){a(),i.onError(r)},a=function(){r.unbind("load",o),r.unbind("readystatechange",s),r.unbind("error",u)};this.start=function(t){i=t,r.bind("load",o),r.bind("readystatechange",s),r.bind("error",u),r.img.src=e},this.checkStatus=function(){r.img.complete&&(a(),i.onLoad(r))},this.onTimeout=function(){a(),r.img.complete?i.onLoad(r):i.onTimeout(r)},this.getName=function(){return e},this.bind=function(e,t){r.img.addEventListener?r.img.addEventListener(e,t,!1):r.img.attachEvent&&r.img.attachEvent("on"+e,t)},this.unbind=function(e,t){r.img.removeEventListener?r.img.removeEventListener(e,t,!1):r.img.detachEvent&&r.img.detachEvent("on"+e,t)}}PxLoader.prototype.addImage=function(e,t,n){var r=new PxLoaderImage(e,t,n);return this.add(r),r.img};function extend(e,t){var n=e.prototype,r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.superclass=t.prototype,t.prototype.constructor===Object.prototype.constructor&&(t.prototype.constructor=t);for(var i in n)n.hasOwnProperty(i)&&(e.prototype[i]=n[i])}function getElementPosition(e){var t=e,n="",r=0,i=0;if(t==null)return null;while(typeof t=="object"&&typeof t.tagName!="undefined"){i+=t.offsetTop,r+=t.offsetLeft,n=t.tagName.toUpperCase(),n=="BODY"&&(t=0),typeof t=="object"&&typeof t.offsetParent=="object"&&(t=t.offsetParent);if(t==null)return null}return{x:r,y:i}}function getQueryString(){var e={},t=location.search.substring(1),n=/([^&=]+)=([^&]*)/g,r;while(r=n.exec(t))e[decodeURIComponent(r[1])]=decodeURIComponent(r[2]);return e}function getDistributionPartner(){var e=getQueryString().dst;return typeof e=="string"?e:null}function loadScript(e,t){var n=document.getElementsByTagName("head")[0],r=document.createElement("script");r.type="text/javascript",r.src=e,r.onreadystatechange=t,r.onload=t,n.appendChild(r)}function FriendsterSocialLeaderBoard(){return this.config={SERVER_URL:"http://prod.tresensa.com:8585",ErrorHandler:null},this.loginDetails=[{social_network:"friendster",id:""}],this.userConfiguration={SERVER_URL:this.config.SERVER_URL,APP_URL:this.config.APP_URL,APP_KEY:this.config.APP_KEY,APP_ID:this.config.APP_ID,GameCode:this.config.GameCode,ErrorHandler:this.config.ErrorHandler,SocialNetwork:String(this.config.SocialNetwork).toLowerCase()},this}var TGE=TGE||{};TGE.log=function(){window.console&&window.console.log(Array.prototype.slice.call(arguments))},TGE.debugLog=function(){},Function.prototype.bind||(Function.prototype.bind=function(e){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i}),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),TGE.BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"an unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.platform=this.searchString(this.dataPlatform)||"an unknown OS or Device",this.OSversion=this.detectOSversion(this.platform),this.isMobileDevice=this.platform!=="Windows"&&this.platform!=="Mac"&&this.platform!=="Linux",this.oniOS=this.platform==="iPhone"||this.platform==="iPad",this.onAndroid=this.platform==="Android",this.usingPhoneGap=window.PhoneGap||window.cordova||window.Cordova},detectOSversion:function(e){var t="-1",n="",r=navigator.userAgent.toString();switch(e){case"Windows Phone":n=/Windows Phone OS\s+[\d\.]+/,t=String(r.match(n)).substring(17,20);break;case"iPhone":case"iPad":n=/OS\s+[\d\_]+/,t=String(r.match(n)).substring(3,6);break;case"Windows":n=/Windows NT\s+[\d\.]+/;var i=String(r.match(n)).substring(11,14);i=="6.1"?t="7":i=="5.1"?t="XP":i=="5.2"?t="XP":i=="6.0"?t="Vista":i=="5.01"?t="2000 SP1":i=="5.0"&&(t="2000");break;case"Mac":n=/Mac OS X\s+[\d\_]+/,t=String(r.match(n)).substring(9,13);break;case"Android":n=/ndroid\s+[\d\.]+/,t=String(r.match(n)).substring(7,10)}return t},searchString:function(e){for(var t=0;t<e.length;t++)if(e[t]!=null){var n=e[t].string,r=e[t].prop;this.versionSearchString=e[t].versionSearch||e[t].identity;if(n){if(n.indexOf(e[t].subString)!==-1)return e[t].identity}else if(r)return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(t===-1)return;return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Explorer",identity:"Explorer",versionSearch:"Explorer"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{prop:window.opera,identity:"Opera"},{string:navigator.userAgent,subString:"Silk",identity:"Silk",versionSearch:"Silk"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.vendor,subString:"BlackBerry",identity:"BlackBerry"}],dataPlatform:[{string:navigator.userAgent,subString:"Windows Phone",identity:"Windows Phone"},{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone"},{string:navigator.userAgent,subString:"iPad",identity:"iPad"},{string:navigator.userAgent,subString:"iPod",identity:"iPod"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.userAgent,subString:"Silk",identity:"Kindle Fire"},{string:navigator.userAgent,subString:"webOS",identity:"webOS"},{string:navigator.userAgent,subString:"Mobile",identity:"Mobile"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]},TGE.BrowserDetect.init();if(TGE.BrowserDetect.platform==="iPhone"||TGE.BrowserDetect.platform==="iPad"){var _vp=document.querySelector("meta[name=viewport]");_vp&&_vp.setAttribute("content","maximum-scale=1, minimum-scale=1, initial-scale=1, user-scalable=no")}TGE.Matrix=function(e,t,n,r,i,s){e=typeof e!="undefined"?e:1,t=typeof t!="undefined"?t:0,n=typeof n!="undefined"?n:0,r=typeof r!="undefined"?r:1,i=typeof i!="undefined"?i:0,s=typeof s!="undefined"?s:0,this._internal=[e,n,i,t,r,s,0,0,1]},TGE.Matrix.RotationMatrix=function(e){var t=new TGE.Matrix;return t._internal[0]=Math.cos(e),t._internal[1]=-Math.sin(e),t._internal[3]=Math.sin(e),t._internal[4]=Math.cos(e),t},TGE.Matrix.ScaleMatrix=function(e,t){return(new TGE.Matrix).scale(e,t)},TGE.Matrix.TranslationMatrix=function(e,t){return(new TGE.Matrix).translate(e,t)},TGE.Matrix.prototype={_internal:null,identity:function(){var e=this._internal;return e[1]=e[2]=e[3]=e[5]=e[6]=e[7]=0,e[0]=e[4]=e[8]=1,this},copyFrom:function(e){var t=this._internal,n=e._internal;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this},concat:function(e){var t=this._internal,n=e._internal,r=t[0]*n[0]+t[1]*n[3]+t[2]*n[6],i=t[0]*n[1]+t[1]*n[4]+t[2]*n[7],s=t[0]*n[2]+t[1]*n[5]+t[2]*n[8],o=t[3]*n[0]+t[4]*n[3]+t[5]*n[6],u=t[3]*n[1]+t[4]*n[4]+t[5]*n[7],a=t[3]*n[2]+t[4]*n[5]+t[5]*n[8],f=t[6]*n[0]+t[7]*n[3]+t[8]*n[6],l=t[6]*n[1]+t[7]*n[4]+t[8]*n[7],c=t[6]*n[2]+t[7]*n[5]+t[8]*n[8];return t[0]=r,t[1]=i,t[2]=s,t[3]=o,t[4]=u,t[5]=a,t[6]=f,t[7]=l,t[8]=c,this},rotate:function(e){return this.concat(TGE.Matrix.RotationMatrix(e*TGE.DEG2RAD))},scale:function(e,t){var n=this._internal;return n[0]*=e,n[1]*=t,n[3]*=e,n[4]*=t,this},translate:function(e,t){return this._internal[2]+=e,this._internal[5]+=t,this},transformPoint:function(e){var t=e.x,n=e.y;return e.x=t*this._internal[0]+n*this._internal[1]+this._internal[2],e.y=t*this._internal[3]+n*this._internal[4]+this._internal[5],e}},TGE.Point=function(e,t){return e=typeof e!="undefined"?e:0,t=typeof t!="undefined"?t:0,this.x=e,this.y=t,this},TGE.Point.prototype={setTo:function(e,t){this.x=e,this.y=t},copyFrom:function(e){return this.x=e.x,this.y=e.y,this},add:function(e){return new this.constructor(this.x+e.x,this.y+e.y)},subtract:function(e){return new this.constructor(this.x-e.x,this.y-e.y)},offset:function(e,t){return this.x+=e,this.y+=t,this},rotate:function(e){var t=e*TGE.DEG2RAD;return new this.constructor(this.x*Math.cos(t)-this.y*Math.sin(t),this.y*Math.cos(t)+this.x*Math.sin(t))},rotateThis:function(e){var t=e*TGE.DEG2RAD,n=this.x*Math.cos(t)-this.y*Math.sin(t),r=this.y*Math.cos(t)+this.x*Math.sin(t);return this.setTo(n,r),this}},TGE.Vector2D=function(e,t){TGE.Vector2D.superclass.constructor.call(this,e,t)},TGE.Vector2D.prototype={magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},dotProduct:function(e){return this.x*e.x+this.y*e.y},crossProduct:function(e){return this.x*e.y-this.y*e.x},angleBetween:function(e){var t=this.magnitude()*e.magnitude();return t===0?0:Math.acos(this.dotProduct(e)/t)*TGE.RAD2DEG}},extend(TGE.Vector2D,TGE.Point),TGE.Rectangle=function(e,t,n,r){e=typeof e!="undefined"?e:0,t=typeof t!="undefined"?t:0,n=typeof n!="undefined"?n:0,r=typeof r!="undefined"?r:0,this.x=e,this.y=t,this.width=n,this.height=r},TGE.Rectangle.prototype={intersects:function(e,t,n){t=typeof t=="undefined"?1:t,n=typeof n=="undefined"?1:n;var r=this.width*(1-t)/2,i=this.height*(1-t)/2,s=this.x+r,o=this.y+i,u=this.x+this.width-r,a=this.y+this.height-i;r=e.width*(1-n)/2,i=e.height*(1-n)/2;var f=e.x+r,l=e.y+i,c=e.x+e.width-r,h=e.y+e.height-i;return f>=s&&c<=u&&l>=o&&h<=a?!0:u<f||s>c||a<l||o>h?!1:!0},union:function(e){var t=this.x+this.width,n=this.y+this.height,r=e.x+e.width,i=e.y+e.height;this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y);var s=Math.max(t,r),o=Math.max(n,i);this.width=s-this.x,this.height=o-this.y}},TGE.PI=3.1415926535,TGE.TWO_PI=6.2831853072,TGE.RAD2DEG=57.2957795,TGE.DEG2RAD=.0174532925,TGE.POSITIVE_X_VECTOR=new TGE.Vector2D(1,0),TGE.NEGATIVE_X_VECTOR=new TGE.Vector2D(-1,0),TGE.POSITIVE_Y_VECTOR=new TGE.Vector2D(0,1),TGE.NEGATIVE_Y_VECTOR=new TGE.Vector2D(0,-1),TGE.DisplayObject=function(){return this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.alpha=1,this.backgroundColor=null,this.visible=!0,this.width=0,this.height=0,this.registrationX=.5,this.registrationY=.5,this.parent=null,this.stage=null,this.mouseEnabled=!1,this.instanceName="",this._mLocalTransform=new TGE.Matrix,this._mLocalTransformNoReg=new TGE.Matrix,this._mWorldTransform=new TGE.Matrix,this._mWorldTransformNoReg=new TGE.Matrix,this._mRegistrationTransform=new TGE.Matrix,this._mTopLeft=new TGE.Point,this._mBottomRight=new TGE.Point,this._mAABB=new TGE.Rectangle,this._boundingInfoDirty=!0,this},TGE.DisplayObject.prototype={_mPreviousX:0,_mPreviousY:0,_mPreviousScaleX:1,_mPreviousScaleY:1,_mPreviousRotation:0,_mPreviousRegistrationX:0,_mPreviousRegistrationY:0,_mPreviousVisibility:!1,_mLocalTransform:null,_mLocalTransformNoReg:null,_mLocalTransformDirty:!0,_mWorldTransform:null,_mWorldTransformNoReg:null,_mWorldTransformDirty:!0,_mRegistrationTransform:null,_mTopLeft:0,_mBottomRight:0,_mAABB:null,_boundingInfoDirty:!0,_mWorldAlpha:1,_mIgnoreProperties:!1,_mMouseOver:!1,_visibilityChanged:!1,setLocalTransform:function(e,t,n,r,i,s){var o=this._mLocalTransform._internal;o[0]=e,o[1]=n,o[2]=i,o[3]=t,o[4]=r,o[5]=s,this._mIgnoreProperties=!0,this._mLocalTransformDirty=!0},useDisplayProperties:function(){this._mIgnoreProperties=!1,this._mLocalTransformDirty=!0},getBounds:function(){return this._checkVisibilityChange(),this._boundingInfoDirty&&this._updateAABB(),this._mAABB},hitTestPoint:function(e,t){var n=this.x-this.registrationX*this.width,r=this.x+(1-this.registrationX)*this.width,i=this.y-this.registrationY*this.height,s=this.y+(1-this.registrationY)*this.height;return e>this.x-this.registrationX*this.width&&e<this.x+(1-this.registrationX)*this.width&&t>this.y-this.registrationY*this.height&&t<this.y+(1-this.registrationY)*this.height},clearChildren:function(){},markForRemoval:function(){},numChildren:function(e){return 0},isMouseOver:function(){return this._mMouseOver},_draw:function(e){this._checkVisibilityChange();if(!this.visible)return;this._updateTransformations(),this.stage!==null&&this.mouseEnabled&&this.stage._mMouseTargets.push(this),e.save();var t=this._mWorldTransform._internal,n=this.stage===null?1:this.stage._mScale,r=t[0]*n,i=t[3]*n,s=t[1]*n,o=t[4]*n,u=t[2]*n,a=t[5]*n;this._mIgnoreProperties||this.rotation!==0?e.setTransform(r,i,s,o,u,a):e.setTransform(r,i,s,o,u|0,a|0),e.globalAlpha=this._mWorldAlpha,this.backgroundColor!==null&&(e.fillStyle=this.backgroundColor,e.fillRect(0,0,this.width,this.height)),this._drawClass(e),e.restore()},_drawClass:function(e){},_updateTransformations:function(){this._mWorldTransformDirty=!1;var e=this.x!==this._mPreviousX||this.y!==this._mPreviousY||this.scaleX!==this._mPreviousScaleX||this.scaleY!==this._mPreviousScaleY||this.rotation!==this._mPreviousRotation||this._visibilityChanged;e&&!this._mIgnoreProperties&&(this._visibilityChanged=!1,this._mPreviousX=this.x,this._mPreviousY=this.y,this._mPreviousScaleX=this.scaleX,this._mPreviousScaleY=this.scaleY,this._mPreviousRotation=this.rotation,this._mLocalTransformDirty=!0);if(this.registrationX!==this._mPreviousRegistrationX||this.registrationY!==this._mPreviousRegistrationY){this._mPreviousRegistrationX=this.registrationX,this._mPreviousRegistrationY=this.registrationY;var t=-this.width*this.registrationX,n=-this.height*this.registrationY;this._mRegistrationTransform.identity(),this._mRegistrationTransform.translate(t,n)}if(this._mLocalTransformDirty){if(!this._mIgnoreProperties){this._mLocalTransform.identity();var r=this._mLocalTransform._internal;r[2]=this.x,r[5]=this.y,this.rotation!==0&&this._mLocalTransform.rotate(this.rotation);if(this.scaleX!==1||this.scaleY!==1)r[0]*=this.scaleX,r[1]*=this.scaleY,r[3]*=this.scaleX,r[4]*=this.scaleY}this._mLocalTransformNoReg.copyFrom(this._mLocalTransform),this._mLocalTransform.concat(this._mRegistrationTransform)}if(this.parent!==null){if(this._mLocalTransformDirty||this.parent._mWorldTransformDirty)this._mWorldTransform.copyFrom(this.parent._mWorldTransformNoReg),this._mWorldTransform.concat(this._mLocalTransform),this._mWorldTransformNoReg.copyFrom(this.parent._mWorldTransformNoReg),this._mWorldTransformNoReg.concat(this._mLocalTransformNoReg),this._mWorldTransformDirty=!0}else this._mWorldTransform.copyFrom(this._mLocalTransform),this._mWorldTransformDirty=this._mLocalTransformDirty;this._mWorldTransformDirty&&this._setBoundingInfoDirty(),this._mWorldAlpha=this.parent!==null?this.parent._mWorldAlpha*this.alpha:this.alpha,this._mLocalTransformDirty=!1},_updateAABB:function(){this._mTopLeft.x=0,this._mTopLeft.y=0,this._mBottomRight.x=this.width,this._mBottomRight.y=this.height,this._mWorldTransform.transformPoint(this._mTopLeft),this._mWorldTransform.transformPoint(this._mBottomRight);var e=Math.min(this._mTopLeft.x,this._mBottomRight.x),t=Math.max(this._mTopLeft.x,this._mBottomRight.x),n=Math.min(this._mTopLeft.y,this._mBottomRight.y),r=Math.max(this._mTopLeft.y,this._mBottomRight.y);this._mAABB.x=e,this._mAABB.y=n,this._mAABB.width=t-e,this._mAABB.height=r-n,this._boundingInfoDirty=!1},_setBoundingInfoDirty:function(){this._boundingInfoDirty=!0,this.parent!==null&&this.parent._setBoundingInfoDirty()},_checkVisibilityChange:function(){this.visible!==this._mPreviousVisibility&&(this._visibilityChanged=!0,this._mPreviousVisibility=this.visible,this._setBoundingInfoDirty())}},TGE.DisplayObjectContainer=function(){return TGE.DisplayObjectContainer.superclass.constructor.call(this),this._mChildren=[],this},TGE.DisplayObjectContainer.prototype={_mChildren:null,addChild:function(e){return e.parent!==null&&e.parent.removeChild(e),e.parent=this,e.stage=this.stage,this._mChildren.push(e),e},getChildAt:function(e){return this._mChildren[e]},getChildByName:function(e,t){t=typeof t=="undefined"?!1:t;var n=this._mChildren.length;for(var r=0;r<n;r++){if(this._mChildren[r].instanceName===e)return this._mChildren[r];if(t){var i=this._mChildren[r].getChildByName(e,!0);if(i!==null)return i}}return null},getChildIndex:function(e){var t=this._mChildren.length;for(var n=0;n<t;n++)if(this._mChildren[n]===e)return n;return-1},removeChild:function(e){var t=this.getChildIndex(e);return t!==-1&&(this._mChildren[t].parent=null,this._mChildren.splice(t,1)),e},clearChildren:function(){for(var e=this._mChildren.length-1;e>=0;e--)this._mChildren[e].markForRemoval(),this._mChildren[e].clearChildren(),this._mChildren[e].parent=null,this._mChildren.splice(e,1);this._mChildren=[]},numChildren:function(e){e=typeof e=="undefined"?!1:e;var t=this._mChildren.length;if(e){var n=0;for(var r=0;r<t;r++)n+=1+this._mChildren[r].numChildren(!0);return n}return t},_drawClass:function(e){TGE.DisplayObjectContainer.superclass._drawClass.call(this,e);var t=this._mChildren.length;for(var n=0;n<t;n++){var r=this._mChildren[n];r._checkVisibilityChange(),r.visible&&(e.save(),r._draw(e),e.restore())}},_updateAABB:function(){TGE.DisplayObjectContainer.superclass._updateAABB.call(this);var e=this._mChildren.length;for(var t=0;t<e;t++)this._mChildren[t].visible&&this._mAABB.union(this._mChildren[t].getBounds())}},extend(TGE.DisplayObjectContainer,TGE.DisplayObject),TGE.Stage=function(e,t,n){TGE.Stage.superclass.constructor.call(this),this.stage=this;var r=!1;e&&(e instanceof HTMLDivElement?r=!1:e instanceof HTMLCanvasElement?r=!0:e=document.body);var i;return r?i=e:(i=document.createElement("canvas"),e.appendChild(i)),this.width=e.clientWidth,this.height=e.clientHeight,this.registrationX=0,this.registrationY=0,i.width=this.width,i.height=this.height,this.width=this._mOriginalWidth=typeof t!="undefined"?t:e.clientWidth,this.height=this._mOriginalHeight=typeof n!="undefined"?n:e.clientHeight,this._mScale=1,this._mCanvas=i,this._mCanvasContext=i.getContext("2d"),this},TGE.Stage.prototype={_mCanvasContext:null,_mMouseTargets:[],draw:function(){this._mMouseTargets=[],this._mCanvasContext.globalAlpha=1,this._mCanvasContext.globalCompositeOperation="source-over",this._draw.call(this,this._mCanvasContext)},setScale:function(e){this._mScale=e,this._mCanvas.width=this._mOriginalWidth*e,this._mCanvas.height=this._mOriginalHeight*e,this.width=this._mOriginalWidth,this.height=this._mOriginalHeight},_notifyObjectsOfMouseEvent:function(e,t,n){for(var r=this._mMouseTargets.length-1;r>=0;r--){var i=this._mMouseTargets[r];if(i.hitTestPoint(t,n)){switch(e){case"up":i.MouseUp();break;case"down":i.MouseDown();break;case"click":i.Click()}return}}},_updateObjectMouseOverStates:function(e,t){for(var n=this._mMouseTargets.length-1;n>=0;n--){var r=this._mMouseTargets[n],i=r.hitTestPoint(e,t);i?r._mMouseOver=!0:r._mMouseOver&&(r._mMouseOver=!1)}}},extend(TGE.Stage,TGE.DisplayObjectContainer),TGE.Sprite=function(){return TGE.Sprite.superclass.constructor.call(this),this},TGE.Sprite.prototype={_mImage:null,_mCellWidth:0,_mCellHeight:0,_mSpriteIndex:0,_mCoordinateCache:null,setImage:function(e,t,n){t=typeof t=="undefined"?1:t,n=typeof n=="undefined"?1:n,typeof e=="string"&&(e=TGE.AssetManager.GetImage(e));if(!e||e instanceof Image||!e.spriteSheet)if(e instanceof Image){this._mImage=e,this._mCellWidth=Math.floor(e.width/n),this._mCellHeight=Math.floor(e.height/t),this._mCoordinateCache=[];var r,i;for(var s=0;s<t*n;s++)r=(s%n|0)*this._mCellWidth,i=(s/n|0)*this._mCellHeight,this._mCoordinateCache.push([r,i]);this.width=this._mCellWidth,this.height=this._mCellHeight}else this._mImage=null;else{this._mImage=e.spriteSheet,this._mCellWidth=Math.floor(e.width/n),this._mCellHeight=Math.floor(e.height/t),this._mCoordinateCache=[];var r,i;for(var s=0;s<t*n;s++)r=e.x+(s%n|0)*this._mCellWidth,i=e.y+(s/n|0)*this._mCellHeight,this._mCoordinateCache.push([r,i]);this.width=this._mCellWidth,this.height=this._mCellHeight}this._mSpriteIndex=0},setSpriteIndex:function(e){this._mSpriteIndex=e,this._mSpriteIndex>=this._mCoordinateCache.length&&(TGE.log("***** ERROR: Attempt to call TGE.Sprite.setSpriteIndex with an out of range index ("+e.toString()+")"),this._mSpriteIndex=0)},_drawClass:function(e){this._mImage!==null&&(this.width!==this._mCellWidth||this.height!==this._mCellHeight)&&(TGE.log("***** ERROR: You cannot change the width or height properties of a TGE.Sprite object - use scaleX or scaleY instead"),this.width=this._mCellWidth,this.height=this._mCellHeight),this._mImage!==null&&e.drawImage(this._mImage,this._mCoordinateCache[this._mSpriteIndex][0]>>0,this._mCoordinateCache[this._mSpriteIndex][1]>>0,this.width,this.height,0,0,this.width,this.height),TGE.Sprite.superclass._drawClass.call(this,e)}},extend(TGE.Sprite,TGE.DisplayObjectContainer),TGE.AudioLoader=function(e,t,n,r,i){var s=this;this.id=e,this.loader=null,this.forceHandler=null,this.audio=document.createElement("audio"),this.audio.setAttribute("preload","auto"),document.body.appendChild(this.audio);if(TGE.BrowserDetect.browser==="Safari"||TGE.BrowserDetect.platform==="Windows Phone")if(typeof t!="undefined"&&n.lastIndexOf("mp3")==n.length-"mp3".length){var o=t;t=n,n=o}var u=document.createElement("source");u.setAttribute("src",t),this.audio.appendChild(u);var a=document.createElement("source");a.setAttribute("src",n),this.audio.appendChild(a),this.url=t,this.tags=r,this.priority=i,this.complete=!1,this.pollCount=0,this.start=function(e){this.loader=e;if(this.isLimited()){var t=function(){this.audio.pause(),this.audio.removeEventListener("play",this.forceHandler,!1),this.complete=!0,this.loader.onLoad(s),this.audio.play()};this.forceHandler=t.bind(this),this.audio.addEventListener("play",this.forceHandler,!1),this.audio.play()}else{var n=function(){this.audio.removeEventListener("loadedmetadata",this.forceHandler,!1),this.complete=!0,this.loader.onLoad(s)};this.forceHandler=n.bind(this),this.audio.addEventListener("loadedmetadata",this.forceHandler,!1),this.audio.load()}},this.checkStatus=function(){if(this.audio.networkState===HTMLMediaElement.NETWORK_NO_SOURCE){this.loader.onError(s);return}if(this.pollCount>=3){this.loader.onTimeout(s);return}(this.complete===!0||TGE.BrowserDetect.platform==="Windows Phone")&&this.loader.onLoad(s);if(this.isLimited()){this.loader.onTimeout(s);return}this.pollCount++},this.onTimeout=function(){this.loader.onTimeout(s)},this.getName=function(){return t}},TGE.AudioLoader.prototype.isLimited=function(){return TGE.BrowserDetect.platform==="iPhone"||TGE.BrowserDetect.platform==="iPad"},PxLoader.prototype.addAudio=function(e,t,n,r,i){var s=new TGE.AudioLoader(e,t,n,r,i);return this.add(s),s.audio},TGE.AudioManager=function(e){this.mAssetManager=e,this.mVolume=1,this.mMuted=!1,this.mplayerManagerList=new Array},TGE.AudioManager.prototype={Play:function(e){var t=null;if(e.id in this.mplayerManagerList)t=this.mplayerManagerList[e.id];else{t=new TGE.PlayerManager(this);if(t.init(e)===!1)return;this.mplayerManagerList[e.id]=t}if(this.isMobile()==1&&this.mMuted===!0)return;t.playAudio(e)},Pause:function(e){if(e in this.mplayerManagerList){var t=this.mplayerManagerList[e];t.pauseAudio()}},Mute:function(){if(this.mMuted===!0)return;this.mMuted=!0;for(var e in this.mplayerManagerList){var t=this.mplayerManagerList[e];this.isMobile()===!0?t.nLoop==0?t.stopAudio():t.pauseAudio():t.muteAudio()}},Unmute:function(){if(this.mMuted===!1)return;this.mMuted=!1;for(var e in this.mplayerManagerList){var t=this.mplayerManagerList[e];this.isMobile()===!0?t.nLoop!=0&&(t.mState===t.STATE.Stopped?t.playAudio({}):t.resumeAudio()):t.unmuteAudio()}},ToggleMute:function(){this.mMuted===!0?this.Unmute():this.Mute()},StopAll:function(){for(var e in this.mplayerManagerList){var t=this.mplayerManagerList[e];t.stopAudio()}},PauseAll:function(){for(var e in this.mplayerManagerList){var t=this.mplayerManagerList[e];t.pauseAudio()}},ResumeAll:function(){for(var e in this.mplayerManagerList){var t=this.mplayerManagerList[e];if(this.isMobile()==1&&this.mMuted===!0)continue;t.resumeAudio()}},isLoadAudio:function(){return this.mAssetManager.mLoadAudio},isMobile:function(){return TGE.BrowserDetect.platform!=="Windows"&&TGE.BrowserDetect.platform!=="Mac"}},TGE.PlayerManager=function(e){this.mAudioManager=e,this.nStartTime=0,this.nEndTime=-1,this.nLoop=0,this.callback=null,this.audioElement=null,this.bPlaySegment=!1,this.STATE={NotLoaded:0,Playing:1,Stopped:2,Paused:3,AutoPaused:4},this.mState=this.STATE.NotLoaded,this.audioId=null,this.audioPlaybackInProgressHandler=null,this.audioPlaybackCompleteHandler=null},TGE.PlayerManager.prototype={init:function(e){this.mState=this.STATE.NotLoaded,this.audioId=e.id;var t=this;this.callback=e.callBackFunction!==undefined?e.callBackFunction:null,this.audioElement=this.mAudioManager.mAssetManager.getImage(e.id);if(undefined===this.audioElement)return TGE.log("Unknown audio id: "+e.id),!1;this.nStartTime=0,this.nEndTime=-1,"audio_sprite"===this.audioElement.assetType&&(this.bPlaySegment=!0,this.nStartTime=this.audioElement.startTime,this.nEndTime=this.audioElement.endTime,this.audioElement=this.mAudioManager.mAssetManager.getImage(this.audioElement.id));if(!this.audioElement.canPlayType)return TGE.log("No canPlayType attribute found in audio tag: "+e.id),!1;this.nLoop=0,e.loop!==undefined&&(this.nLoop=Number(e.loop)),this.nLoop===undefined&&(this.nLoop=0);var n=function(){this.bPlaySegment&&(this.audioElement.currentTime<this.nStartTime&&(this.audioElement.currentTime=this.nStartTime),this.audioElement.currentTime>=this.nEndTime&&(this.nLoop===0?this.stopAudio():this.restartAudio()))},r=function(){this.nLoop===0?this.stopAudio():this.restartAudio()};return this.audioElement.addEventListener("timeupdate",n.bind(this),!1),this.audioElement.addEventListener("ended",r.bind(this),!1),window.addEventListener("pagehide",function(){t.mState===t.STATE.Playing&&(t.pauseAudio(),t.mState=t.STATE.AutoPaused)}),window.addEventListener("pageshow",function(){t.mState===t.STATE.AutoPaused&&t.resumeAudio()}),this.mState=this.STATE.Stopped,!0},playAudio:function(e){if(this.mAudioManager.isLoadAudio()===!1)return;this.mAudioManager.mMuted===!0?this.audioElement.volume=0:this.audioElement.volume=this.mAudioManager.mVolume;try{this.audioElement.currentTime=this.nStartTime}catch(t){TGE.log("Error setting start time, continuing: "+t)}this.bPlaySegment===!1&&(this.nEndTime=this.audioElement.duration),this.mState=this.STATE.Playing,this.audioElement.play()},stopAudio:function(){if(this.mAudioManager.isLoadAudio()===!1)return;if(undefined===this.audioElement)return;this.mState=this.STATE.Stopped,this.audioElement.pause(),this.audioElement.currentTime=0,this.callback!==null&&this.callback()},restartAudio:function(){if(this.mAudioManager.isLoadAudio()===!1)return;if(undefined===this.audioElement)return;this.mState=this.STATE.Playing,this.audioElement.currentTime=this.nStartTime,this.audioElement.play()},pauseAudio:function(){if(this.mAudioManager.isLoadAudio()===!1)return;if(undefined===this.audioElement)return;if(this.mState!==this.STATE.Playing)return;this.mState=this.STATE.Paused,this.audioElement.pause()},resumeAudio:function(){if(this.mAudioManager.isLoadAudio()===!1)return;if(undefined===this.audioElement)return;if(this.mState!==this.STATE.Paused)return;this.mState=this.STATE.Playing,this.audioElement.play()},muteAudio:function(){if(this.mAudioManager.isLoadAudio()===!1)return;if(undefined===this.audioElement)return;this.audioElement.volume=0},unmuteAudio:function(){if(this.mAudioManager.isLoadAudio()===!1)return;if(undefined===this.audioElement)return;this.audioElement.volume=this.mAudioManager.mVolume}},TGE.Game=function(){if(TGE.Game._sInstance!==null)return TGE.log("***** ERROR: you can only create one instance of a TGE.Game object"),this;TGE.Game._sInstance=this,this.analytics=null,this.mCanvasDiv=null,this.mReorientationDiv=null,this.mCanvasPosition=null,this.mGameManager=new TGE.ObjectsManager,this.mLayers={},this.mCameraLocation=null,this.mLoadingStartTime=(new Date).getTime(),this.mLoadingScreen=null,this.stage=null,this.assetManager=new TGE.AssetManager,this.audioManager=new TGE.AudioManager(this.assetManager),this.mPlaying=!1,this.mPaused=!1,this.mCurrentLevel=null,this.mPauseButton=null,this.mUserPauseEnabled=!1,this.mGameTime=0,this.mFilterStrength=10,this.mFrameTime=0,this.mLastLoop=new Date,this.mLastDisplay=new Date,this.mThisLoop,this.mFPSText=null,this.mMaxTickTime=.1,this.mMinTickTime=Number.MIN_VALUE,this.mUIManager=new TGE.ObjectsManager,this.mScreenManager=new TGE.ScreenManager(this),this.mMouseX=0,this.mMouseY=0,this.mMouseDown=!1,this.mKeysDown={},this.mDefaultLinkTarget="_blank",this.canvasWidth=0,this.canvasHeight=0,this._mNativeScaling=null,this._mViewportScale=1,this._oniOS=TGE.BrowserDetect.platform==="iPhone"||TGE.BrowserDetect.platform==="iPad",this._onAndroid=TGE.BrowserDetect.platform==="Android"},TGE.Game._sInstance=null,TGE.Game.GetInstance=function(){return TGE.Game._sInstance},TGE.Game.prototype={_mViewportScale:0,_mResizeTimeout:null,_oniOS:!1,_onAndroid:!1,onMobile:function(){return TGE.BrowserDetect.isMobileDevice},oniOS:function(){return this._oniOS},onAndroid:function(){return this._onAndroid},onPhoneGap:function(){return TGE.BrowserDetect.usingPhoneGap},IsPlatformAcceptable:function(){var e=!!window.CanvasRenderingContext2D;if(!e)return this.AnalyticErrorEvent("no canvas"),!1;var t=!1;if(TGE.BrowserDetect.platform==="iPhone"||TGE.BrowserDetect.platform==="iPad"){var n=TGE.BrowserDetect.OSversion.charCodeAt(0)-48;return n>=5}if(TGE.BrowserDetect.Platform==="Android")return!0;if(TGE.BrowserDetect.platform==="Windows"||TGE.BrowserDetect.platform==="Mac"){var r=TGE.BrowserDetect.browser.toLowerCase(),i=parseFloat(TGE.BrowserDetect.version);if(r=="firefox")return i>=8;if(r=="explorer")return i>=9;if(r=="chrome")return i>=14;if(r=="safari")return i>=5.1}return!0},_determineCanvasPosition:function(){TGE.debugLog("_determineCanvasPosition"),this.mCanvasPosition=getElementPosition(this.mCanvasDiv)},Launch:function(e,t){var n,r,i=-1,s=-1,o=-1,u=-1,a=!1;this.analytics===null&&this.mAnalytics!=null&&(this.analytics=this.mAnalytics),typeof e=="string"?(n=e,r=t):(n=typeof e.gameDiv=="undefined"?null:e.gameDiv,r=typeof e.reorientDiv=="undefined"?null:e.reorientDiv,i=typeof e.width=="undefined"?-1:e.width,s=typeof e.height=="undefined"?-1:e.height,o=typeof e.initialWidth=="undefined"?-1:parseInt(e.initialWidth),u=typeof e.initialHeight=="undefined"?-1:parseInt(e.initialHeight),a=typeof e.resizeForNative=="undefined"?!1:e.resizeForNative),this.mCanvasDiv=document.getElementById(n);if(this.mCanvasDiv==null)return TGE.log("***** ERROR: Could not find canvas div '"+n+"'"),!1;var f=this.mCanvasDiv.getAttribute("style")||"";this.mCanvasDiv.setAttribute("style",f+" z-index: 1; overflow: hidden; -webkit-user-select: none; -ms-touch-action:none; -webkit-tap-highlight-color: transparent; -moz-tap-highlight-color: transparent; -webkit-transform: translateZ(0);");if(a){var l=document.getElementById("viewporter");l!==null&&(l.align="left");var c=1;TGE.BrowserDetect.platform==="iPad"?(c=.75,i=this.mCanvasDiv.clientWidth,s=Math.round(c*i)):TGE.BrowserDetect.platform==="iPhone"&&(c=320/480,i=this.mCanvasDiv.clientWidth,s=Math.round(c*i),l!==null&&(window.innerWidth>480||window.innerHeight>480)&&(l.align="center")),c!==1&&(this._mNativeScaling={x:i/this.mCanvasDiv.clientWidth,y:s/this.mCanvasDiv.clientHeight})}return i>0&&s>0&&(this.mCanvasDiv.style.width=i+"px",this.mCanvasDiv.style.height=s+"px"),this.canvasWidth=this.mCanvasDiv.clientWidth,this.canvasHeight=this.mCanvasDiv.clientHeight,TGE.debugLog("game launch calling _resizeViewport"),this._resizeViewport(),this.mReorientationDiv=document.getElementById(r),this._determineCanvasPosition(),window.addEventListener("resize",this._onResize.bind(this),!1),this.onMobile()&&(window.addEventListener("blur",this._onDeactivate.bind(this),!1),window.addEventListener("pagehide",this._onDeactivate.bind(this),!1),this.onPhoneGap()&&document.addEventListener("pause",this._onDeactivate.bind(this),!1)),"ontouchstart"in document.documentElement&&TGE.BrowserDetect.isMobileDevice?(this.mCanvasDiv.addEventListener("touchstart",this._mouseDown.bind(this),!1),this.mCanvasDiv.addEventListener("touchmove",this._mouseMove.bind(this),!1),this.mCanvasDiv.addEventListener("touchend",this._mouseUp.bind(this),!1)):(this.mCanvasDiv.addEventListener("click",this._preventBehavior.bind(this),!1),this.mCanvasDiv.addEventListener("mousedown",this._mouseDown.bind(this),!1),this.mCanvasDiv.addEventListener("mouseup",this._mouseUp.bind(this),!1),this.mCanvasDiv.addEventListener("mousemove",this._mouseMove.bind(this),!1)),document.addEventListener("keydown",this._keyDown.bind(this),!1),document.addEventListener("keyup",this._keyUp.bind(this),!1),o>0&&u>0?this.InitializeRenderer(o,u):this.InitializeRenderer(),window.addEventListener("orientationchange",this._onOrientationChanged),typeof viewporter!="undefined"&&typeof viewporter.preventPageScroll=="function"&&(viewporter.preventPageScroll=!0),this.BeginLoad(),!0},_onOrientationChanged:function(){TGE.debugLog("_onOrientationChanged called"),typeof viewporter!="undefined"&&typeof viewporter.refresh=="function"&&viewporter.refresh()},_onResize:function(){TGE.debugLog("_onResize::_mResizeTimeout: "+this._mResizeTimeout),this._mResizeTimeout!==null&&(clearTimeout(this._mResizeTimeout),this._mResizeTimeout=null),this.onAndroid()?this._mResizeTimeout=setTimeout(this._resizeViewport.bind(this),500):this._resizeViewport()},_scaleCanvasDiv:function(e){if(this.stage===null)return;var t=Math.round(this.stage.width*e*1e3)/1e3,n=Math.round(this.stage.height*e*1e3)/1e3;this.mCanvasDiv.style.width=t+"px",this.mCanvasDiv.style.height=n+"px",this._scaleStage(e)},_getBrowserWidth:function(){return window.innerWidth?window.innerWidth:document.documentElement&&document.documentElement.clientWidth!=0?document.documentElement.clientWidth:document.body?document.body.clientWidth:0},_getBrowserHeight:function(){return window.innerHeight?window.innerHeight:document.documentElement&&document.documentElement.clientHeight!=0?document.documentElement.clientHeight:document.body?document.body.clientHeight:0},_scaleStage:function(e){this._mViewportScale=e,this.stage!==null&&this.stage.setScale(this._mViewportScale),this._determineCanvasPosition()},_centerCanvasDiv:function(e,t,n,r){this.mCanvasDiv.style.position="absolute";if(e){this.mCanvasDiv.style.align="left",this.mCanvasDiv.style.left=this._getBrowserWidth()/2-n/2+"px";var i=document.getElementById("viewporter");i&&(i.style.align="left")}t&&(this.mCanvasDiv.style.top=this._getBrowserHeight()/2-r/2+"px")},_resizeViewport:function(){TGE.debugLog("_resizeViewport");if(typeof window.canvasScale!="undefined"){TGE.debugLog("_resizeViewport for JSEmbed using stage scaling"),this.scaleStage(window.canvasScale);return}var e=this.mCanvasDiv,t=e.getAttribute("style")||"",n=this.canvasWidth,r=this.canvasHeight,i=window.innerWidth,s=window.innerHeight;TGE.debugLog("_resizeViewport::game size: "+n+"x"+r+", \nscreen size: "+i+"x"+s);var o=n<=r,u=i<=s,a=u===o,f={x:1,y:1};f.x=i/n,f.y=s/r,f.x=Math.round(f.x*100)/100,f.y=Math.round(f.y*100)/100;var l=1,c;f.x<f.y?(l=f.x,c=!0):(l=f.y,c=!1),Math.abs(1-l)<=.01&&(l=1);var h=n*l,p=r*l;if(TGE.BrowserDetect.usingPhoneGap){TGE.debugLog("_resizeViewport for native using stage scaling"),this._scaleCanvasDiv(l),this._centerCanvasDiv(!0,!0,h,p);return}TGE.BrowserDetect.isMobileDevice?(TGE.BrowserDetect.platform==="Android"&&parseInt(TGE.BrowserDetect.OSversion.charAt(0))<4||TGE.BrowserDetect.oniOS&&TGE.BrowserDetect.OSversion.charAt(0)<6||TGE.BrowserDetect.platform==="Kindle Fire"?(TGE.debugLog("_resizeViewport for mobile web using stage scaling"),this._scaleCanvasDiv(l)):(TGE.debugLog("_resizeViewport for mobile web using css transform scaling"),this._mViewportScale=l,f=l+", "+l,e.setAttribute("style",t+" -ms-transform-origin: left top; -webkit-transform-origin: left top; -moz-transform-origin: left top; -o-transform-origin: left top; transform-origin: left top; -ms-transform: scale("+f+"); -webkit-transform: scale3d("+f+", 1); -moz-transform: scale("+f+"); -o-transform: scale("+f+"); transform: scale("+f+");")),this._centerCanvasDiv(!0,!0,h,p)):this._centerCanvasDiv(!0,!1,n,r),this.mReorientationDiv!==null&&TGE.BrowserDetect.isMobileDevice&&(a?(this.mReorientationDiv.style.display="none",this.mCanvasDiv.style.display="block"):(this.mCanvasDiv.style.display="none",this.mReorientationDiv.style.display="block",this.PauseGame(!0))),this._determineCanvasPosition(),typeof viewporter!="undefined"&&typeof viewporter.refresh=="function"&&viewporter.refresh()},_onDeactivate:function(){this.mPlaying&&(this.PauseGame(!0),this.audioManager.Mute())},InitializeRenderer:function(e,t){this.stage=new TGE.Stage(this.mCanvasDiv,e,t)},BeginLoad:function(){this.assetManager.loadAssetList("loading",null,this.LoadRequiredAssets.bind(this))},LoadRequiredAssets:function(){this.mScreenManager.Initialize(this),this._resizeViewport();var e=null;typeof LoadingScreen!="undefined"&&(this.mLoadingScreen=this.ShowScreen(LoadingScreen),e=this.loadRequiredAssetsCallback.bind(this)),this.Update(),this.assetManager.loadAssetList("required",e,this.finishedLoadingRequiredAssets.bind(this))},loadRequiredAssetsCallback:function(e){this.mLoadingScreen!=null&&typeof this.mLoadingScreen.UpdateProgress=="function"&&this.mLoadingScreen.UpdateProgress(e)},finishedLoadingRequiredAssets:function(){var e=Math.round(((new Date).getTime()-this.mLoadingStartTime)/1e3);this.AnalyticGameEvent("load",e),TGE.debugLog("finishedLoadingRequiredAssets calling _resizeViewport"),this._resizeViewport(),this.GotoMainMenu()},LoadLevelAssets:function(e,t,n){this.assetManager.loadAssetList("level_"+e.toString(),t,n)},StartLevel:function(e){var t=e==this.mCurrentLevel;this.mCurrentLevel=e,this.subclassSetupLevel(this.mCurrentLevel),this.AnalyticLevelEvent(t?"replay":"start"),(!this.mPlaying||this.mPaused)&&this.StartPlaying()},FinishLevel:function(){this.AnalyticLevelEvent("complete"),this.subclassFinishLevel()},Replay:function(){this.StartLevel(this.mCurrentLevel)},StartPlaying:function(){this.mGameTime=0,this.mPaused=!1,this.mPlaying=!0,TGE.Achievements.EnableParterUI(!1),this.subclassStartPlaying()},ClearScene:function(){this.mGameManager.Purge(),this.mUIManager.Purge(),this.mCameraLocation=new TGE.Point,this.stage.clearChildren(),this.mFPSText=null,this.SetupLayers(),this.mScreenManager.Initialize(this),this.CreateLayer("FPS");var e=this.assetManager.getImage("pause_button",!1);if(e!=null&&e.width>0){var t=Math.max(e.width,e.height);this.mPauseButton=this.CreateUIEntity(TGE.ScreenEntity).Setup(this.Width()-t/2,t/2,"pause_button","ScreenManager"),this.EnableUserPause()}},SetupLayers:function(){this.mLayers={},this.CreateLayer("TGE_default"),this.subclassSetupLayers()},ShowScreen:function(e){return this.mScreenManager.ShowScreen(e)},GotoMainMenu:function(){this.mPaused=!1,this.mPlaying=!1,this.ClearScene(),typeof MainMenu!="undefined"?this.ShowScreen(MainMenu):this.StartPlaying()},PauseGame:function(e){var t=typeof PauseScreen!="undefined";if(!this.mPlaying||e===this.mPaused||!t)return;this.mPaused=e,this.AnalyticGameEvent(this.mPaused?"pause":"resume",this.mCurrentLevel),this._determineCanvasPosition(),t&&(this.mPaused?(this.ShowScreen(PauseScreen,!1),this.DisableUserPause()):(this.mScreenManager.CloseScreen(PauseScreen),this.EnableUserPause())),TGE.Achievements.EnableParterUI(this.mPaused)},DisableUserPause:function(){this.mUserPauseEnabled=!1,this.mPauseButton!=null&&this.mPauseButton.Hide()},EnableUserPause:function(){this.mUserPauseEnabled=!0,this.mPauseButton!=null&&this.mPauseButton.Show()},Update:function(){var e=(this.mThisLoop=new Date)-this.mLastLoop;this.mFrameTime+=(e-this.mFrameTime)/this.mFilterStrength,this.mLastLoop=this.mThisLoop,this.updateFPSDisplay(),e/=1e3,e=Math.max(this.mMinTickTime,e),e=Math.min(this.mMaxTickTime,e),this.mPaused||(this.mGameTime+=e),this.mScreenManager.Update(e),this.stage._updateObjectMouseOverStates(this.mMouseX,this.mMouseY),this.mPaused||this.updateObjects(e),this.mPlaying&&!this.mPaused&&this.subclassUpdateGame(e),this._updateObjectsToScreen(),requestAnimFrame(this.Update.bind(this)),this.stage.draw()},SetConstantTickTime:function(e){this.mMinTickTime=this.mMaxTickTime=e},SetBackgroundColor:function(e){this.stage.backgroundColor=e},CreateLayer:function(e){var t=new TGE.DisplayObjectContainer;this.mLayers[e]=t,t.registrationX=0,t.registrationY=0,this.stage.addChild(t)},CreateWorldEntity:function(e){var t=new e;return e.prototype.constructor.apply(t,[this]),this.mGameManager.AddObject(t),t},CreateUIEntity:function(e){var t=new e;return e.prototype.constructor.apply(t,[this]),this.mUIManager.AddObject(t),t},getLayer:function(e){var t="TGE_default"in this.mLayers?this.mLayers.TGE_default:this.stage;return e!=null&&e in this.mLayers&&(t=this.mLayers[e]),t},ShowFramerateDisplay:function(e,t,n,r){this.mFPSText!=null&&this.mFPSText.markForRemoval(),this.mFPSText=this.CreateUIEntity(TGE.Text).Setup(e,t,"",n.toString()+"px Arial","center","middle",r,"FPS")},updateFPSDisplay:function(){var e=this.mThisLoop-this.mLastDisplay;if(e<1e3)return;this.mLastDisplay=this.mThisLoop,this.mFrameTime>0&&this.mFPSText!=null&&(this.mFPSText.Show(),this.mFPSText.text=Math.round(1e3/this.mFrameTime).toFixed(0)+"fps")},updateObjects:function(e){this.mGameManager.Update(e),this.mUIManager.Update(e)},_updateObjectsToScreen:function(){this.mGameManager._updateObjectsToScreen()},EndGame:function(){if(!this.mPlaying)return;this.mPlaying=!1,TGE.Achievements.EnableParterUI(!0);var e=Math.round(this.mGameTime);this.AnalyticGameEvent("end",e),this.DisableUserPause(),this.subclassEndGame(),typeof GameOver!="undefined"&&this.ShowScreen(GameOver)},CurrentLevel:function(){return this.mCurrentLevel},_processMousePosition:function(e){this.mCanvasPosition===null&&this._determineCanvasPosition(),this.mMouseX=e.pageX,this.mMouseY=e.pageY,e.touches&&(this.mMouseX=e.touches[0].clientX+document.body.scrollLeft+document.documentElement.scrollLeft,this.mMouseY=e.touches[0].clientY+document.body.scrollTop+document.documentElement.scrollTop),this.mMouseX-=this.mCanvasPosition.x,this.mMouseY-=this.mCanvasPosition.y,this.mMouseX/=this._mViewportScale,this.mMouseY/=this._mViewportScale},_preventBehavior:function(e){e.stopPropagation(),e.preventDefault()},_mouseDown:function(e){window.focus(),this._processMousePosition(e),this.mMouseDown=!0;if(this.mUserPauseEnabled&&this.mPauseButton!=null&&this.mGameTime>.5){var t=Math.max(this.mPauseButton.Width(),this.mPauseButton.Height());if(this.mMouseX>this.Width()-t&&this.mMouseY<t){this.PauseGame(!0);return}}this.stage._notifyObjectsOfMouseEvent("down",this.mMouseX,this.mMouseY),this.mPaused||this.subclassMouseDown(),e.stopPropagation(),e.preventDefault()},_mouseUp:function(e){this.mMouseDown=!1,this.stage._notifyObjectsOfMouseEvent("up",this.mMouseX,this.mMouseY),this.mPaused||this.subclassMouseUp(),e.stopPropagation(),e.preventDefault()},_mouseMove:function(e){this._processMousePosition(e),this.mPaused||this.subclassMouseMove(),e.stopPropagation(),e.preventDefault()},MouseX:function(){return this.mMouseX},MouseY:function(){return this.mMouseY},IsMouseDown:function(){return this.mMouseDown},isMouseDown:function(){return this.mMouseDown},_keyDown:function(e){this.mKeysDown[e.keyCode]=!0,this.subclassKeyDown(e.keyCode)},_keyUp:function(e){this.mKeysDown[e.keyCode]=!1,this.subclassKeyUp(e.keyCode)},isKeyDown:function(e){return this.mKeysDown[e]===!0},Width:function(){return this.stage.width},Height:function(){return this.stage.height},GameTime:function(){return this.mGameTime},NumGameObjects:function(){return this.mGameManager.NumObjects()},NumUIObjects:function(){return this.mUIManager.NumObjects()},CameraLocation:function(){return this.mCameraLocation},ScreenX:function(e){return this.stage.width/2+(e-this.mCameraLocation.x)},ScreenY:function(e){return this.stage.height/2-(e-this.mCameraLocation.y)},GetImage:function(e){return this.assetManager.getImage(e)},OpenURL:function(e){this.AnalyticClickThruEvent(e),window.open(e,this.mDefaultLinkTarget)},PlayGame:function(){this.AnalyticGameEvent("begin"),this.subclassPlayGame()},CurrentScore:function(){return 0},subclassSetupLayers:function(){},subclassPlayGame:function(){this.StartLevel(-1)},subclassSetupLevel:function(e){},subclassStartPlaying:function(){},subclassStartLevel:function(){},subclassFinishLevel:function(){},subclassUpdateGame:function(e){},subclassEndGame:function(e){},subclassMouseMove:function(){},subclassMouseDown:function(){},subclassMouseUp:function(){},subclassKeyDown:function(e){},subclassKeyUp:function(e){},AnalyticGameEvent:function(e,t){this.analytics!==null&&this.analytics.logGameEvent(e,this.mCurrentLevel,t)},AnalyticShareEvent:function(e){this.analytics!==null&&this.analytics.logShareEvent(e,this.mCurrentLevel)},AnalyticLevelEvent:function(e){this.analytics!==null&&this.analytics.logLevelEvent(e,this.mCurrentLevel,Math.floor(this.mGameTime))},AnalyticAchievementEvent:function(e,t){this.analytics!==null&&this.analytics.logAchievementEvent(e,this.mCurrentLevel,t)},AnalyticErrorEvent:function(e){this.analytics!==null&&this.analytics.logErrorEvent(e)},AnalyticClickThruEvent:function(e){this.analytics!==null&&this.analytics.logClickThruEvent(e,this.mCurrentLevel)},AnalyticCustomEvent:function(e,t){this.analytics!==null&&this.analytics.logCustomEvent(e,this.mCurrentLevel,t)}},TGE.KEY_ARROW_LEFT=37,TGE.KEY_ARROW_RIGHT=39,TGE.KEY_ARROW_UP=38,TGE.KEY_ARROW_DOWN=40,TGE.KEY_SPACEBAR=32,TGE.ObjectsManager=function(){this.mObjectsArray=[]},TGE.ObjectsManager.prototype={AddObject:function(e){this.mObjectsArray.push(e)},Update:function(e){for(var t=this.mObjectsArray.length-1;t>=0;t--)this.mObjectsArray[t].Update(e),this.mObjectsArray[t].MarkedForRemoval()&&(this.mObjectsArray[t].Cleanup(),this.mObjectsArray.splice(t,1))},_updateObjectsToScreen:function(){for(var e=0;e<this.mObjectsArray.length;e++)this.mObjectsArray[e]._updateScreenPosition()},Purge:function(){for(var e=this.mObjectsArray.length-1;e>=0;e--)this.mObjectsArray[e].Cleanup(),this.mObjectsArray.splice(e,1)},NumObjects:function(){return this.mObjectsArray.length}},TGE.AssetLoader=function(){return this.mAssetList=null,this.mUpdateCallback=null,this.mCompleteCallback=null,this},TGE.AssetLoader.prototype={loadAssetList:function(e,t,n,r,s){n=typeof n=="string"?n:"",n.length>0&&n.charAt(n.length-1)!=="/"&&(n=n.concat("/")),this.mAssetList=t,this.mUpdateCallback=r,this.mCompleteCallback=s;var o=new PxLoader({statusInterval:3e3}),u=0;if(t!==null&&t.list.length>0&&t.loaded===!1){for(i=0;i<t.list.length;i++){var a=null;if(t.list[i].assetType==="audio")e.loadAudio&&(a=o.addAudio(t.list[i].id,n+t.list[i].url,n+t.list[i].backup_url,null,null),u++);else if(t.list[i].assetType==="audio_sprite")a={assetType:"audio_sprite",id:t.list[i].sprite,startTime:t.list[i].startTime,endTime:t.list[i].endTime};else if(t.list[i].sheet){var f=t.list[i].sheet,l=e._mSpriteSheets[f];l||(l=o.addImage(n+t.list[i].sheet),l!==null&&e.addImage(t.list[i].id,l),e._mSpriteSheets[t.list[i].sheet]=l);var c=TGE.AssetManager.SpriteSheets[this._trimmedFilename(f)];if(c){var h=c[this._trimmedFilename(t.list[i].url)];h&&(a={spriteSheet:l,x:h[0],y:h[1],width:h[2],height:h[3]})}}else a=o.addImage(n+t.list[i].url);a!==null&&e.addImage(t.list[i].id,a)}o.addProgressListener(TGE.AssetLoader.prototype._loaderCallback.bind(this)),o.addCompletionListener(TGE.AssetLoader.prototype._completeCallback.bind(this)),o.start()}else this.mUpdateCallback!==null&&this.mUpdateCallback(1),this.mCompleteCallback!==null&&this.mCompleteCallback.call()},_trimmedFilename:function(e){var t=e.lastIndexOf("/")+1;return e.substr(t,e.lastIndexOf(".")-t)},_loaderCallback:function(e){e.error&&TGE.log("***** ERROR: could not load image '"+e.resource.getName()+"'");if(this.mUpdateCallback!==null){var t=e.completedCount/e.totalCount;this.mUpdateCallback(t)}},_completeCallback:function(){this.mAssetList!==null&&(this.mAssetList.loaded=!0,this.mAssetList=null),this.mCompleteCallback!==null&&this.mCompleteCallback()}},TGE.AssetManager=function(e){return TGE.AssetManager.sAssetManagerInstance!==null?TGE.AssetManager.sAssetManagerInstance:(TGE.AssetManager.sAssetManagerInstance=this,e===undefined&&(e=!0),this.rootLocation="",this.useSpriteSheets=!1,this.loadAudio=e,this._mSpriteSheets={},this)},TGE.AssetManager.SpriteSheets={},TGE.AssetManager.sAssetManagerInstance=null,TGE.AssetManager.GetImage=function(e){return TGE.AssetManager.sAssetManagerInstance===null?null:TGE.AssetManager.sAssetManagerInstance.getImage(e)},TGE.AssetManager.prototype={_mImageAssetLists:[],_mImageCache:[],assignImageAssetList:function(e,t){this._mImageAssetLists[e]={loaded:!1,list:t}},loadAssetList:function(e,t,n){var r=new TGE.AssetLoader,i=this._mImageAssetLists[e];i?r.loadAssetList(this,i,this.rootLocation,t,n):(TGE.log("TGE.AssetManager could not locate asset list '"+e+"'"),n&&n.call())},addImage:function(e,t){this._mImageCache[e]=t},getImage:function(e,t){t=typeof t=="undefined"?!0:t;var n=this._mImageCache[e];return t&&e!=null&&!n&&TGE.log("***** ERROR: TGE.AssetManager.getImage could not find the asset '"+e+"'"),n}},TGE.SpriteAnimation=function(e,t,n,r,i,s,o){this.mFPS=s,this.mNumberOfFrames=i,this.mLooping=o,this.mAge=0,this.mPaused=!1,this.mFinishedCallback=null,this.mFrameOffset=0,this.mCurrentFrame=0,this.mSprite=new TGE.Sprite,this.mSprite.setImage(t,n,r),this.mSprite.visible=!1,e.addChild(this.mSprite),this.mSprite.registrationX=e.registrationX,this.mSprite.registrationY=e.registrationY},TGE.SpriteAnimation.prototype={Play:function(e){this.mAge=0,this.mFinishedCallback=e,this.mSprite.setSpriteIndex(0),this.mSprite.visible=!0},Pause:function(){this.mPaused=!0},Stop:function(){this.mSprite.visible=!1},Resume:function(){this.mPaused=!1},SetAnimationIndexOffset:function(e){this.mFrameOffset=e},Update:function(e){this.mPaused||(this.mAge+=e);var t=1/this.mFPS,n=Math.floor(this.mAge/t);this.mCurrentFrame=0,this.mLooping||n<this.mNumberOfFrames?this.mCurrentFrame=n%this.mNumberOfFrames:(this.mCurrentFrame=this.mNumberOfFrames-1,this.mFinishedCallback!=null&&(this.mFinishedCallback.call(),this.mFinishedCallback=null)),this.mCurrentFrame+=this.mFrameOffset,this.mSprite.setSpriteIndex(this.mCurrentFrame)}},TGE.KeyframedAnimation=function(e,t,n,r,i){return this.mAnimationPlayer=e,this.mAnimationID=t,this.mPartInstances=n,this.mLooping=r,this.mFinishedCallback=i,this.mSmoothTransitions=!1,this.mAge=0,this.mPaused=!1,this.mAnimationPlayer.AnimationExists(t)||(this.Cancel(),console.log("***** ERROR: keyframed animation not found: '"+t+"'")),this},TGE.KeyframedAnimation.prototype={Pause:function(){this.mPaused=!0},Resume:function(){this.mPaused=!1},Update:function(e){if(this.mPaused)return;this.mAge+=e,this.mAnimationPlayer.PosePartInstances(this.mPartInstances,this.mAnimationID,this.mAge,this.mLooping,this.mSmoothTransitions)},Cancel:function(){this.mFinishedCallback=null,this.Pause()}},TGE.KeyframedAnimationPlayer=function(e,t,n,r){var i,s=null;typeof t=="undefined"?(i=e.data,n=e.imagesFolder,t=e.assetsList,r=e.imageSet,s=typeof e.spriteSheet=="string"?e.spriteSheet:null):i=e,this.mData=null,this.mPartImages=null,this.mImageTag=typeof r=="undefined"?null:r;if(i.parts===undefined||i.part_instances===undefined||i.animations===undefined||i.max_children===undefined||i.framerate===undefined)return this;this.mData=i,this.mInverseGlobalScale=1/i.image_scale;if(t){typeof n=="undefined"&&(n="");for(var o in this.mData.parts)if(this.mData.parts.hasOwnProperty(o)){var u=this.mImageTag===null?o:this.mImageTag+"_"+o;s!==null?t.push({id:u,url:n+"/"+o+".png",sheet:s}):t.push({id:u,url:n+"/"+o+".png"})}}return this},TGE.KeyframedAnimationPlayer.prototype={Valid:function(){return this.mData!==null},GetAnimations:function(){return this.Valid()?this.mData.animations:null},NumRequiredPartInstances:function(){return this.Valid()?this.mData.max_children:0},AnimationExists:function(e){return this.Valid()?this.mData.animations[e]!==undefined:!1},InitializeImages:function(e){if(this.mPartImages!==null)return;this.mPartImages={};for(var t in this.mData.parts)if(this.mData.parts.hasOwnProperty(t)){var n=this.mImageTag===null?t:this.mImageTag+"_"+t;this.mPartImages[t]=e.GetImage(n)}},PosePartInstances:function(e,t,n,r,i){if(!this.Valid())return;var s=this.mData.animations[t],o=s.frames.length,u=o/this.mData.framerate,a=Math.floor(n/u),f=!r&&a>=1?o-1:(n-a*u)/u*o,l=Math.floor(f),c=s.frames[l],h=(l+1)%o,p=s.frames[h],d=e.length,v=c.instances.length;for(var m=0;m<d;m++){var g=e[m];if(m>=v)g.visible=!1;else{var y=c.instances[m],b=this.mData.part_instances[y.i],w=this.mData.parts[b];g.setImage(this.mPartImages[b]),g.registrationX=w.regx,g.registrationY=w.regy;var E=y.a,S=y.b,x=y.c,T=y.d,N=y.x,C=y.y;if(i){var k=p.instances[p.instances_map[y.i]];if(k!==undefined){var L=f-l;E=y.a+(k.a-y.a)*L,S=y.b+(k.b-y.b)*L,x=y.c+(k.c-y.c)*L,T=y.d+(k.d-y.d)*L,N=y.x+(k.x-y.x)*L,C=y.y+(k.y-y.y)*L}}E*=this.mInverseGlobalScale,S*=this.mInverseGlobalScale,x*=this.mInverseGlobalScale,T*=this.mInverseGlobalScale,g.setLocalTransform(E,S,x,T,N,C),g.visible=!0}}}},TGE.ScreenEntity=function(e){TGE.ScreenEntity.superclass.constructor.call(this),this.mGame=e,this.mAge=0,this.mMarkedForRemoval=!1,this.mAnimations=[],this.mCurrentAnimation=null,this.mKeyframedAnimationPlayer=null,this.mAnimationPartInstances=[],this.mCurrentKeyframedAnimation=null,this.mCurrentKeyframedAnimationID=null},TGE.ScreenEntity.prototype={_mCameraCulling:null,Setup:function(e,t,n,r){return this.mLayer=r,this.x=e,this.y=t,this.setImage(this.mGame.GetImage(n)),this.mGame.getLayer(this.mLayer).addChild(this),this},SetImage:function(e,t,n){var r=this.mGame.GetImage(e);if(r==null)return;t=typeof t!="undefined"?t:1,n=typeof n!="undefined"?n:1,this.setImage(r,t,n)},LoadAnimation:function(e,t,n,r,i,s,o){var u=new TGE.SpriteAnimation(this,this.mGame.GetImage(t),n,r,i,s,o);this.mAnimations[e]=u},PlayAnimation:function(e,t){if(this.mCurrentAnimation==this.mAnimations[e])return;this.PlayAnimationFromStart(e,t)},PlayAnimationFromStart:function(e,t){var n=this.mAnimations[e];n!=null&&(this.mCurrentAnimation!==null&&this.mCurrentAnimation.Stop(),this.setImage(null),this.mCurrentAnimation=n,this.mCurrentAnimation.Play(t),this.width=this.mCurrentAnimation.mSprite.width,this.height=this.mCurrentAnimation.mSprite.height)},removeCurrentAnimation:function(){this.mCurrentAnimation!==null&&this.mCurrentAnimation.Stop(),this.setImage(null),this.mCurrentAnimation=null,this.width=this.height=0,this._boundingInfoDirty=!0},InitializeKeyframedAnimations:function(e){this.mKeyframedAnimationPlayer=e,this.mKeyframedAnimationPlayer.InitializeImages(this.mGame),this.mCurrentKeyframedAnimation!==null&&this.mCurrentKeyframedAnimation.Cancel();if(this.mAnimationPartInstances.length>0){var t=this.mAnimationPartInstances.length;for(var n=0;n<t;n++)this.mAnimationPartInstances[n].markForRemoval()}this.mAnimationPartInstances=[];var r=this.mKeyframedAnimationPlayer.NumRequiredPartInstances();for(var n=0;n<r;n++){var i=this.addChild(new TGE.Sprite);i.visible=!1,this.mAnimationPartInstances.push(i)}},PlayKeyframedAnimation:function(e,t,n){if(this.mCurrentKeyframedAnimationID===e)return;this.PlayKeyframedAnimationFromStart(e,t,n)},PlayKeyframedAnimationFromStart:function(e,t,n){typeof t=="undefined"&&(t=!0),typeof n=="undefined"&&(n=null),this.mCurrentKeyframedAnimation!==null&&this.mCurrentKeyframedAnimation.Cancel(),this.mCurrentKeyframedAnimation=new TGE.KeyframedAnimation(this.mKeyframedAnimationPlayer,e,this.mAnimationPartInstances,t,n),this.mCurrentKeyframedAnimationID=e},Age:function(){return this.mAge},Update:function(e){this.mAge+=e,this.subclassUpdate(e),this.ShouldBeRemoved()&&this.markForRemoval(),this.mCurrentAnimation!=null&&this.mCurrentAnimation.Update(e),this.mCurrentKeyframedAnimation!==null&&this.mCurrentKeyframedAnimation.Update(e)},Cleanup:function(){this.subclassCleanup(),this.clearChildren(),this.parent!==null&&this.parent.removeChild(this)},markForRemoval:function(){this.mMarkedForRemoval=!0;var e=this._mChildren.length;for(var t=0;t<e;t++)this._mChildren[t].markForRemoval()},MarkedForRemoval:function(){return this.mMarkedForRemoval},ShouldBeRemoved:function(){if(this._mCameraCulling!==null){var e=this.getBounds();if(this._mCameraCulling[0]&&e.y+e.height<0)return!0;if(this._mCameraCulling[1]&&e.x>this.mGame.Width())return!0;if(this._mCameraCulling[2]&&e.y>this.mGame.Height())return!0;if(this._mCameraCulling[3]&&e.x+e.width<0)return!0}return this.subclassShouldBeRemoved()},subclassUpdate:function(e){},subclassShouldBeRemoved:function(){return!1},subclassCleanup:function(){},_updateScreenPosition:function(){},SetRotation:function(e){this.rotation=e},SetScale:function(e,t){t=typeof t=="undefined"?e:t,this.scaleX=e,this.scaleY=t},SetAlpha:function(e){this.alpha=e},Width:function(){return this.width},Height:function(){return this.height},Show:function(){this.visible=!0},Hide:function(){this.visible=!1},Visible:function(){return this.visible}},extend(TGE.ScreenEntity,TGE.Sprite),TGE.Button=function(e){TGE.ScreenEntity.call(this,e),this.mouseEnabled=!0,this.mState="idle",this.mMouseDown=!1,this.mPressFunction},TGE.Button.prototype={Setup:function(e,t,n,r,i,s){return this.mNumStates=i,TGE.ScreenEntity.prototype.Setup.call(this,e,t,null,s),this.SetImage(n,1,i),this.mPressFunction=r,this.setButtonState("idle"),this},MouseDown:function(){this.mMouseDown=!0},MouseOver:function(){},MouseUp:function(){this.mPressFunction!=null&&this.mMouseDown&&this.mPressFunction.call(this,this),this.mMouseDown=!1},subclassUpdate:function(e){this.mMouseDown=this.mMouseDown&&this.mGame.IsMouseDown(),this._mMouseOver?this.setButtonState(this.mMouseDown?"down":"hover"):this.setButtonState("idle")},setButtonState:function(e){if(e==this.mState)return;this.mState=e;var t=0;switch(this.mState){case"disable":t=3;break;case"down":t=2;break;case"hover":t=1;break;case"idle":default:t=0}t<this.mNumStates&&this.setSpriteIndex(t)}},extend(TGE.Button,TGE.ScreenEntity),TGE.Text=function(e){return TGE.Text.superclass.constructor.call(this,e),this.text="",this.font="12px Arial",this.hAlign="center",this.vAlign="middle",this.textColor="#000",this},TGE.Text.prototype={_mPreviousText:null,_mPreviousFont:null,Setup:function(e,t,n,r,i,s,o,u){return TGE.ScreenEntity.prototype.Setup.call(this,e,t,null,u),this.text=n,this.font=r,this.hAlign=i,this.vAlign=s,this.textColor=o,this},_calculateDimensions:function(e){e.save(),e.font=this.font;var t=e.measureText(this.text);this.width=t.width;try{var n=this.font.indexOf("px"),r=this.font.substring(0,n);this.height=parseInt(r,10),this.height+=this.height/4>>0}catch(i){this.height=30}e.restore()},_drawClass:function(e){if(this.text===null)return;if(this._mPreviousText!==this.text||this._mPreviousFont!==this.font)this._mPreviousText=this.text,this._mPreviousFont=this.font,this._calculateDimensions(e);e.font=this.font!==null?this.font:"Arial",e.textAlign=this.hAlign!==null?this.hAlign:"center",e.textBaseline=this.vAlign!==null?this.vAlign:"middle",e.fillStyle=this.textColor!==null?this.textColor:"#000",e.fillText(this.text,0,0)}},extend(TGE.Text,TGE.ScreenEntity),TGE.GameWorldEntity=function(e){TGE.ScreenEntity.call(this,e),this.worldPosition=new TGE.Point},TGE.GameWorldEntity.prototype={_mLockXPosition:!1,Setup:function(e,t,n,r){return this.mLayer=r,this.SetWorldPosition(e,t),this.setImage(this.mGame.GetImage(n)),this.mGame.getLayer(this.mLayer).addChild(this),this},SetWorldPosition:function(e,t){this.worldPosition.x=e,this.worldPosition.y=t},CullToCamera:function(e,t,n,r){this._mCameraCulling=[e,t,n,r]},WorldPosition:function(){return this.mWorldPosition},LockXPosition:function(){this._mLockXPosition=!0},_updateScreenPosition:function(){var e=this._mLockXPosition?this.worldPosition.x:this.mGame.ScreenX(this.worldPosition.x),t=this.mGame.ScreenY(this.worldPosition.y);this.x=e,this.y=t}},extend(TGE.GameWorldEntity,TGE.ScreenEntity,null),TGE.Screen=function(e){this.mScreenManager=e,this.mBackground=null,this.mUIElements=new Array,this.mDestroyed=!1},TGE.Screen.prototype={Setup:function(){},Close:function(){this.mScreenManager.CloseScreen(this.constructor)},Game:function(){return this.mScreenManager.Game()},CreateUIEntity:function(e){var t=this.mScreenManager.CreateUIEntity(e);return this.mUIElements.push(t),t},DisplayNumber:function(e,t,n,r,s,o,u,a){var f=this.CreateUIEntity(TGE.ScreenEntity).Setup(t,n,null,a),l=e.toString(),c=24,h=2,p=l.length*s;if(u){var d=Math.floor((l.length-1)/3);p+=d*c,p-=d*h}var v=o=="center"?p/2+s/2:p;v-=s;var m=0,g=0;for(i=l.length-1;i>=0;i--){if(u&&g==3){v+=h;var y=new TGE.Sprite;y.setImage("big_digits_comma"),y.x=v,y.y=m,f.addChild(y),v-=c,g=0}var b=new TGE.Sprite;b.setImage(r,1,10),b.setSpriteIndex(l.charCodeAt(i)-48),b.x=v,b.y=m,f.addChild(b),v-=s,g++}return f},FillBackground:function(e){this.mBackground=this.mScreenManager.Game().CreateUIEntity(TGE.ScreenEntity),this.mBackground.Setup(0,0,null,this.mScreenManager.mLayerName),this.mBackground.registrationX=0,this.mBackground.registrationY=0,this.mBackground.width=this.mScreenManager.Game().Width(),this.mBackground.height=this.mScreenManager.Game().Height(),this.mBackground.backgroundColor=e},Finalize:function(){},ShowAll:function(){for(var e=0;e<this.mUIElements.length;e++)this.mUIElements[e].Show()},HideAll:function(){for(var e=0;e<this.mUIElements.length;e++)this.mUIElements[e].Hide()},Update:function(e){},Destroy:function(){this.mBackground!=null&&this.mBackground.markForRemoval();for(var e=0;e<this.mUIElements.length;e++)this.mUIElements[e].markForRemoval();this.mDestroyed=!0}},TGE.ScreenManager=function(e){this.mGame=e,this.mLayerName="ScreenManager",this.mScreens=new Array,this.mFadeIn=null,this.mFadeInAlpha=1,this.mFadeInSpeed=1,this.mFadeInColor=null},TGE.ScreenManager.prototype={Initialize:function(e){for(var t in this.mScreens)this.mScreens[t]!=null&&(this.mScreens[t].Destroy(),this.mScreens[t]=null);e.CreateLayer(this.mLayerName),e.CreateLayer("FadeOverlay")},setupFadeIn:function(e,t){this.mFadeInSpeed=t,this.mFadeInColor=e},CreateUIEntity:function(e){return this.mGame.CreateUIEntity(e)},ShowScreen:function(e,t){var n=new e;e.prototype.constructor.apply(n,[this]);var r=e.className?e.className():e.name;return this.mScreens[r]=n,n.Setup(),n.Finalize(),t=typeof t=="undefined"?!0:t,t!=0&&this.ResetFade(),n},CloseScreen:function(e){var t=e.className?e.className():e.name,n=this.mScreens[t];if(n==null)return;n.Destroy(),this.mScreens[e]=null},ResetFade:function(){this.mFadeInColor!==null&&(this.mFadeIn===null&&(this.mFadeIn=new TGE.DisplayObject,this.mFadeIn.width=this.mGame.Width(),this.mFadeIn.height=this.mGame.Height(),this.mFadeIn.registrationX=0,this.mFadeIn.registrationY=0,this.mFadeIn.backgroundColor=this.mFadeInColor,this.mGame.getLayer("FadeOverlay").addChild(this.mFadeIn)),this.mGame.getLayer("FadeOverlay").getChildIndex(this.mFadeIn)===-1&&this.mGame.getLayer("FadeOverlay").addChild(this.mFadeIn),this.mFadeInAlpha=1,this.mFadeIn.alpha=1,this.mFadeIn.visible=!0)},Update:function(e){this.mFadeIn!==null&&this.mFadeInColor!==null&&(this.mFadeInAlpha-=e/this.mFadeInSpeed,this.mFadeInAlpha<=0&&(this.mFadeInAlpha=0,this.mFadeIn.visible=!1),this.mFadeIn.alpha=this.mFadeInAlpha);for(var t in this.mScreens)this.mScreens[t]!=null&&this.mScreens[t].Update(e)},Game:function(){return this.mGame},XFromPercentage:function(e){return this.mGame.Width()*e},YFromPercentage:function(e){return this.mGame.Height()*e},FixedDistanceFromTop:function(e){return e},FixedDistanceFromBottom:function(e){return this.mGame.Height()-e},FixedDistanceFromLeft:function(e){return e},FixedDistanceFromRight:function(e){return this.mGame.Width()-e}},TGE.Analytics=function(e){return this.gameName=e,this},TGE.Analytics.prototype={logGameEvent:function(e,t,n){var r=this.gameName;(e=="pause"||e=="resume")&&t!=null&&t>0&&(r+=" - level "+t.toString());var i="ANALYTIC EVENT: game, "+e+", "+r;if(e=="load"||e=="end")i+=", "+n.toString();TGE.log(i)},logShareEvent:function(e,t){var n=this.gameName;t!=null&&t>0&&(n+=" - level "+t.toString());var r="ANALYTIC EVENT: share, "+e+", "+n;TGE.log(r)},logLevelEvent:function(e,t,n){var r=this.gameName;t!=null&&t>0&&(r+=" - level "+t.toString());var i="ANALYTIC EVENT: level, "+e+", "+r;(e=="complete"||e=="fail")&&n!=null&&(i+=", "+n.toString()),TGE.log(i)},logAchievementEvent:function(e,t,n){var r=this.gameName;t!=null&&t>0&&(r+=" - level "+t.toString());var i="ANALYTIC EVENT: achievement, "+e+", "+r;n!=null&&(i+=", "+n.toString()),TGE.log(i)},logErrorEvent:function(e){var t="ANALYTIC EVENT: error, "+e+", "+this.gameName;TGE.log(t)},logClickThruEvent:function(e,t){var n=this.gameName;t!=null&&t>0&&(n+=" - level "+t.toString());var r="ANALYTIC EVENT: clickthru, "+e+", "+n;TGE.log(r)},logCustomEvent:function(e,t,n){var r=this.gameName;t!=null&&t>0&&(r+=" - level "+t.toString());var i="ANALYTIC EVENT: custom, "+e+", "+r;n!=null&&(i+=", "+n.toString()),TGE.log(i)}},TGE.GoogleAnalytics=function(e,t){return TGE.GoogleAnalytics.superclass.constructor.call(this,e),TGE.BrowserDetect.usingPhoneGap&&(window.plugins&&window.plugins.gaPlugin?(this._gaPlugin=window.plugins.gaPlugin,this._gaPlugin.init(null,this._logError,t,10)):TGE.log("***** ERROR: PhoneGap GoogleAnalytics plugin was not found")),this},TGE.GoogleAnalytics.prototype={_gaPlugin:null,logGameEvent:function(e,t,n){try{var r=this.gameName;(e=="pause"||e=="resume")&&t!=null&&t>0&&(r+=" - level "+t.toString());var i="game",s=e,o=r,u=n;this._trackEvent(i,s,o,u)}catch(a){this._logError(a.toString())}},logShareEvent:function(e,t){try{var n=this.gameName;t!=null&&t>0&&(n+=" - level "+t.toString());var r="share",i=e,s=n,o=null;this._trackEvent(r,i,s,o)}catch(u){this._logError(u.toString())}},logLevelEvent:function(e,t,n){try{var r=this.gameName;t!=null&&t>0&&(r+=" - level "+t.toString());var i="level",s=e,o=r,u;if(e=="complete"||e=="fail"&&n!=null)u=n;this._trackEvent(i,s,o,u)}catch(a){this._logError(a.toString())}},logAchievementEvent:function(e,t,n){try{var r=this.gameName;t!=null&&t>0&&(r+=" - level "+t.toString());var i="achievement",s=e,o=r,u=n;this._trackEvent(i,s,o,u)}catch(a){this._logError(a.toString())}},logErrorEvent:function(e){try{var t="error",n=e,r=this.gameName,i=null;this._trackEvent(t,n,r,i)}catch(s){this._logError(s.toString())}},logClickThruEvent:function(e,t){try{var n=this.gameName;t!=null&&t>0&&(n+=" - level "+t.toString());var r="clickthru",i=e,s=n,o=null;this._trackEvent(r,i,s,o)}catch(u){this._logError(u.toString())}},logCustomEvent:function(e,t,n){try{var r=this.gameName;t!=null&&t>0&&(r+=" - level "+t.toString());var i="custom",s=e,o=r,u=n;this._trackEvent(i,s,o,u)}catch(a){this._logError(a.toString())}},_trackEvent:function(e,t,n,r){this._gaPlugin!==null?(typeof r!="number"&&(r=-1),this._gaPlugin.trackEvent(this._logResult,this._logError,e,t,n,r)):_gaq&&_gaq.push(["_trackEvent",e,t,n,r])},_logError:function(e){TGE.log("***** ERROR: TGE.GoogleAnalytics - "+e)},_logResult:function(e){}},extend(TGE.GoogleAnalytics,TGE.Analytics),TGE.ParallaxPane=function(e){TGE.ParallaxPane.superclass.constructor.call(this,e),this.mTrackingSpeed=1,this.mPane1=null,this.mPane2=null,this.mHorizontalOffset=0,this.mWorldY=0},TGE.ParallaxPane.prototype={Setup:function(e,t,n,r){return TGE.ScreenEntity.prototype.Setup.call(this,0,0,null,r),this.mWorldY=e,this.registrationX=0,this.registrationY=0,this.mTrackingSpeed=t,this.mPane1=new TGE.Sprite,this.mPane1.setImage(this.mGame.GetImage(n)),this.addChild(this.mPane1),this.mPane1.x=0,this.mPane1.y=0,this.mPane1.registrationX=0,this.mPane1.registrationY=0,this.mPane2=new TGE.Sprite,this.mPane2.setImage(this.mGame.GetImage(n)),this.addChild(this.mPane2),this.mPane2.x=this.mGame.Width(),this.mPane2.y=0,this.mPane2.registrationX=0,this.mPane2.registrationY=0,this},SetHorizontalOffset:function(e){this.mHorizontalOffset=e},_updateScreenPosition:function(){var e=this.mGame.CameraLocation().x,t=(-e+this.mHorizontalOffset)*this.mTrackingSpeed/this.scaleX,n=this.mGame.Width()/this.scaleX;this.mPane1.x=t%n,this.mPane1.y=this.mGame.ScreenY(this.mWorldY),this.mPane2.x=this.mPane1.x+n,this.mPane2.y=this.mGame.ScreenY(this.mWorldY)}},extend(TGE.ParallaxPane,TGE.ScreenEntity),TGE.VerticalParallaxPane=function(e){TGE.VerticalParallaxPane.superclass.constructor.call(this,e),this.mTrackingSpeed=1,this.mPane1=null,this.mPane2=null,this.mVerticalOffset=0},TGE.VerticalParallaxPane.prototype={Setup:function(e,t,n){return TGE.ScreenEntity.prototype.Setup.call(this,0,0,null,n),this.registrationX=0,this.registrationY=0,this.mTrackingSpeed=e,this.mPane1=new TGE.Sprite,this.mPane1.setImage(this.mGame.GetImage(t)),this.addChild(this.mPane1),this.mPane1.x=0,this.mPane1.y=0,this.mPane1.registrationX=0,this.mPane1.registrationY=0,this.mPane2=new TGE.Sprite,this.mPane2.setImage(this.mGame.GetImage(t)),this.addChild(this.mPane2),this.mPane2.x=0,this.mPane2.y=this.mGame.Height(),this.mPane2.registrationX=0,this.mPane2.registrationY=0,this},_updateScreenPosition:function(){var e=this.mGame.CameraLocation().y,t=(e+this.mVerticalOffset)*this.mTrackingSpeed/this.scaleY,n=this.mGame.Height()/this.scaleY;this.mPane1.x=0,this.mPane1.y=t%n,this.mPane2.x=0,this.mPane2.y=this.mPane1.y-n}},extend(TGE.VerticalParallaxPane,TGE.ScreenEntity),TGE.Advertisement=function(e){this.element=e.element==="undefined"?null:e.element,this.closeCallback=e.closeCallback==="undefined"?null:e.closeCallback},TGE.Advertisement.prototype={close:function(){}},TGE.Advertisement.DisplayAd=function(e){return new TGE.Advertisement({})},TGE.Advertisement.DisplayModalOverlayAd=function(e){},TGE.Advertisement.DisplayChildBrowserAd=function(e){},TGE.Advertisement._CloseAd=function(e,t,n){e.parentNode.removeChild(e),t!==null&&t.call()},TGE.Advertisement._ShowOverlayCloseButtons=function(e){},TGE.Advertisement._BlockEvent=function(e){},TGE.Achievement=function(e,t,n,r){return this._id=e,this._earned=!1,this.name=t,this.description=n,this.imageID=r,this},TGE.Achievement.prototype={_id:null,earned:function(){this._earned=!0},hasBeenEarned:function(){return this._earned},id:function(){return this._id}},TGE.Achievements=function(){return this.lockedIconID=null,this.earnedAchievementCallback=null,this},TGE.Achievements.HigherScoresAreBetter=!0,TGE.Achievements.BestScore=null,TGE.Achievements._FRIENDSTER_API_URL="http://www.littlegrey.net/temp/tresensa/friendster",TGE.Achievements.SubmitScore=function(e){var t=new TGE.Achievements;t.submitScore(e)},TGE.Achievements.ShowAchievementsScreen=function(e){getDistributionPartner()==="A0014"&&typeof MNDirect!="undefined"?TGE.PlayPhoneWrapper.showAchievementsScreen():e.call()},TGE.Achievements.EnableParterUI=function(e){getDistributionPartner()==="A0014"&&(e?TGE.PlayPhoneWrapper.showDashboardButton():TGE.PlayPhoneWrapper.hideDashboardButton())},TGE.Achievements.prototype={_achievements:[],_achievementIDs:[],createAchievement:function(e,t,n,r){this._achievements[e]=new TGE.Achievement(e,t,n,r),this._achievementIDs.push(e)},saveCompletedAchievements:function(){var e="",t=this._achievementIDs.length;for(var n=0;n<t;n++){var r=this.getAchievementAt(n);r.hasBeenEarned()&&(e+=n,e+=" ")}var i="";t=e.length;for(c=0;c<t;c++)e.charAt(c)===" "?i+=Math.floor(Math.random()*10).toString():i+=String.fromCharCode(e.charCodeAt(c)+50);if(i.length>0){var s=new Date,o=999;s.setDate(s.getDate()+o);var u=i+(o==null?"":"; expires="+s.toUTCString());document.cookie="tgeachv1="+u}},loadCompletedAchievements:function(){var e=null,t,n,r,i=document.cookie.split(";");for(t=0;t<i.length;t++)n=i[t].substr(0,i[t].indexOf("=")),r=i[t].substr(i[t].indexOf("=")+1),n=n.replace(/^\s+|\s+$/g,""),n=="tgeachv1"&&(e=r);if(e){var s="";len=e.length;for(c=0;c<len;c++){var o=e.charCodeAt(c);e.charCodeAt(c)<=57?s+=" ":s+=String.fromCharCode(e.charCodeAt(c)-50)}var u=s.split(" ");for(var a=0;a<u.length;a++)u[a].length>0&&this.earnedAchievementAt(parseInt(u[a]),!0)}},clearAchievements:function(){var e=new Date,t=999;e.setDate(e.getDate()+t);var n=""+(t==null?"":"; expires="+e.toUTCString());document.cookie="tgeachv1="+n},numberOfAchievements:function(){return this._achievementIDs.length},getAchievement:function(e){return this._achievements[e]},getAchievementAt:function(e){return this.getAchievement(this._achievementIDs[e])},earnedAchievementAt:function(e,t){this.earnedAchievement(this._achievementIDs[e],t)},earnedAchievement:function(e,t){t=typeof t=="undefined"?!1:t;var n=this._achievements[e];n&&(n.hasBeenEarned()||(n.earned(),!t&&this.earnedAchievementCallback&&this.earnedAchievementCallback.call(null,n),this.submitAchievementToPartner(n,t),this.saveCompletedAchievements()))},submitScore:function(e){var t=!1;TGE.Achievements.BestScore===null?(TGE.Achievements.BestScore=e,t=!1):TGE.Achievements.HigherScoresAreBetter&&e>TGE.Achievements.BestScore?(TGE.Achievements.BestScore=e,t=!0):!TGE.Achievements.HigherScoresAreBetter&&e<TGE.Achievements.BestScore&&(TGE.Achievements.BestScore=e,t=!0);if(getDistributionPartner()==="A0009"&&parent.kongregate)parent.kongregate.stats.submit("highscore",e);else if(getDistributionPartner()==="A0010"){var n=parseInt(getQueryString().user),r=parseInt(getQueryString().hid);if(!isNaN(n)&&!isNaN(r)&&n>0&&r>=0){var i=Sha1.hash(r.toString()+e.toString()+"troisdixchix"+n.toString()),s="http://www.digyourowngrave.com/high_scores/exclusive/auto_submit_score.php?user_id="+n+"&game_id="+r+"&score="+e+"&key="+i,o=document.createElement("img");o.src=s}}else if(getDistributionPartner()==="A0013"){var u=getQueryString().session_key,a=getQueryString().gameName;if(u&&a){var f=new FriendsterSocialLeaderBoard,l={id:getQueryString().user_id,score:e,sessionKey:u,gameName:a};f.AutoSubmitScore(l);if(t){var s=TGE.Achievements._FRIENDSTER_API_URL+"/richwallpost.php?gameName="+a+"&score="+e+"&session_key="+u,o=document.createElement("img");o.src=s}}}else getDistributionPartner()==="A0014"?TGE.PlayPhoneWrapper.submitScore(e):TGE.BrowserDetect.usingPhoneGap&&TGE.BrowserDetect.oniOS},submitAchievementToPartner:function(e,t){if(e)if(getDistributionPartner()==="A0009"&&parent.kongregate)parent.kongregate.stats.submit(e.id(),1);else if(getDistributionPartner()==="A0010"){var n=parseInt(getQueryString().aid),r=parseInt(getQueryString().user);if(!isNaN(n)&&!isNaN(r)&&n>=0&&r>0){var i=this._achievementIDs.indexOf(e.id());if(i>=0){var s=n+i,o=Sha1.hash(s.toString()+"troisdixchix"+r.toString()),u="http://www.digyourowngrave.com/high_scores/exclusive/auto_submit_achievement.php?user_id="+r+"&achievement="+s+"&key="+o,a=document.createElement("img");a.src=u}}}else if(!t&&getDistributionPartner()==="A0013"){var f=getQueryString().session_key,l=getQueryString().gameName;if(f&&l){var c=encodeURIComponent(e.name),u=TGE.Achievements._FRIENDSTER_API_URL+"/richwallpost.php?gameName="+l+"&achv="+c+"&session_key="+f,a=document.createElement("img");a.src=u}}else if(getDistributionPartner()==="A0014"){var i=this._achievementIDs.indexOf(e.id());TGE.PlayPhoneWrapper.achievementEarned(i)}else TGE.BrowserDetect.usingPhoneGap&&TGE.BrowserDetect.oniOS}},FriendsterSocialLeaderBoard.prototype={GetUserDetails:function(e){var t={id:"",sessionKey:0,score:0};e(t)},AutoSubmitScore:function(e){for(var t=0;t<this.loginDetails.length;t++){var n={};n.sParams="",n.sParams+="avatar_id="+e.id,n.sParams+="&session_key="+e.sessionKey,n.sParams+="&game_name="+e.gameName,n.sParams+="&score="+e.score,n.sURL=this.userConfiguration.SERVER_URL+"/FriendSterApp/LeaderBoard",n.requestType="POST",n.callback=function(){},this.sendMessage(n)}},SubmitScore:function(e){var t={};t.sParams="",t.sParams+="avatar_id="+e.id,t.sParams+="&session_key="+e.sessionKey,t.sParams+="&game_name="+this.userConfiguration.GameCode,t.sParams+="&score="+e.score,t.sURL=this.userConfiguration.SERVER_URL+"/FriendSterApp/LeaderBoard",t.requestType="POST",t.callback=e.callback,this.sendMessage(t)},GetLeaderboard:function(e){if(e.id!="undefined"&&e.id!=undefined){var t={};t.sParams="",t.sParams+="avatar_id="+e.id,t.sParams+="&session_key="+e.sessionKey,t.sParams+="&game_name="+this.userConfiguration.GameCode,t.sURL=this.userConfiguration.SERVER_URL+"/FriendSterApp/LeaderBoard?"+t.sParams,t.requestType="GET",t.callback=e.callback,this.sendMessage(t)}else this.userConfiguration.ErrorHandler("backend-error")},sendMessage:function(e,t){var n,r=this,i=e,s=t;if(window.XDomainRequest)this.xdr=new XDomainRequest,this.xdr?(this.xdr.onerror=this.err.bind(this),this.xdr.ontimeout=this.timeo.bind(this),this.xdr.onprogress=this.progres.bind(this),this.xdr.onload=function(){var e=r.xdr.responseText,t=JSON.parse(e);t.Error==undefined&&t.Error==null?(i.callback(t),s!=undefined&&r.updateLoginDetails(t)):r.userConfiguration.ErrorHandler("backend-error")},this.xdr.timeout="2000",this.xdr.open(i.requestType,i.sURL+"?"+i.sParams),this.xdr.send()):this.userConfiguration.ErrorHandler("backend-error");else{window.XMLHttpRequest?n=new XMLHttpRequest:n=new ActiveXObject("Microsoft.XMLHTTP");try{n.onreadystatechange=function(){if(n.readyState==4)if(n.status!=200)r.userConfiguration.ErrorHandler("backend-error");else if(e.callback!=null){var t=JSON.parse(n.responseText);t.Error==undefined&&t.Error==null?(e.callback(t),s!=undefined&&r.updateLoginDetails(t)):r.userConfiguration.ErrorHandler("backend-error")}}}catch(o){this.userConfiguration.ErrorHandler("backend-error")}try{n.open(e.requestType,e.sURL,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send(e.sParams)}catch(o){this.userConfiguration.ErrorHandler("backend-error")}}},err:function(){this.userConfiguration.ErrorHandler("backend-error")},timeo:function(){this.userConfiguration.ErrorHandler("backend-error")},progres:function(){},stopdata:function(){this.abort()},UpdateConfig:function(e){this.userConfiguration.ErrorHandler=e.ErrorHandler,this.userConfiguration.SocialNetwork=String(e.SocialNetwork).toLowerCase()}},TGE.PlayPhoneWrapper={dashboardButton:null,pendingAchievements:[],initialize:function(){if(typeof MNDirect=="undefined"){TGE.log("***** ERROR: PlayPhone SDK was not loaded properly.");return}MNDirect.AppReloadClient.setAppReloadHandler(MNDirect.AppReloadClient.APP_RELOAD_ALLOWED),MNDirect.AppReloadClient.setAppAfterReloadHandler(MNDirect.AppReloadClient.APP_AFTER_RELOAD_AUTO),MNDirectPopup.init(MNDirectPopup.MNDIRECTPOPUP_WELCOME);var e=78100,t="08b10129-d2f5da4f-eb68767e-85df7a2d";MNDirect.init(e,t),MNDirectUIHelper.showDashboard(),MNDirectUIHelper.addEventHandler(MNDirectUIHelper.EventName.onHideDashboard,TGE.PlayPhoneWrapper.onHideDashboard),MNDirect.addEventHandler(MNDirect.EventName.onUserLogin,TGE.PlayPhoneWrapper.onUserLogin),MNDirect.addEventHandler(MNDirect.EventName.onUserLogout,TGE.PlayPhoneWrapper.onUserLogout)},onHideDashboard:function(e){var t=MNDirect.getSession().isUserLoggedIn();t||MNDirectUIHelper.showDashboard()},onUserLogin:function(e){var t=MNDirect.getSession().isUserLoggedIn();if(t){TGE.PlayPhoneWrapper.hideDashboard();if(TGE.PlayPhoneWrapper.pendingAchievements.length>0){for(var n=0;n<TGE.PlayPhoneWrapper.pendingAchievements.length;n++)TGE.PlayPhoneWrapper.achievementEarned(TGE.PlayPhoneWrapper.pendingAchievements[n]);TGE.PlayPhoneWrapper.pendingAchievements=[]}}},onUserLogout:function(e){MNDirectUIHelper.showDashboard()},dashboardButtonClicked:function(e){MNDirect.execAppCommand("jumpToLeaderboard",null),MNDirectUIHelper.showDashboard()},hideDashboard:function(){MNDirectUIHelper.hideDashboard();if(TGE.Game&&TGE.Game.GetInstance()){TGE.Game.GetInstance()._determineCanvasPosition();if(TGE.PlayPhoneWrapper.dashboardButton===null){var e=TGE.Game.GetInstance().mCanvasDiv;TGE.PlayPhoneWrapper.dashboardButton=document.createElement("div");var t=80,n=10,r=TGE.PlayPhoneWrapper.dashboardButton;r.id="playphone_dashboard_button",r.style.position="absolute";var i=n*(TGE.BrowserDetect.isMobileDevice?3:1),s=e.clientWidth-n-t;r.style.top=i.toString()+"px",r.style.left=s.toString()+"px",r.innerHTML="<img src='http://slb.tresensa.com/playphone/dashboard_button.png'>",r.style.cursor="pointer",r.style.zIndex=5,e.insertBefore(r,e.firstChild);var o=TGE.BrowserDetect.isMobileDevice?"touchstart":"click";r.addEventListener(o,TGE.PlayPhoneWrapper.dashboardButtonClicked,!1)}}},showDashboardButton:function(){TGE.PlayPhoneWrapper.dashboardButton!==null&&(TGE.PlayPhoneWrapper.dashboardButton.style.display="block")},hideDashboardButton:function(){TGE.PlayPhoneWrapper.dashboardButton!==null&&(TGE.PlayPhoneWrapper.dashboardButton.style.display="none")},showAchievementsScreen:function(){if(typeof MNDirect=="undefined")return;MNDirect.execAppCommand("jumpToAchievements",null),MNDirectUIHelper.showDashboard()},submitScore:function(e){if(typeof MNDirect=="undefined")return;MNDirect.postGameScore(e)},achievementEarned:function(e){if(typeof MNDirect=="undefined"||typeof MNDirect.getSession()=="undefined"||!MNDirect.getSession().isUserLoggedIn()){TGE.PlayPhoneWrapper.pendingAchievements.push(e);return}var t=e+1,n=function(e){e.hadError()&&TGE.log("***** ERROR: PlayPhone SDK could not unlock achievement id "+t+", "+e.getErrorMessage())};MNDirect.serviceProvider.Achievements.reqCurrUserUnlockAchievement(n,t)}},getDistributionPartner()==="A0014"&&loadScript("http://webui.social.playphone.com/web_mnsapi/MNDirectHost.js.php",TGE.PlayPhoneWrapper.initialize),TGE.PlatformCompatibility=function(){return this},TGE.PlatformCompatibility.prototype={isAudioSupported:function(){var e=document.createElement("audio"),t=!1;try{if(t=!!e.canPlayType)t=new Boolean(t),t.ogg=e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),t.mp3=e.canPlayType("audio/mpeg;").replace(/^no$/,""),t.wav=e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),t.m4a=(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,"")}catch(n){}return t},isAudioFormatSupported:function(e){var t=document.createElement("audio"),n=!1,r;try{if(n=!!t.canPlayType){n=new Boolean(n);switch(e){case"ogg":r=t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"");break;case"mp3":r=t.canPlayType("audio/mpeg;").replace(/^no$/,"");break;case"wav":r=t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"");break;case"m4a":r=(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,"");break;default:}}}catch(i){}return r},isCanvasSupported:function(){var e=document.createElement("canvas");return!!e.getContext&&!!e.getContext("2d")},isVideoSupported:function(){var e=document.createElement("video"),t=!1;try{if(t=!!e.canPlayType)t=new Boolean(t),t.ogg=e.canPlayType('video/ogg; codecs="theora"'),t.h264=e.canPlayType('video/mp4; codecs="avc1.42E01E"'),t.webm=e.canPlayType('video/webm; codecs="vp8, vorbis"')}catch(n){}return t},isDragAndDropSupported:function(){var e=document.createElement("div");return bool="draggable"in e||"ondragstart"in e&&"ondrop"in e,bool},isGeolocationSupported:function(){return!!navigator.geolocation},isWebGlSupported:function(){try{var e=document.createElement("canvas"),t;t=!(!window.WebGLRenderingContext||!e.getContext("experimental-webgl")&&!e.getContext("webgl")),e=undefined}catch(n){t=!1}return t},isHistorySupported:function(){return!!window.history&&!!history.pushState},isVideoSupported:function(){var e=document.createElement("video"),t=!1},isLocalStorageSupported:function(){try{return localStorage.setItem(mod,mod),localStorage.removeItem(mod),!0}catch(e){return!1}},isSessionStorageSupported:function(){try{return sessionStorage.setItem(mod,mod),sessionStorage.removeItem(mod),!0}catch(e){return!1}},isSVGSupported:function(){return ns={svg:"http://www.w3.org/2000/svg"},!!document.createElementNS&&!!document.createElementNS(ns.svg,"svg").createSVGRect}},TGE.DeviceOrientation=function(){return this},TGE.DeviceOrientation.prototype={orientationChangeCallBack:null,RegisterOrientationChange:function(e){TGE.DeviceOrientation.prototype.orientationChangeCallBack=e,window.addEventListener("orientationchange",TGE.DeviceOrientation.prototype.internalOrientationChanged),TGE.DeviceOrientation.prototype.internalOrientationChanged()},internalOrientationChanged:function(){window.orientation===90||window.orientation===-90?TGE.DeviceOrientation.prototype.orientationChangeCallBack("landscape"):TGE.DeviceOrientation.prototype.orientationChangeCallBack("portrait")}};var Sha1={};Sha1.hash=function(e,t){t=typeof t=="undefined"?!0:t,t&&(e=Utf8.encode(e));var n=[1518500249,1859775393,2400959708,3395469782];e+=String.fromCharCode(128);var r=e.length/4+2,i=Math.ceil(r/16),s=new Array(i);for(var o=0;o<i;o++){s[o]=new Array(16);for(var u=0;u<16;u++)s[o][u]=e.charCodeAt(o*64+u*4)<<24|e.charCodeAt(o*64+u*4+1)<<16|e.charCodeAt(o*64+u*4+2)<<8|e.charCodeAt(o*64+u*4+3)}s[i-1][14]=(e.length-1)*8/Math.pow(2,32),s[i-1][14]=Math.floor(s[i-1][14]),s[i-1][15]=(e.length-1)*8&4294967295;var a=1732584193,f=4023233417,l=2562383102,c=271733878,h=3285377520,p=new Array(80),d,v,m,g,y;for(var o=0;o<i;o++){for(var b=0;b<16;b++)p[b]=s[o][b];for(var b=16;b<80;b++)p[b]=Sha1.ROTL(p[b-3]^p[b-8]^p[b-14]^p[b-16],1);d=a,v=f,m=l,g=c,y=h;for(var b=0;b<80;b++){var w=Math.floor(b/20),E=Sha1.ROTL(d,5)+Sha1.f(w,v,m,g)+y+n[w]+p[b]&4294967295;y=g,g=m,m=Sha1.ROTL(v,30),v=d,d=E}a=a+d&4294967295,f=f+v&4294967295,l=l+m&4294967295,c=c+g&4294967295,h=h+y&4294967295}return Sha1.toHexStr(a)+Sha1.toHexStr(f)+Sha1.toHexStr(l)+Sha1.toHexStr(c)+Sha1.toHexStr(h)},Sha1.f=function(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:return t^n^r;case 2:return t&n^t&r^n&r;case 3:return t^n^r}},Sha1.ROTL=function(e,t){return e<<t|e>>>32-t},Sha1.toHexStr=function(e){var t="",n;for(var r=7;r>=0;r--)n=e>>>r*4&15,t+=n.toString(16);return t};var Utf8={};Utf8.encode=function(e){var t=e.replace(/[\u0080-\u07ff]/g,function(e){var t=e.charCodeAt(0);return String.fromCharCode(192|t>>6,128|t&63)});return t=t.replace(/[\u0800-\uffff]/g,function(e){var t=e.charCodeAt(0);return String.fromCharCode(224|t>>12,128|t>>6&63,128|t&63)}),t},Utf8.decode=function(e){var t=e.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(e){var t=(e.charCodeAt(0)&15)<<12|(e.charCodeAt(1)&63)<<6|e.charCodeAt(2)&63;return String.fromCharCode(t)});return t=t.replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(e){var t=(e.charCodeAt(0)&31)<<6|e.charCodeAt(1)&63;return String.fromCharCode(t)}),t};var CWTween={ato:[],bu:!1,bpt:0,pause:function(e){if(e)this.bpt==0&&(this.bpt=Date.now());else if(this.bpt!=0){var t=Date.now()-this.bpt;for(var n in this.ato)this.ato[n]._startTime+=t;this.bpt=0,this.bu||requestAnimFrame(this.uf.bind(this))}},removeAll:function(){for(var e in this.ato)this.ato.splice(e,1)},remove:function(e){for(var t in this.ato)if(this.ato[t]._targetObj==e){this.ato.splice(t,1);return}},to:function(e,t,n,r){this.remove(e);var i={};i._targetObj=e,i._duration=t*1e3,i._startTime=Date.now(),i._Data={};for(var s in n){if(n[s]===null)continue;i._Data[s]=[e[s],n[s]]}r&&(r.hasOwnProperty("onComplete")&&(i._cbk=r.onComplete),r.hasOwnProperty("ease")&&(i._ef=CWTween.Easing[r.ease.name][r.ease.hasOwnProperty("type")?r.ease.type:"In"],i._ep=this.PEV(r.ease)),r.hasOwnProperty("delay")&&(i._delay=r.delay*1e3),r.hasOwnProperty("reverse")&&(i._rvr=r.reverse)),!this.bu&&this.bpt===0&&(requestAnimFrame(this.uf.bind(this)),this.bu=!0),this.ato.push(i)},uf:function(){if(this.ato.length>0&&this.bpt==0){requestAnimFrame(this.uf.bind(this)),this.time=Date.now();var e,t,n,r;for(var i in this.ato){t=this.ato[i];if(t._targetObj.MarkedForRemoval()==1)this.ato.splice(i,1);else if(t.hasOwnProperty("_delay"))e=(this.time-t._startTime)/t._delay,e>1&&(delete t._delay,t._startTime=Date.now());else{e=(this.time-t._startTime)/t._duration,e>1?r=e=1:t.hasOwnProperty("_ef")?r=t._ef(e,t._ep):r=e;for(var s in t._Data)t._targetObj[s]=Math.round((t._Data[s][0]+(t._Data[s][1]-t._Data[s][0])*r)*100)/100;if(e==1)if(t.hasOwnProperty("_rvr")){var o;for(var s in t._Data)o=t._Data[s][0],t._Data[s][0]=t._Data[s][1],t._Data[s][1]=o;t._startTime=Date.now(),t._rvr--,t._rvr==0&&delete t._rvr}else this.ato.splice(i,1),t.hasOwnProperty("_cbk")&&t._cbk()}}}else this.bu=!1},PEV:function(e){var t;switch(e.name){case"Back":t=e.hasOwnProperty("params")?e.params:1.70158;break;case"Elastic":t=e.hasOwnProperty("params")?e.params:1;break;default:t=0}return t}};CWTween.Easing={Back:{In:function(e,t){return e*e*((t+1)*e-t)},Out:function(e,t){return(e-=1)*e*((t+1)*e+t)+1},InOut:function(e,t){var n=t*1.525;return(e*=2)<1?.5*e*e*((n+1)*e-n):.5*((e-=2)*e*((n+1)*e+n)+2)}},Bounce:{In:function(e){return 1-CWTween.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?CWTween.Easing.Bounce.In(e*2)*.5:CWTween.Easing.Bounce.Out(e*2-1)*.5+.5}},Elastic:{In:function(e,t){return-(t*Math.pow(2,10*(e-=1))*Math.sin((e-.3/(2*Math.PI)*(Math.asin(1/t)||0))*2*Math.PI/.3))},Out:function(e,t){return t*Math.pow(2,-10*e)*Math.sin((e-.3/(2*Math.PI)*(Math.asin(1/t)||0))*2*Math.PI/.3)+1},InOut:function(e,t){var n=.3/(2*Math.PI)*(Math.asin(1/t)||0),r=2*Math.PI;return(e*=2)<1?-0.5*t*Math.pow(2,10*(e-=1))*Math.sin((e-n)*r/.45):t*Math.pow(2,-10*(e-=1))*Math.sin((e-n)*r/.45)*.5+1}},Exponential:{In:function(e){return Math.pow(2,10*(e-1))-.001},Out:function(e){return 1-Math.pow(2,-10*e)},InOut:function(e){return(e*=2)<1?.5*Math.pow(2,10*(e-1)):.5*(2-Math.pow(2,-10*(e-1)))}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-0.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-0.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-0.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}}};function BlackJack(){var e=new Font;e.fontFamily="Berlin Sans FB Demi",e.src="font/BRLNSDB.TTF",TGE.Game.call(this),this.mAnalytics=new TGE.GoogleAnalytics("BlackJack");var t=[{id:"splashBackground",url:"image/splash.jpg"},{id:"playBtn",url:"image/playBtn.png"},{id:"gameBackground",url:"image/gamebg.jpg"},{id:"loadingBG",url:"image/loadingbg.jpg"},{id:"loadingSpr",url:"image/loadingSprite.png"},{id:"cwlogo",url:"image/cwlogo.png"},{id:"tresensalogo",url:"image/tresensalogo.png"}],n=[{id:"dealBtn",url:"image/dealbutton.png"},{id:"hitBtn",url:"image/hitBtn.png"},{id:"clearBtn",url:"image/clearBtn.png"},{id:"standBtn",url:"image/standbutton.png"},{id:"minusBtn",url:"image/minusbutton.png"},{id:"plusBtn",url:"image/plusbutton.png"},{id:"creditBtn",url:"image/creditbutton.png"},{id:"bust",url:"image/bust.png"},{id:"win",url:"image/win.png"},{id:"push",url:"image/push.png"},{id:"blackjack",url:"image/blackjack.png"},{id:"winStar",url:"image/winStarSprite.png"},{id:"dealerTxt",url:"image/dealer.png"},{id:"playerTxt",url:"image/player.png"},{id:"blank",url:"image/blank.png"},{id:"popup",url:"image/popup.png"},{id:"okBtn",url:"image/okBtn.png"},{id:"soundOn",url:"image/soundon.png"},{id:"soundOff",url:"image/soundoff.png"},{id:"gameoverBG",url:"image/gameoverbg.png"},{id:"fbBtn",url:"image/facebookbutton.png"},{id:"tweetBtn",url:"image/twitterbutton.png"},{id:"playagain",url:"image/playagain.png"},{id:"instBtn",url:"image/instructionsbtn.png"},{id:"instBG",url:"image/instructionbg.png"},{id:"instructions",url:"image/instructions.png"},{id:"scoretable",url:"image/minimumscoretable.png"},{id:"nextBtn",url:"image/nextbutton.png"},{id:"previousBtn",url:"image/previousbutton.png"},{id:"closeBtn",url:"image/close.png"},{id:"levelupBG",url:"image/levelupbg.jpg"},{id:"nextLevel",url:"image/nextlevel.png"},{id:"retrylevelBtn",url:"image/retrylevel.png"},{id:"cardBack",url:"image/cardBack.png"}],r=[];this.gameBackground=null,this.dealBtn=null,this.hitBtn=null,this.standBtn=null,this.creditBtn=null,this.popup=null,this.okBtn=null,this.insufficientBetMessage1=null,this.insufficientBetMessage2=null,this.popupText1=null,this.popupText2=null,this.popupText3=null,this.playerScore=0,this.dealerScore=0,this.totalScore=0,this.playerScoreText=null,this.dealerScoreText=null,this.playerAceCount=0,this.dealerAceCount=0,this.isPlayerHasAce=!1,this.isDealaerHasAce=!1,this.currentRoundOver=!1,this.playerCreditsAmt=10,this.playerCreditsText=null,this.playerWinAmt=0,this.playerWinText=null,this.betAllowed=!1,this.betAmount=1,this.betAmountText=null,this.plusBtn=null,this.minusBtn=null,this.dealButtonClickedFirstTime=!1,this.gameEndTimer=0,this.bonusAmt=0,this.chanceCount=3,this.chanceCountText=null,this.levelCount=1,this.levelCountText=null,this.levelupClicked=!1,this.hitClickedAllowed=!0,this.winnerInfo={player:{bust:!1,win:!1,blackjack:!1},dealer:{bust:!1,win:!1,blackjack:!1}},this.gameLogic={1:{range:3,minScore:9},2:{range:5,minScore:12},3:{range:7,minScore:18},4:{range:9,minScore:24},5:{range:10,minScore:27}},this.resultCoord={player:{x:349,y:110},dealer:{x:775,y:82}},this.endAnimation={playerPush:null,dealerPush:null,bustText:null,winText:null,blackjackText:null,starSpriteAnimation:null,blackjackText:null},this.cardObj=new Card(this),this.cardDeckObj=new CardDeck,this.cardDeckObj.initializeCardDeck();var i=n.concat(this.cardDeckObj.cardImages),s=i.concat(r);this.assetManager.assignImageAssetList("loading",t),this.assetManager.assignImageAssetList("required",s),this.assetManager.rootLocation="",this.mAdServerURL="http://adserver.adtechus.com/adiframe/3.0/5421.1/2748182/0/170/ADTECH;target=_blank",this.mAdServerURL+=";key="+getDistributionPartner(),this.mAdServerURL+=";kvenv="+encodeURIComponent(TGE.BrowserDetect.platform)}function Card(e){this.gameObj=e,this.playerIntialCoordinates={x:165,y:198},this.dealerInitialCoordinates={x:598,y:162},this.dealerBackCard=null,this.playerCardsArr=new Array,this.dealerCardsArr=new Array}function GameOver(e){return TGE.Screen.call(this,e),this.gameBG,this.nAdd,this.fbBtn,this.score,this.tweeBtn,this}function InstructionsScreen(e){return TGE.Screen.call(this,e),this.instScrnBg=null,this.closeBtn=null,this}function LevelupScreen(e){TGE.Screen.call(this,e),this.nAdd=null}function LoadingScreen(e){return TGE.Screen.call(this,e),this.mLoadingText=null,this.loadingSprite,this}function MainMenu(e){return TGE.Screen.call(this,e),this}function PauseScreen(e){return TGE.Screen.call(this,e),this}var CardDeck=function(){this.CardSuit=[],this.CardRank=[],this.RandomCardList=[],this.serialNumArr=[],this.NumberOfDecks=1,this.cardHack=[0,10,11,12,13,23,24,25,26,36,37,38,39,49,50,51],this.cardImages=[{id:"spades1",url:"image/1s.png"},{id:"spades2",url:"image/2s.png"},{id:"spades3",url:"image/3s.png"},{id:"spades4",url:"image/4s.png"},{id:"spades5",url:"image/5s.png"},{id:"spades6",url:"image/6s.png"},{id:"spades7",url:"image/7s.png"},{id:"spades8",url:"image/8s.png"},{id:"spades9",url:"image/9s.png"},{id:"spades10",url:"image/10s.png"},{id:"spades11",url:"image/js.png"},{id:"spades12",url:"image/qs.png"},{id:"spades13",url:"image/ks.png"},{id:"clubs1",url:"image/1c.png"},{id:"clubs2",url:"image/2c.png"},{id:"clubs3",url:"image/3c.png"},{id:"clubs4",url:"image/4c.png"},{id:"clubs5",url:"image/5c.png"},{id:"clubs6",url:"image/6c.png"},{id:"clubs7",url:"image/7c.png"},{id:"clubs8",url:"image/8c.png"},{id:"clubs9",url:"image/9c.png"},{id:"clubs10",url:"image/10c.png"},{id:"clubs11",url:"image/jc.png"},{id:"clubs12",url:"image/qc.png"},{id:"clubs13",url:"image/ks.png"},{id:"hearts1",url:"image/1h.png"},{id:"hearts2",url:"image/2h.png"},{id:"hearts3",url:"image/3h.png"},{id:"hearts4",url:"image/4h.png"},{id:"hearts5",url:"image/5h.png"},{id:"hearts6",url:"image/6h.png"},{id:"hearts7",url:"image/7h.png"},{id:"hearts8",url:"image/8h.png"},{id:"hearts9",url:"image/9h.png"},{id:"hearts10",url:"image/10h.png"},{id:"hearts11",url:"image/jh.png"},{id:"hearts12",url:"image/qh.png"},{id:"hearts13",url:"image/kh.png"},{id:"diamonds1",url:"image/1d.png"},{id:"diamonds2",url:"image/2d.png"},{id:"diamonds3",url:"image/3d.png"},{id:"diamonds4",url:"image/4d.png"},{id:"diamonds5",url:"image/5d.png"},{id:"diamonds6",url:"image/6d.png"},{id:"diamonds7",url:"image/7d.png"},{id:"diamonds8",url:"image/8d.png"},{id:"diamonds9",url:"image/9d.png"},{id:"diamonds10",url:"image/10d.png"},{id:"diamonds11",url:"image/jd.png"},{id:"diamonds12",url:"image/qd.png"},{id:"diamonds13",url:"image/kd.png"}]};CardDeck.prototype={initializeCardDeck:function(){for(var e=0;e<51;e++)this.serialNumArr[e]=e+1},RandomCardGenerator:function(e){var t=Math.ceil(Math.random()*this.serialNumArr.length-1),n=this.serialNumArr[t];return this.serialNumArr.splice(t,1),n},GetCardRankNSuit:function(e){var t,n;e<14?t="spades":e>13&&e<27?t="clubs":e>26&&e<40?t="hearts":e>39&&(t="diamonds"),e%13==0?n=13:n=e%13,this.CardSuit=t,this.CardRank=n},ResetDeck:function(){this.CardSuit=[],this.CardRank=[],this.serialNumArr=[],this.initializeCardDeck(),this.NumberOfDecks=1}},BlackJack.prototype.subclassStartPlaying=function(){this.gameBackground=this.CreateUIEntity(TGE.ScreenEntity).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.5),"gameBackground",this.mScreenManager.mLayerName),this.blankImgdealer=this.CreateUIEntity(TGE.ScreenEntity).Setup(642,35,"blank",this.mScreenManager.mLayerName),this.dealerTxt=this.CreateUIEntity(TGE.ScreenEntity).Setup(646,75,"dealerTxt",this.mScreenManager.mLayerName),this.playerTxt=this.CreateUIEntity(TGE.ScreenEntity).Setup(220,112,"playerTxt",this.mScreenManager.mLayerName),this.blankImgplayer=this.CreateUIEntity(TGE.ScreenEntity).Setup(205,70,"blank",this.mScreenManager.mLayerName),this.standBtn=this.CreateUIEntity(TGE.Button).Setup(445,400,"standBtn",BlackJack.prototype.standBtnClicked.bind(this),3,this.mScreenManager.mLayerName),this.standBtn.mouseEnabled=!1,this.dealBtn=this.CreateUIEntity(TGE.Button).Setup(572,400,"dealBtn",BlackJack.prototype.dealBtnClicked.bind(this),3,this.mScreenManager.mLayerName),this.dealBtn.mouseEnabled=!1,this.hitBtn=this.CreateUIEntity(TGE.Button).Setup(572,400,"hitBtn",BlackJack.prototype.hitButtonClicked.bind(this,"player"),3,this.mScreenManager.mLayerName),this.hitBtn.visible=!1,this.playerScoreText=this.CreateUIEntity(TGE.Text).Setup(205,70,null,"20px Copperplate Gothic Light","center","middle","white",this.mScreenManager.mLayerName),this.dealerScoreText=this.CreateUIEntity(TGE.Text).Setup(641,36,null,"20px Copperplate Gothic Light","center","middle","white",this.mScreenManager.mLayerName),this.betAmountText=this.CreateUIEntity(TGE.Text).Setup(531,501,this.betAmount,"20px Copperplate Gothic Light","center","middle","white",this.mScreenManager.mLayerName),this.playerCreditsText=this.CreateUIEntity(TGE.Text).Setup(185,501,""+this.playerCreditsAmt,"20px Copperplate Gothic Light","center","middle","white",this.mScreenManager.mLayerName),this.playerWinText=this.CreateUIEntity(TGE.Text).Setup(870,501,""+this.playerWinAmt,"20px Copperplate Gothic Light","center","middle","white",this.mScreenManager.mLayerName),this.levelCountText=this.CreateUIEntity(TGE.Text).Setup(845,465,"级数: "+this.levelCount,"20px Copperplate Gothic Light","center","middle","white",this.mScreenManager.mLayerName),this.chanceCountText=this.CreateUIEntity(TGE.Text).Setup(115,465,"剩余回合: "+this.chanceCount,"20px Copperplate Gothic Light","center","middle","white",this.mScreenManager.mLayerName),this.plusBtn=this.CreateUIEntity(TGE.Button).Setup(293,495,"plusBtn",BlackJack.prototype.increaseBet.bind(this),2,this.mScreenManager.mLayerName),this.minusBtn=this.CreateUIEntity(TGE.Button).Setup(670,495,"minusBtn",BlackJack.prototype.decreaseBet.bind(this),2,this.mScreenManager.mLayerName),this.instructionsBtn=this.CreateUIEntity(TGE.Button).Setup(935,362,"instBtn",BlackJack.prototype.instScreen.bind(this),2,this.mScreenManager.mLayerName),this.popup=this.CreateUIEntity(TGE.ScreenEntity).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.48),"popup",this.mScreenManager.mLayerName),this.insufficientBetMessage1=this.CreateUIEntity(TGE.Text).Setup(this.mScreenManager.XFromPercentage(.5),220,"The bet exceeds your credit.","18px Copperplate Gothic Light","center","middle","white",this.mScreenManager.mLayerName),this.insufficientBetMessage1.visible=!1,this.insufficientBetMessage2=this.CreateUIEntity(TGE.Text).Setup(this.mScreenManager.XFromPercentage(.5035),250,"Reduce the bet to continue.","18px Copperplate Gothic Light","center","middle","white",this.mScreenManager.mLayerName),this.insufficientBetMessage2.visible=!1,this.okBtn=this.CreateUIEntity(TGE.Button).Setup(this.mScreenManager.XFromPercentage(.5),310,"okBtn",BlackJack.prototype.popupScreenOkBtnClicked.bind(this),2,this.mScreenManager.mLayerName),this.popupText1=this.CreateUIEntity(TGE.Text).Setup(this.mScreenManager.XFromPercentage(.5035),200,"级别: "+this.levelCount,"30px Copperplate Gothic Light","center","middle","white",this.mScreenManager.mLayerName),this.popupText2=this.CreateUIEntity(TGE.Text).Setup(this.mScreenManager.XFromPercentage(.5035),235,"最少过关筹码: "+this.gameLogic[this.levelCount].minScore,"20px Copperplate Gothic Light","center","middle","white",this.mScreenManager.mLayerName),this.popupText3=this.CreateUIEntity(TGE.Text).Setup(this.mScreenManager.XFromPercentage(.5035),265,"局数: "+this.chanceCount,"20px Copperplate Gothic Light","center","middle","white",this.mScreenManager.mLayerName)},BlackJack.prototype.showPopup=function(){this.popup.visible=!0,this.okBtn.visible=!0,this.popupText1.text="级别: "+this.levelCount,this.popupText2.text="最少过关筹码: "+this.gameLogic[this.levelCount].minScore,this.popupText3.text="回合数: "+this.chanceCount,this.popupText1.visible=!0,this.popupText2.visible=!0,this.popupText3.visible=!0,this.betAllowed=!1,this.standBtn.mouseEnabled=!1,this.hitBtn.mouseEnabled=!1,this.dealBtn.mouseEnabled=!1},BlackJack.prototype.popupScreenOkBtnClicked=function(){this.playAudioFile("buttonSound"),this.popup.visible=!1,this.okBtn.visible=!1,this.insufficientBetMessage1.visible=!1,this.insufficientBetMessage2.visible=!1,this.standBtn.mouseEnabled=!0,this.hitBtn.mouseEnabled=!0,this.dealBtn.mouseEnabled=!0,this.betAllowed=!0,this.popupText1.visible=!1,this.popupText2.visible=!1,this.popupText3.visible=!1},BlackJack.prototype.instScreen=function(){this.playAudioFile("buttonSound"),this.ShowScreen(InstructionsScreen)},BlackJack.prototype.increaseBet=function(){this.betAllowed&&(this.playAudioFile("betSound"),this.betAmount++,this.gameLogic[this.levelCount].range<this.betAmount&&(this.betAmount=this.gameLogic[this.levelCount].range),this.betAmountText.text=this.betAmount)},BlackJack.prototype.decreaseBet=function(){this.betAllowed&&(this.playAudioFile("betSound"),this.betAmount--,this.betAmount<=1&&(this.betAmount=1),this.betAmountText.text=this.betAmount)},BlackJack.prototype.dealBtnClicked=function(){this.checkValidBetAmount()&&(this.betAllowed=!0,this.dealBtn.visible=!1,this.hitBtn.visible=!0,this.dealButtonClickedFirstTime||(this.playAudioFile("buttonSound"),this.standBtn.mouseEnabled=!1,this.dealBtn.mouseEnabled=!1,this.hitBtn.mouseEnabled=!1,this.hitClickedAllowed=!1,this.betAllowed=!1,this.playerWinAmt=0,this.setWinAmt(),this.playerCreditsAmt-=this.betAmount,this.setCreditAmt(),this.cardObj.generatePushCard("player"),this.cardObj.generatePushCard("player"),this.cardObj.generatePushCard("dealer"),this.cardObj.generatePushCard("dealer"),this.cardObj.playCardAnimation("startingCardAnim",null),this.dealButtonClickedFirstTime=!0))},BlackJack.prototype.hitButtonClicked=function(e){if(this.hitClickedAllowed&&!this.winnerInfo.player.bust&&!this.winnerInfo.dealer.bust)this.dealButtonClickedFirstTime&&(this.playAudioFile("buttonSound"),this.standBtn.mouseEnabled=!1,this.dealBtn.mouseEnabled=!1,this.hitBtn.mouseEnabled=!1,this.hitClickedAllowed=!1,this.betAllowed=!1,this.currentRoundOver?(this.beginNewRound(),this.levelCountText.text="Level: "+this.levelCount,this.chanceCountText.text="Turns Left: "+this.chanceCount,this.levelupClicked==0&&this.hitButtonClicked("player")):(this.cardObj.generatePushCard(e),this.cardObj.playCardAnimation("singleCardAnim",e)));else{if(!this.currentRoundOver)return!1;this.playAudioFile("buttonSound"),this.beginNewRound(),this.levelCountText.text="Level: "+this.levelCount,this.chanceCountText.text="Turns Left: "+this.chanceCount,this.levelupClicked==0&&this.hitButtonClicked("player")}},BlackJack.prototype.standBtnClicked=function(){var e=0;if(this.dealButtonClickedFirstTime==0||!this.hitClickedAllowed)return 0;if(!this.currentRoundOver){this.playAudioFile("buttonSound");while(this.playAllDealerCards())this.cardObj.generatePushCard("dealer");this.cardObj.playCardAnimation("dealerCardAnimEnd","dealer")}},BlackJack.prototype.beginNewRound=function(){this.hitBtn.setImage("hitBtn",1,3),this.hitBtn.setSpriteIndex(0),this.dealBtn.visible=!0,this.hitBtn.visible=!1,this.closeAnim(),this.standBtn.mouseEnabled=!0,this.dealBtn.mouseEnabled=!0,this.hitBtn.mouseEnabled=!0,this.hitClickedAllowed=!0,this.currentRoundOver=!1,this.betAllowed=!0,this.resetRoundData()},BlackJack.prototype.resetRoundData=function(){this.winnerInfo={player:{bust:!1,win:!1,blackjack:!1},dealer:{bust:!1,win:!1,blackjack:!1}},this.dealButtonClickedFirstTime=!1,this.playerScore=0,this.dealerScore=0,this.playerAceCount=0,this.dealerAceCount=0,this.playerWinAmt=0,this.setWinAmt(),this.gameEndTimer=0,this.isPlayerHasAce=!1,this.isDealaerHasAce=!1,this.playerScoreText.text="",this.dealerScoreText.text="",this.chanceCount--,this.chanceCountText.text="剩余回合: "+this.chanceCount,this.cardObj.resetCardData(),this.cardDeckObj.ResetDeck()},BlackJack.prototype.setWinAmt=function(){this.playerWinText.text=this.playerWinAmt},BlackJack.prototype.setCreditAmt=function(){this.playerCreditsText.text=this.playerCreditsAmt},BlackJack.prototype.setBonusAmt=function(e){var t=this.betAmount*.5;e?this.bonusAmt+=t:this.bonusAmt-=t},BlackJack.prototype.resetLevelData=function(){this.chanceCount=4,this.playerCreditsAmt=10,this.betAmount=1,this.betAmountText.text=this.betAmount,this.setCreditAmt(),this.levelCountText.text="level : "+this.levelCount,this.bonusAmt=0},BlackJack.prototype.validateWinAmount=function(){var e=this.playerCreditsAmt+this.bonusAmt;return e>=this.gameLogic[this.levelCount].minScore?!0:!1},BlackJack.prototype.subclassUpdateGame=function(e){if(this.chanceCount==1&&this.currentRoundOver==1||this.currentRoundOver==1&&this.playerCreditsAmt==0){this.hitBtn.mouseEnabled=!1,this.standBtn.mouseEnabled=!1,this.gameEndTimer+=e;if(Math.floor(this.gameEndTimer)==3){var t=this.validateWinAmount();t?(this.totalScore+=this.playerCreditsAmt,this.totalScore+=this.bonusAmt,this.levelCount==5?(this.beginNewRound(),this.EndGame()):(this.levelupClicked=!0,this.ShowScreen(LevelupScreen),this.levelCount++,this.resetLevelData(),this.beginNewRound())):(this.levelupClicked=!0,this.ShowScreen(LevelupScreen),this.resetLevelData(),this.beginNewRound())}}},BlackJack.prototype.subclassMouseDown=function(){},BlackJack.prototype.subclassMouseMove=function(){},BlackJack.prototype.subclassMouseUp=function(){},BlackJack.prototype.playAllDealerCards=function(){var e=this.dealerScore;if(e==21)return!1;if(e>=17)return!1;if(e<17)return!0},BlackJack.prototype.checkWinner=function(){if(this.playerScore>this.dealerScore){this.winnerInfo.player.bust=!1,this.winnerInfo.player.win=!0,this.currentRoundOver=!0,this.betAllowed=!0;var e=this.playerCreditsAmt;this.winnerInfo.player.blackjack==1?this.playerCreditsAmt+=this.betAmount+this.betAmount*1.5:this.playerCreditsAmt+=this.betAmount*2,this.setCreditAmt(),this.playerWinAmt=this.playerCreditsAmt-e,this.setWinAmt()}else this.playerScore<this.dealerScore?(this.winnerInfo.dealer.bust=!1,this.winnerInfo.dealer.win=!0,this.currentRoundOver=!0,this.betAllowed=!0):this.playerScore==this.dealerScore&&(this.winnerInfo.player.bust=!1,this.winnerInfo.player.win=!0,this.winnerInfo.dealer.bust=!1,this.winnerInfo.dealer.win=!0,this.currentRoundOver=!0,this.betAllowed=!0,this.playerCreditsAmt+=this.betAmount,this.setCreditAmt())},BlackJack.prototype.checkBust=function(e){if(this.currentRoundOver)return 0;var t=e=="dealer"?this.dealerScore:this.playerScore;if(t>21){this.winnerInfo[e].bust=!0;if(e=="player")this.winnerInfo.dealer.win=!0;else if(e=="dealer"){var n=this.playerCreditsAmt;this.playerCreditsAmt+=this.betAmount*2,this.setCreditAmt(),this.playerWinAmt=this.playerCreditsAmt-n,this.setWinAmt(),this.winnerInfo.player.win=!0}return this.cardObj.dealerBackCard.markForRemoval(),this.cardObj.dealerBackCard=null,this.cardObj.dealerCardsArr[0].visible=!0,this.currentRoundOver=!0,this.betAllowed=!0,!0}return!1},BlackJack.prototype.checkForBlackJack=function(){var e=!1;return this.currentRoundOver&&(e=!1),this.playerScore==21&&this.cardObj.playerCardsArr.length==2&&(this.winnerInfo.player.win=!0,this.winnerInfo.player.bust=!1,this.winnerInfo.player.blackjack=!0,this.currentRoundOver=!0,this.betAllowed=!0,this.setBonusAmt(!0),e=!0),this.dealerScore==21&&this.cardObj.dealerCardsArr.length==2&&(this.winnerInfo.dealer.win=!0,this.winnerInfo.dealer.bust=!1,this.winnerInfo.dealer.blackjack=!0,this.currentRoundOver=!0,this.betAllowed=!0,e=!0),e},BlackJack.prototype.setCustomScore=function(e,t){e=parseInt(e),t=="player"?e>10?this.setUserScore(10):e==1?(this.playerAceCount=this.playerAceCount+1,this.playerAceCount==1?(this.isPlayerHasAce=!0,this.setUserScore(11)):this.setUserScore(1)):this.setUserScore(e):t=="dealer"&&(e>10?this.setOpponentScore(10):e==1?(this.dealerAceCount=this.dealerAceCount+1,this.dealerAceCount==1?(this.isDealaerHasAce=!0,this.setOpponentScore(11)):this.setOpponentScore(1)):this.setOpponentScore(e))},BlackJack.prototype.setUserScore=function(e){var t=0;t=this.playerScore+e,this.isPlayerHasAce&&t>21&&(this.isPlayerHasAce=!1,t-=10),this.playerScore=t},BlackJack.prototype.setOpponentScore=function(e){var t=0;t=this.dealerScore+e,this.isDealaerHasAce&&t>21&&(this.isDealaerHasAce=!1,t-=10),this.dealerScore=t},BlackJack.prototype.checkValidBetAmount=function(){var e=!1;return this.betAmount>this.playerCreditsAmt?(this.displayInsufficientBetMessage(),e=!1):e=!0,e},BlackJack.prototype.displayInsufficientBetMessage=function(){this.popup.visible=!0,this.insufficientBetMessage1.visible=!0,this.insufficientBetMessage2.visible=!0,this.dealBtn.mouseEnabled=!1,this.hitBtn.mouseEnabled=!1,this.standBtn.mouseEnabled=!1,this.okBtn.visible=!0},BlackJack.prototype.playAudioFile=function(e){this.audioManager.Play({id:e,loop:!1})},BlackJack.prototype.resetValue=function(){this.ClearScene(),this.dealBtn=null,this.hitBtn=null,this.standBtn=null,this.creditBtn=null,this.popup=null,this.okBtn=null,this.popupText1=null,this.popupText2=null,this.popupText3=null,this.playerScore=0,this.dealerScore=0,this.totalScore=0,this.playerScoreText=null,this.dealerScoreText=null,this.playerAceCount=0,this.dealerAceCount=0,this.isPlayerHasAce=!1,this.isDealaerHasAce=!1,this.currentRoundOver=!1,this.playerCreditsAmt=10,this.playerCreditsText=null,this.playerWinAmt=0,this.playerWinText=null,this.betAllowed=!0,this.betAmount=1,this.betAmountText=null,this.plusBtn=null,this.minusBtn=null,this.dealButtonClickedFirstTime=!1,this.gameEndTimer=0,this.bonusAmt=0,this.chanceCount=3,this.chanceCountText=null,this.levelCount=1,this.levelCountText=null,this.levelupClicked=!1,this.hitClickedAllowed=!0,this.cardObj=new Card(this),this.cardDeckObj=new CardDeck,this.cardDeckObj.initializeCardDeck()},BlackJack.prototype.showResultAnimation=function(e,t){switch(t){case"push":this.endAnimation.playerPush=this.CreateUIEntity(TGE.ScreenEntity).Setup(this.resultCoord.player.x,this.resultCoord.player.y,t,this.mScreenManager.mLayerName),this.endAnimation.playerPush.LoadAnimation("push",t,4,5,18,17,!0),this.endAnimation.playerPush.PlayAnimation("push"),this.endAnimation.dealerPush=this.CreateUIEntity(TGE.ScreenEntity).Setup(this.resultCoord.dealer.x,this.resultCoord.dealer.y,t,this.mScreenManager.mLayerName),this.endAnimation.dealerPush.LoadAnimation("push",t,4,5,18,17,!0),this.endAnimation.dealerPush.PlayAnimation("push");break;case"win":this.endAnimation.winText=this.CreateUIEntity(TGE.ScreenEntity).Setup(this.resultCoord[e].x,this.resultCoord[e].y-20,null,this.mScreenManager.mLayerName),this.endAnimation.winText.LoadAnimation("win",t,6,6,34,17,!0),this.endAnimation.winText.PlayAnimation("win");break;case"bust":this.endAnimation.bustText=this.CreateUIEntity(TGE.ScreenEntity).Setup(this.resultCoord[e].x,this.resultCoord[e].y,null,this.mScreenManager.mLayerName),this.endAnimation.bustText.LoadAnimation("bust",t,4,5,18,17,!0),this.endAnimation.bustText.PlayAnimation("bust");break;case"blackjack":this.endAnimation.blackjackText=this.CreateUIEntity(TGE.ScreenEntity).Setup(this.resultCoord[e].x+42,this.resultCoord[e].y+42,null,this.mScreenManager.mLayerName),this.endAnimation.blackjackText.LoadAnimation("blackjack",t,4,5,18,17,!0),this.endAnimation.blackjackText.PlayAnimation("blackjack");default:}},BlackJack.prototype.closeAnim=function(){for(var e in this.endAnimation)this.endAnimation[e]!=null&&(this.endAnimation[e].markForRemoval(),this.endAnimation[e]=null)},BlackJack.prototype.muteAudio=function(){this.playaudioBtn.visible=!1,this.muteAudioBtn.visible=!0,this.audioManager.Mute()},BlackJack.prototype.unmuteAudio=function(){this.muteAudioBtn.visible=!1,this.playaudioBtn.visible=!0,this.audioManager.Unmute()},extend(BlackJack,TGE.Game),Card.prototype.generatePushCard=function(e){var t=this.gameObj.cardDeckObj.RandomCardGenerator(1);this.gameObj.cardDeckObj.GetCardRankNSuit(t);var n=t,r=this.gameObj.cardDeckObj.CardSuit,i=this.gameObj.cardDeckObj.CardRank,s=this.gameObj.CreateUIEntity(TGE.ScreenEntity).Setup(this.gameObj.mScreenManager.XFromPercentage(.5),this.gameObj.mScreenManager.YFromPercentage(.5),r+i,this.gameObj.mScreenManager.mLayerName);s.scoreValue=n%13>10||n%13==0?10:n%13,s.visible=!1;var o=0,u=0;if(e=="player")this.playerCardsArr.push(s),o=this.playerIntialCoordinates.x+(27*this.playerCardsArr.length-1),u=this.playerIntialCoordinates.y+(14*this.playerCardsArr.length-1),s.x=o,s.y=u,this.gameObj.setCustomScore(s.scoreValue,e);else{this.dealerCardsArr.push(s),this.dealerCardsArr.length==1&&(this.dealerBackCard=this.gameObj.CreateUIEntity(TGE.ScreenEntity).Setup(this.gameObj.mScreenManager.XFromPercentage(1),this.gameObj.mScreenManager.YFromPercentage(0),"cardBack",this.gameObj.mScreenManager.mLayerName),this.dealerBackCard.visible=!1),o=this.dealerInitialCoordinates.x+(27*this.dealerCardsArr.length-1),u=this.dealerInitialCoordinates.y+(14*this.dealerCardsArr.length-1),s.x=o,s.y=u,this.gameObj.setCustomScore(s.scoreValue,e);if(this.dealerCardsArr.length==2){var a=this.gameObj.dealerScore-s.scoreValue;this.gameObj.checkForBlackJack()}}this.gameObj.checkBust(e)},Card.prototype.resetCardData=function(){for(var e=0;e<this.playerCardsArr.length;e++)this.playerCardsArr[e].markForRemoval();for(var e=0;e<this.dealerCardsArr.length;e++)this.dealerCardsArr[e].markForRemoval();this.dealerBackCard!=null&&(this.dealerBackCard.markForRemoval(),this.dealerBackCard=null),this.playerCardsArr=new Array,this.dealerCardsArr=new Array},Card.prototype.playCardAnimation=function(e,t){var n=null;if(e=="startingCardAnim"){var r=this.gameObj.winnerInfo.player.blackjack==1||this.gameObj.winnerInfo.dealer.blackjack==1;this.dealerBackCard!=null&&(this.dealerBackCard.visible=!0),n=this.gameObj.CreateUIEntity(TGE.ScreenEntity).Setup(this.gameObj.mScreenManager.XFromPercentage(1),this.gameObj.mScreenManager.YFromPercentage(0),"cardBack",this.gameObj.mScreenManager.mLayerName),this.gameObj.playAudioFile("cardDraw"),CWTween.to(n,.3,{x:this.playerCardsArr[0].x,y:this.playerCardsArr[0].y},{delay:0,onComplete:this.cardAnimationEnd.bind(this,"player",0,n)}),r?n=this.gameObj.CreateUIEntity(TGE.ScreenEntity).Setup(this.gameObj.mScreenManager.XFromPercentage(1),this.gameObj.mScreenManager.YFromPercentage(0),"cardBack",this.gameObj.mScreenManager.mLayerName):n=null,CWTween.to(r?n:this.dealerBackCard,.3,{x:this.dealerCardsArr[0].x,y:this.dealerCardsArr[0].y},{delay:.5,onComplete:this.cardAnimationEnd.bind(this,"dealer",0,n)}),n=this.gameObj.CreateUIEntity(TGE.ScreenEntity).Setup(this.gameObj.mScreenManager.XFromPercentage(1),this.gameObj.mScreenManager.YFromPercentage(0),"cardBack",this.gameObj.mScreenManager.mLayerName),CWTween.to(n,.3,{x:this.playerCardsArr[1].x,y:this.playerCardsArr[1].y},{delay:1,onComplete:this.cardAnimationEnd.bind(this,"player",1,n)}),n=this.gameObj.CreateUIEntity(TGE.ScreenEntity).Setup(this.gameObj.mScreenManager.XFromPercentage(1),this.gameObj.mScreenManager.YFromPercentage(0),"cardBack",this.gameObj.mScreenManager.mLayerName),CWTween.to(n,.3,{x:this.dealerCardsArr[1].x,y:this.dealerCardsArr[1].y},{delay:1.5,onComplete:this.cardAnimationEnd.bind(this,"dealer",1,n,!0)}),this.gameObj.dealerScoreText.text=this.dealerCardsArr[1].scoreValue,this.gameObj.dealerScoreText.Hide()}else if(e=="singleCardAnim"){var i=-1;n=this.gameObj.CreateUIEntity(TGE.ScreenEntity).Setup(this.gameObj.mScreenManager.XFromPercentage(1),this.gameObj.mScreenManager.YFromPercentage(0),"cardBack",this.gameObj.mScreenManager.mLayerName),t=="dealer"?(i=this.dealerCardsArr.length-1,CWTween.to(n,.3,{x:this.dealerCardsArr[i].x,y:this.dealerCardsArr[i].y},{delay:0,onComplete:this.cardAnimationEnd.bind(this,t,i,n,!0)})):(i=this.playerCardsArr.length-1,CWTween.to(n,.3,{x:this.playerCardsArr[i].x,y:this.playerCardsArr[i].y},{delay:0,onComplete:this.cardAnimationEnd.bind(this,t,i,n,!0)}))}else if(e=="dealerCardAnimEnd"){this.dealerBackCard!=null&&(this.dealerBackCard.markForRemoval(),this.dealerBackCard=null),this.dealerCardsArr[0].visible=!0,this.dealerCardsArr[1].visible=!0;var s=0;if(this.dealerCardsArr.length==2)this.gameObj.standBtn.mouseEnabled=!0,this.gameObj.dealBtn.mouseEnabled=!0,this.gameObj.hitBtn.mouseEnabled=!0,this.gameObj.hitClickedAllowed=!0,this.gameObj.checkForBlackJack()||this.gameObj.checkWinner(),this.playWinAnimation(),this.gameObj.dealerScoreText.text=this.gameObj.dealerScore;else for(var o=2;o<=this.dealerCardsArr.length-1;o++)n=this.gameObj.CreateUIEntity(TGE.ScreenEntity).Setup(this.gameObj.mScreenManager.XFromPercentage(1),this.gameObj.mScreenManager.YFromPercentage(0),"cardBack",this.gameObj.mScreenManager.mLayerName),CWTween.to(n,.3,{x:this.dealerCardsArr[o].x,y:this.dealerCardsArr[o].y},{delay:s,onComplete:this.dealerCardAnimationEnd.bind(this,o,n,o==this.dealerCardsArr.length-1?!0:!1)}),s+=.5}},Card.prototype.dealerCardAnimationEnd=function(e,t,n){t!=null&&t.markForRemoval(),this.dealerCardsArr[e].visible=!0,this.gameObj.playAudioFile("cardDraw"),n&&(this.gameObj.checkForBlackJack()||this.gameObj.currentRoundOver||this.gameObj.checkWinner(),this.playWinAnimation(),this.gameObj.standBtn.mouseEnabled=!0,this.gameObj.dealBtn.mouseEnabled=!0,this.gameObj.hitBtn.mouseEnabled=!0,this.gameObj.hitClickedAllowed=!0,this.gameObj.dealerScoreText.visible=!0,this.gameObj.dealerScoreText.text=this.gameObj.dealerScore)},Card.prototype.cardAnimationEnd=function(e,t,n,r){r&&(this.playWinAnimation(),this.gameObj.standBtn.mouseEnabled=!0,this.gameObj.dealBtn.mouseEnabled=!0,this.gameObj.hitBtn.mouseEnabled=!0,this.gameObj.hitClickedAllowed=!0),n!=null&&(n.markForRemoval(),n=null),this.gameObj.playAudioFile("cardDraw"),e=="player"?(t>1&&(this.gameObj.playerScoreText.text=this.gameObj.playerScore),this.playerCardsArr[t].visible=!0,this.gameObj.playerScore==21&&this.playerCardsArr.length>2&&(this.gameObj.checkWinner(),this.playWinAnimation())):(this.dealerCardsArr[t].visible=!0,t==1&&(this.gameObj.playerScoreText.text=this.gameObj.playerScore,this.gameObj.dealerScoreText.Show()))},Card.prototype.playWinAnimation=function(){var e="none";this.gameObj.winnerInfo.player.blackjack&&this.gameObj.winnerInfo.dealer.blackjack&&(this.gameObj.setBonusAmt(!1),this.gameObj.checkWinner());if(this.gameObj.winnerInfo.player.bust==0&&this.gameObj.winnerInfo.player.win==1&&this.gameObj.winnerInfo.dealer.bust==0&&this.gameObj.winnerInfo.dealer.win==1)return this.gameObj.showResultAnimation(null,"push"),e="push",this.gameObj.playAudioFile("pushSound"),this.gameObj.dealerScore==21&&this.dealerCardsArr.length==2&&(this.gameObj.dealerScoreText.text=this.gameObj.dealerScore),this.gameObj.hitBtn.setImage("clearBtn",1,3),this.gameObj.hitBtn.setSpriteIndex(0),1;this.gameObj.winnerInfo.player.win&&(this.gameObj.showResultAnimation("player","win"),e="player",this.gameObj.playerScore==21&&this.dealerBackCard!=null&&(this.gameObj.dealerScoreText.text=this.gameObj.dealerScore,this.dealerCardsArr[0].visible=!0,this.dealerBackCard.markForRemoval(),this.dealerBackCard=null),this.gameObj.winnerInfo.player.blackjack?this.gameObj.playAudioFile("blackjackSound"):this.gameObj.playAudioFile("handwin")),this.gameObj.winnerInfo.dealer.win&&(this.gameObj.playAudioFile("bustSound"),this.gameObj.showResultAnimation("dealer","win"),e="dealer"),this.gameObj.winnerInfo.player.blackjack&&(this.gameObj.showResultAnimation("player","blackjack"),this.gameObj.checkWinner(),e="player"),this.gameObj.winnerInfo.dealer.blackjack&&(this.gameObj.showResultAnimation("dealer","blackjack"),this.gameObj.checkWinner(),e="dealer"),this.gameObj.winnerInfo.player.bust&&(this.gameObj.playAudioFile("bustSound"),this.dealerBackCard!=null&&(this.dealerBackCard.markForRemoval(),this.dealerBackCard=null),this.dealerCardsArr[0].visible=!0,this.gameObj.dealerScoreText.text=this.gameObj.dealerScore,this.gameObj.showResultAnimation("player","bust"),e="player"),this.gameObj.winnerInfo.dealer.bust&&(this.gameObj.showResultAnimation("dealer","bust"),e="dealer"),e=="push"&&(this.gameObj.playerScoreText.text=this.gameObj.playerScore,this.gameObj.dealerScoreText.text=this.gameObj.dealerScore),e=="player"&&(this.gameObj.playerScoreText.text=this.gameObj.playerScore),e=="dealer"&&(this.gameObj.dealerScoreText.text=this.gameObj.dealerScore),e=="none"?(this.gameObj.hitBtn.setImage("hitBtn",1,3),this.gameObj.hitBtn.setSpriteIndex(0)):(this.gameObj.hitBtn.setImage("clearBtn",1,3),this.gameObj.hitBtn.setSpriteIndex(0))},GameOver.prototype=new TGE.Screen,GameOver.prototype.constructor=GameOver,GameOver.prototype.Setup=function(){this.score=this.Game().totalScore.toString(),this.gameBG=this.CreateUIEntity(TGE.ScreenEntity).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.5),"gameoverBG",this.mScreenManager.mLayerName),this.gameBG.mouseEnabled=!0,this.gameBG.MouseUp=function(){},this.gameBG.MouseDown=function(){};var e=document.getElementById("game_canvas");this.CreateUIEntity(TGE.Text).Setup(440,170,"Total Credits For All the Levels: "+this.score,"Bold 35px Copperplate Gothic Light","center","middle","white",this.mScreenManager.mLayerName),this.CreateUIEntity(TGE.Button).Setup(470,246,"playagain",GameOver.prototype.playAgain.bind(this),2,this.mScreenManager.mLayerName),this.nAdd=TGE.Advertisement.DisplayAd({parentDiv:e,adURL:this.Game().mAdServerURL,adWidth:300,adHeight:254,x:640,y:266}),this.tweeBtn=this.CreateUIEntity(TGE.Button).Setup(290,452,"tweetBtn",this.socialNetWorkTwitter.bind(this),1,this.mScreenManager.mLayerName),this.fbBtn=this.CreateUIEntity(TGE.Button).Setup(299,357,"fbBtn",this.socialNetWorkFacebook.bind(this),1,this.mScreenManager.mLayerName),this.tweeBtn.Hide(),this.fbBtn.Hide();switch(this.Game().mQueryString){case"twitter":this.tweeBtn.Show();break;case"facebook":this.fbBtn.Show();break;case"none":break;case"both":default:this.tweeBtn.Show(),this.fbBtn.Show()}var t=this.Game().totalScore;this.Game().AnalyticAchievementEvent("score",t)},GameOver.prototype.playAgain=function(){this.Game().playAudioFile("buttonSound"),this.Game().resetValue(),this.nAdd.close(),this.Game().Replay(),this.Close()},GameOver.prototype.triggerLeaderboard=function(e){var t=new LeaderBoardWidgetConfig;t.lbWidgetConfig.GAME.TRY_AGAIN_METHOD=this.playAgain.bind(this),t.lbWidgetConfig.GAME.LB_TYPE=e,t.lbWidgetConfig.GAME.GAME_SCORE=this.score,this.Game().mLeaderboardWidget.ShowLeaderboard(t.lbWidgetConfig)},GameOver.prototype.socialNetWorkTwitter=function(){this.nAdd!=null&&this.nAdd.close(),this.triggerLeaderboard("twitter")},GameOver.prototype.socialNetWorkFacebook=function(){this.nAdd!==null&&this.nAdd.close(),this.triggerLeaderboard("facebook")},InstructionsScreen.prototype=new TGE.Screen,InstructionsScreen.prototype.constructor=InstructionsScreen,InstructionsScreen.prototype.Setup=function(){this.instScrnBg=this.CreateUIEntity(TGE.ScreenEntity).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.5),"instBG",this.mScreenManager.mLayerName),this.instScrnBg.mouseEnabled=!0,this.previousBtn=this.CreateUIEntity(TGE.Button).Setup(690,480,"previousBtn",InstructionsScreen.prototype.showInstructions.bind(this),2,this.mScreenManager.mLayerName),this.previousBtn.visible=!1,this.nextBtn=this.CreateUIEntity(TGE.Button).Setup(690,480,"nextBtn",InstructionsScreen.prototype.showScoreTable.bind(this),2,this.mScreenManager.mLayerName),this.ruleTxt=this.CreateUIEntity(TGE.ScreenEntity).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.5),"instructions",this.mScreenManager.mLayerName),this.closeBtn=this.CreateUIEntity(TGE.Button).Setup(752,90,"closeBtn",InstructionsScreen.prototype.closeCurrentScreen.bind(this),2,this.mScreenManager.mLayerName)},InstructionsScreen.prototype.showScoreTable=function(){this.Game().playAudioFile("buttonSound"),this.nextBtn.visible=!1,this.previousBtn.visible=!0,this.ruleTxt.setImage("scoretable",1,1),this.closeBtn1=this.CreateUIEntity(TGE.Button).Setup(752,90,"closeBtn",InstructionsScreen.prototype.closeCurrentScreen.bind(this),2,this.mScreenManager.mLayerName)},InstructionsScreen.prototype.showInstructions=function(){this.Game().playAudioFile("buttonSound"),this.nextBtn.visible=!0,this.previousBtn.visible=!1,this.ruleTxt.setImage("instructions",1,1)},InstructionsScreen.prototype.closeCurrentScreen=function(){this.Game().playAudioFile("buttonSound"),this.Close()},LevelupScreen.prototype=new TGE.Screen,LevelupScreen.prototype.constructor=LevelupScreen,LevelupScreen.prototype.Setup=function(){this.levelupBg=this.CreateUIEntity(TGE.ScreenEntity).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.5),"levelupBG",this.mScreenManager.mLayerName),this.levelupBg.mouseEnabled=!0,this.levelupBg.MouseUp=function(){},this.levelupBg.MouseDown=function(){};var e=document.getElementById("game_canvas");this.nAdd=TGE.Advertisement.DisplayAd({parentDiv:e,adURL:this.Game().mAdServerURL,adWidth:300,adHeight:254,x:580,y:156});var t=this.Game().playerCreditsAmt+this.Game().bonusAmt;t>=this.Game().gameLogic[this.Game().levelCount].minScore?(this.Game().playAudioFile("winSound"),this.CreateUIEntity(TGE.Text).Setup(250,200,"第 "+this.Game().levelCount+" 关通过","65px Akzidenz Grotesk BE Cn","center","middle","#99D8F2",this.mScreenManager.mLayerName),this.CreateUIEntity(TGE.Text).Setup(230,280,"筹码: "+this.Game().playerCreditsAmt,"Bold 35px Copperplate Gothic Light","center","middle","white",this.mScreenManager.mLayerName),this.CreateUIEntity(TGE.Text).Setup(230,330,"奖励: "+this.Game().bonusAmt,"Bold 35px Copperplate Gothic Light","center","middle","white",this.mScreenManager.mLayerName),this.CreateUIEntity(TGE.Text).Setup(230,380,"总共: "+t,"Bold 45px Copperplate Gothic Light","center","middle","white",this.mScreenManager.mLayerName),this.CreateUIEntity(TGE.Button).Setup(230,460,"nextLevel",LevelupScreen.prototype.navigateLevel.bind(this),2,this.mScreenManager.mLayerName)):(this.Game().playAudioFile("loseLevel"),this.CreateUIEntity(TGE.Text).Setup(250,170,"第 "+this.Game().levelCount+" 关失败","65px Akzidenz Grotesk BE Cn","center","middle","#99D8F2",this.mScreenManager.mLayerName),this.CreateUIEntity(TGE.Text).Setup(250,250,"获得筹码: "+this.Game().playerCreditsAmt,"Bold 35px Copperplate Gothic Light","center","middle","white",this.mScreenManager.mLayerName),this.CreateUIEntity(TGE.Text).Setup(250,300,"最少过关筹码: "+this.Game().gameLogic[this.Game().levelCount].minScore,"Bold 35px Copperplate Gothic Light","center","middle","white",this.mScreenManager.mLayerName),this.CreateUIEntity(TGE.Button).Setup(245,375,"retrylevelBtn",LevelupScreen.prototype.navigateLevel.bind(this),2,this.mScreenManager.mLayerName))},LevelupScreen.prototype.navigateLevel=function(){this.Game().playAudioFile("buttonSound"),this.Game().levelupClicked=!1,this.nAdd.close(),this.Close(),this.Game().showPopup()},LoadingScreen.prototype=new TGE.Screen,LoadingScreen.prototype.constructor=LoadingScreen,LoadingScreen.prototype.Setup=function(){this.CreateUIEntity(TGE.ScreenEntity).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.5),"loadingBG",this.mScreenManager.mLayerName),this.CreateUIEntity(TGE.ScreenEntity).Setup(100,50,"cwlogo",this.mScreenManager.mLayerName),this.CreateUIEntity(TGE.ScreenEntity).Setup(900,70,"tresensalogo",this.mScreenManager.mLayerName),this.loadingSprite=this.CreateUIEntity(TGE.ScreenEntity).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.4),null,this.mScreenManager.mLayerName),this.loadingSprite.LoadAnimation("loadingSpr","loadingSpr",4,4,16,16,!0),this.mLoadingText=this.CreateUIEntity(TGE.Text).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.5),"努力加载中 0%","30px Berlin Sans FB Demi","center","middle","#DDF7FF",this.mScreenManager.mLayerName)},LoadingScreen.prototype.UpdateProgress=function(e){this.loadingSprite.PlayAnimation("loadingSpr");var t="努力加载中   "+Math.round(e*100).toString()+"%";this.mLoadingText.text=t},MainMenu.prototype=new TGE.Screen,MainMenu.prototype.constructor=MainMenu,MainMenu.prototype.Setup=function(){var e=new Font;e.fontFamily="Copperplate Gothic Light",e.src="font/Copperplate-Gothic-Light-Regular.ttf";var t=new Font;t.fontFamily="Akzidenz Grotesk BE Cn",t.src="font/AKZIDENZGROTESKBE-BOLDCN.OTF",this.FillBackground("#FFF"),this.CreateUIEntity(TGE.ScreenEntity).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.5),"splashBackground",this.mScreenManager.mLayerName),this.playBtn=this.CreateUIEntity(TGE.Button).Setup(this.mScreenManager.XFromPercentage(.5),this.mScreenManager.YFromPercentage(.916),"playBtn",MainMenu.prototype.playBtnClicked.bind(this),2,this.mScreenManager.mLayerName)},MainMenu.prototype.playBtnClicked=function(){this.Game().playAudioFile("buttonSound"),this.Close(),this.Game().StartPlaying()},PauseScreen.prototype=new TGE.Screen,PauseScreen.prototype.constructor=PauseScreen,PauseScreen.prototype.Setup=function(){this.Game().PauseGame(!1)};(function(){var e=Math,t=function(e){return e>>0},n=/webkit/i.test(navigator.appVersion)?"webkit":/firefox/i.test(navigator.userAgent)?"Moz":/trident/i.test(navigator.userAgent)?"ms":"opera"in window?"O":"",r=/android/gi.test(navigator.appVersion),i=/iphone|ipad/gi.test(navigator.appVersion),s=/playbook/gi.test(navigator.appVersion),o=/hp-tablet/gi.test(navigator.appVersion),u="WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix,a="ontouchstart"in window&&!o,f=n+"Transform"in document.documentElement.style,l=i||s,c=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,1)}}(),h=function(){return window.cancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}(),p="onorientationchange"in window?"orientationchange":"resize",d=a?"touchstart":"mousedown",v=a?"touchmove":"mousemove",m=a?"touchend":"mouseup",g=a?"touchcancel":"mouseup",y=n=="Moz"?"DOMMouseScroll":"mousewheel",b="translate"+(u?"3d(":"("),w=u?",0)":")",E=function(e,t){var s=this,o=document,c;s.wrapper=typeof e=="object"?e:o.getElementById(e),s.wrapper.style.overflow="hidden",s.scroller=s.wrapper.children[0],s.options={hScroll:!0,vScroll:!0,x:0,y:0,bounce:!0,bounceLock:!1,momentum:!0,lockDirection:!0,useTransform:!0,useTransition:!1,topOffset:0,checkDOMChanges:!1,hScrollbar:!0,vScrollbar:!0,fixedScrollbar:r,hideScrollbar:i,fadeScrollbar:i&&u,scrollbarClass:"",zoom:!1,zoomMin:1,zoomMax:4,doubleTapZoom:2,wheelAction:"scroll",snap:!1,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(e){e.preventDefault()},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,onZoomEnd:null};for(c in t)s.options[c]=t[c];s.x=s.options.x,s.y=s.options.y,s.options.useTransform=f?s.options.useTransform:!1,s.options.hScrollbar=s.options.hScroll&&s.options.hScrollbar,s.options.vScrollbar=s.options.vScroll&&s.options.vScrollbar,s.options.zoom=s.options.useTransform&&s.options.zoom,s.options.useTransition=l&&s.options.useTransition,s.options.zoom&&r&&(b="translate(",w=")"),s.scroller.style[n+"TransitionProperty"]=s.options.useTransform?"-"+n.toLowerCase()+"-transform":"top left",s.scroller.style[n+"TransitionDuration"]="0",s.scroller.style[n+"TransformOrigin"]="0 0",s.options.useTransition&&(s.scroller.style[n+"TransitionTimingFunction"]="cubic-bezier(0.33,0.66,0.66,1)"),s.options.useTransform?s.scroller.style[n+"Transform"]=b+s.x+"px,"+s.y+"px"+w:s.scroller.style.cssText+=";position:absolute;top:"+s.y+"px;left:"+s.x+"px",s.options.useTransition&&(s.options.fixedScrollbar=!0),s.refresh(),s._bind(p,window),s._bind(d),a||(s._bind("mouseout",s.wrapper),s.options.wheelAction!="none"&&s._bind(y)),s.options.checkDOMChanges&&(s.checkDOMTime=setInterval(function(){s._checkDOMChanges()},500))};E.prototype={enabled:!0,x:0,y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,handleEvent:function(e){var t=this;switch(e.type){case d:if(!a&&e.button!==0)return;t._start(e);break;case v:t._move(e);break;case m:case g:t._end(e);break;case p:t._resize();break;case y:t._wheel(e);break;case"mouseout":t._mouseout(e);break;case"webkitTransitionEnd":t._transitionEnd(e)}},_checkDOMChanges:function(){if(this.moved||this.zoomed||this.animating||this.scrollerW==this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale)return;this.refresh()},_scrollbar:function(r){var i=this,s=document,o;if(!i[r+"Scrollbar"]){i[r+"ScrollbarWrapper"]&&(f&&(i[r+"ScrollbarIndicator"].style[n+"Transform"]=""),i[r+"ScrollbarWrapper"].parentNode.removeChild(i[r+"ScrollbarWrapper"]),i[r+"ScrollbarWrapper"]=null,i[r+"ScrollbarIndicator"]=null);return}i[r+"ScrollbarWrapper"]||(o=s.createElement("div"),i.options.scrollbarClass?o.className=i.options.scrollbarClass+r.toUpperCase():o.style.cssText="position:absolute;z-index:100;"+(r=="h"?"height:7px;bottom:1px;left:2px;right:"+(i.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(i.hScrollbar?"7":"2")+"px;top:2px;right:1px"),o.style.cssText+=";pointer-events:none;-"+n+"-transition-property:opacity;-"+n+"-transition-duration:"+(i.options.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+(i.options.hideScrollbar?"0":"1"),i.wrapper.appendChild(o),i[r+"ScrollbarWrapper"]=o,o=s.createElement("div"),i.options.scrollbarClass||(o.style.cssText="position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);-"+n+"-background-clip:padding-box;-"+n+"-box-sizing:border-box;"+(r=="h"?"height:100%":"width:100%")+";-"+n+"-border-radius:3px;border-radius:3px"),o.style.cssText+=";pointer-events:none;-"+n+"-transition-property:-"+n+"-transform;-"+n+"-transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);-"+n+"-transition-duration:0;-"+n+"-transform:"+b+"0,0"+w,i.options.useTransition&&(o.style.cssText+=";-"+n+"-transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)"),i[r+"ScrollbarWrapper"].appendChild(o),i[r+"ScrollbarIndicator"]=o),r=="h"?(i.hScrollbarSize=i.hScrollbarWrapper.clientWidth,i.hScrollbarIndicatorSize=e.max(t(i.hScrollbarSize*i.hScrollbarSize/i.scrollerW),8),i.hScrollbarIndicator.style.width=i.hScrollbarIndicatorSize+"px",i.hScrollbarMaxScroll=i.hScrollbarSize-i.hScrollbarIndicatorSize,i.hScrollbarProp=i.hScrollbarMaxScroll/i.maxScrollX):(i.vScrollbarSize=i.vScrollbarWrapper.clientHeight,i.vScrollbarIndicatorSize=e.max(t(i.vScrollbarSize*i.vScrollbarSize/i.scrollerH),8),i.vScrollbarIndicator.style.height=i.vScrollbarIndicatorSize+"px",i.vScrollbarMaxScroll=i.vScrollbarSize-i.vScrollbarIndicatorSize,i.vScrollbarProp=i.vScrollbarMaxScroll/i.maxScrollY),i._scrollbarPos(r,!0)},_resize:function(){var e=this;setTimeout(function(){e.refresh()},r?200:0)},_pos:function(e,r){e=this.hScroll?e:0,r=this.vScroll?r:0,this.options.useTransform?this.scroller.style[n+"Transform"]=b+e+"px,"+r+"px"+w+" scale("+this.scale+")":(e=t(e),r=t(r),this.scroller.style.left=e+"px",this.scroller.style.top=r+"px"),this.x=e,this.y=r,this._scrollbarPos("h"),this._scrollbarPos("v")},_scrollbarPos:function(e,r){var i=this,s=e=="h"?i.x:i.y,o;if(!i[e+"Scrollbar"])return;s=i[e+"ScrollbarProp"]*s,s<0?(i.options.fixedScrollbar||(o=i[e+"ScrollbarIndicatorSize"]+t(s*3),o<8&&(o=8),i[e+"ScrollbarIndicator"].style[e=="h"?"width":"height"]=o+"px"),s=0):s>i[e+"ScrollbarMaxScroll"]&&(i.options.fixedScrollbar?s=i[e+"ScrollbarMaxScroll"]:(o=i[e+"ScrollbarIndicatorSize"]-t((s-i[e+"ScrollbarMaxScroll"])*3),o<8&&(o=8),i[e+"ScrollbarIndicator"].style[e=="h"?"width":"height"]=o+"px",s=i[e+"ScrollbarMaxScroll"]+(i[e+"ScrollbarIndicatorSize"]-o))),i[e+"ScrollbarWrapper"].style[n+"TransitionDelay"]="0",i[e+"ScrollbarWrapper"].style.opacity=r&&i.options.hideScrollbar?"0":"1",i[e+"ScrollbarIndicator"].style[n+"Transform"]=b+(e=="h"?s+"px,0":"0,"+s+"px")+w},_start:function(t){var r=this,i=a?t.touches[0]:t,s,o,u,f,l;if(!r.enabled)return;r.options.onBeforeScrollStart&&r.options.onBeforeScrollStart.call(r,t),(r.options.useTransition||r.options.zoom)&&r._transitionTime(0),r.moved=!1,r.animating=!1,r.zoomed=!1,r.distX=0,r.distY=0,r.absDistX=0,r.absDistY=0,r.dirX=0,r.dirY=0,r.options.zoom&&a&&t.touches.length>1&&(f=e.abs(t.touches[0].pageX-t.touches[1].pageX),l=e.abs(t.touches[0].pageY-t.touches[1].pageY),r.touchesDistStart=e.sqrt(f*f+l*l),r.originX=e.abs(t.touches[0].pageX+t.touches[1].pageX-r.wrapperOffsetLeft*2)/2-r.x,r.originY=e.abs(t.touches[0].pageY+t.touches[1].pageY-r.wrapperOffsetTop*2)/2-r.y,r.options.onZoomStart&&r.options.onZoomStart.call(r,t));if(r.options.momentum){r.options.useTransform?(s=getComputedStyle(r.scroller,null)[n+"Transform"].replace(/[^0-9-.,]/g,"").split(","),o=s[4]*1,u=s[5]*1):(o=getComputedStyle(r.scroller,null).left.replace(/[^0-9-]/g,"")*1,u=getComputedStyle(r.scroller,null).top.replace(/[^0-9-]/g,"")*1);if(o!=r.x||u!=r.y)r.options.useTransition?r._unbind("webkitTransitionEnd"):h(r.aniTime),r.steps=[],r._pos(o,u)}r.absStartX=r.x,r.absStartY=r.y,r.startX=r.x,r.startY=r.y,r.pointX=i.pageX,r.pointY=i.pageY,r.startTime=t.timeStamp||Date.now(),r.options.onScrollStart&&r.options.onScrollStart.call(r,t),r._bind(v),r._bind(m),r._bind(g)},_move:function(t){var r=this,i=a?t.touches[0]:t,s=i.pageX-r.pointX,o=i.pageY-r.pointY,u=r.x+s,f=r.y+o,l,c,h,p=t.timeStamp||Date.now();r.options.onBeforeScrollMove&&r.options.onBeforeScrollMove.call(r,t);if(r.options.zoom&&a&&t.touches.length>1){l=e.abs(t.touches[0].pageX-t.touches[1].pageX),c=e.abs(t.touches[0].pageY-t.touches[1].pageY),r.touchesDist=e.sqrt(l*l+c*c),r.zoomed=!0,h=1/r.touchesDistStart*r.touchesDist*this.scale,h<r.options.zoomMin?h=.5*r.options.zoomMin*Math.pow(2,h/r.options.zoomMin):h>r.options.zoomMax&&(h=2*r.options.zoomMax*Math.pow(.5,r.options.zoomMax/h)),r.lastScale=h/this.scale,u=this.originX-this.originX*r.lastScale+this.x,f=this.originY-this.originY*r.lastScale+this.y,this.scroller.style[n+"Transform"]=b+u+"px,"+f+"px"+w+" scale("+h+")",r.options.onZoom&&r.options.onZoom.call(r,t);return}r.pointX=i.pageX,r.pointY=i.pageY;if(u>0||u<r.maxScrollX)u=r.options.bounce?r.x+s/2:u>=0||r.maxScrollX>=0?0:r.maxScrollX;if(f>r.minScrollY||f<r.maxScrollY)f=r.options.bounce?r.y+o/2:f>=r.minScrollY||r.maxScrollY>=0?r.minScrollY:r.maxScrollY;r.distX+=s,r.distY+=o,r.absDistX=e.abs(r.distX),r.absDistY=e.abs(r.distY);if(r.absDistX<6&&r.absDistY<6)return;r.options.lockDirection&&(r.absDistX>r.absDistY+5?(f=r.y,o=0):r.absDistY>r.absDistX+5&&(u=r.x,s=0)),r.moved=!0,r._pos(u,f),r.dirX=s>0?-1:s<0?1:0,r.dirY=o>0?-1:o<0?1:0,p-r.startTime>300&&(r.startTime=p,r.startX=r.x,r.startY=r.y),r.options.onScrollMove&&r.options.onScrollMove.call(r,t)},_end:function(r){if(a&&r.touches.length!=0)return;var i=this,s=a?r.changedTouches[0]:r,o,u,f={dist:0,time:0},l={dist:0,time:0},c=(r.timeStamp||Date.now())-i.startTime,h=i.x,p=i.y,d,y,E,S,x;i._unbind(v),i._unbind(m),i._unbind(g),i.options.onBeforeScrollEnd&&i.options.onBeforeScrollEnd.call(i,r);if(i.zoomed){x=i.scale*i.lastScale,x=Math.max(i.options.zoomMin,x),x=Math.min(i.options.zoomMax,x),i.lastScale=x/i.scale,i.scale=x,i.x=i.originX-i.originX*i.lastScale+i.x,i.y=i.originY-i.originY*i.lastScale+i.y,i.scroller.style[n+"TransitionDuration"]="200ms",i.scroller.style[n+"Transform"]=b+i.x+"px,"+i.y+"px"+w+" scale("+i.scale+")",i.zoomed=!1,i.refresh(),i.options.onZoomEnd&&i.options.onZoomEnd.call(i,r);return}if(!i.moved){a&&(i.doubleTapTimer&&i.options.zoom?(clearTimeout(i.doubleTapTimer),i.doubleTapTimer=null,i.options.onZoomStart&&i.options.onZoomStart.call(i,r),i.zoom(i.pointX,i.pointY,i.scale==1?i.options.doubleTapZoom:1),i.options.onZoomEnd&&setTimeout(function(){i.options.onZoomEnd.call(i,r)},200)):i.doubleTapTimer=setTimeout(function(){i.doubleTapTimer=null,o=s.target;while(o.nodeType!=1)o=o.parentNode;o.tagName!="SELECT"&&o.tagName!="INPUT"&&o.tagName!="TEXTAREA"&&(u=document.createEvent("MouseEvents"),u.initMouseEvent("click",!0,!0,r.view,1,s.screenX,s.screenY,s.clientX,s.clientY,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,0,null),u._fake=!0,o.dispatchEvent(u))},i.options.zoom?250:0)),i._resetPos(200),i.options.onTouchEnd&&i.options.onTouchEnd.call(i,r);return}if(c<300&&i.options.momentum){f=h?i._momentum(h-i.startX,c,-i.x,i.scrollerW-i.wrapperW+i.x,i.options.bounce?i.wrapperW:0):f,l=p?i._momentum(p-i.startY,c,-i.y,i.maxScrollY<0?i.scrollerH-i.wrapperH+i.y-i.minScrollY:0,i.options.bounce?i.wrapperH:0):l,h=i.x+f.dist,p=i.y+l.dist;if(i.x>0&&h>0||i.x<i.maxScrollX&&h<i.maxScrollX)f={dist:0,time:0};if(i.y>i.minScrollY&&p>i.minScrollY||i.y<i.maxScrollY&&p<i.maxScrollY)l={dist:0,time:0}}if(f.dist||l.dist){E=e.max(e.max(f.time,l.time),10),i.options.snap&&(d=h-i.absStartX,y=p-i.absStartY,e.abs(d)<i.options.snapThreshold&&e.abs(y)<i.options.snapThreshold?i.scrollTo(i.absStartX,i.absStartY,200):(S=i._snap(h,p),h=S.x,p=S.y,E=e.max(S.time,E))),i.scrollTo(t(h),t(p),E),i.options.onTouchEnd&&i.options.onTouchEnd.call(i,r);return}if(i.options.snap){d=h-i.absStartX,y=p-i.absStartY,e.abs(d)<i.options.snapThreshold&&e.abs(y)<i.options.snapThreshold?i.scrollTo(i.absStartX,i.absStartY,200):(S=i._snap(i.x,i.y),(S.x!=i.x||S.y!=i.y)&&i.scrollTo(S.x,S.y,S.time)),i.options.onTouchEnd&&i.options.onTouchEnd.call(i,r);return}i._resetPos(200),i.options.onTouchEnd&&i.options.onTouchEnd.call(i,r)},_resetPos:function(e){var t=this,r=t.x>=0?0:t.x<t.maxScrollX?t.maxScrollX:t.x,i=t.y>=t.minScrollY||t.maxScrollY>0?t.minScrollY:t.y<t.maxScrollY?t.maxScrollY:t.y;if(r==t.x&&i==t.y){t.moved&&(t.moved=!1,t.options.onScrollEnd&&t.options.onScrollEnd.call(t)),t.hScrollbar&&t.options.hideScrollbar&&(n=="webkit"&&(t.hScrollbarWrapper.style[n+"TransitionDelay"]="300ms"),t.hScrollbarWrapper.style.opacity="0"),t.vScrollbar&&t.options.hideScrollbar&&(n=="webkit"&&(t.vScrollbarWrapper.style[n+"TransitionDelay"]="300ms"),t.vScrollbarWrapper.style.opacity="0");return}t.scrollTo(r,i,e||0)},_wheel:function(e){var t=this,n,r,i,s,o;if("wheelDeltaX"in e)n=e.wheelDeltaX/12,r=e.wheelDeltaY/12;else if("wheelDelta"in e)n=r=e.wheelDelta/12;else{if(!("detail"in e))return;n=r=-e.detail*3}if(t.options.wheelAction=="zoom"){o=t.scale*Math.pow(2,1/3*(r?r/Math.abs(r):0)),o<t.options.zoomMin&&(o=t.options.zoomMin),o>t.options.zoomMax&&(o=t.options.zoomMax),o!=t.scale&&(!t.wheelZoomCount&&t.options.onZoomStart&&t.options.onZoomStart.call(t,e),t.wheelZoomCount++,t.zoom(e.pageX,e.pageY,o,400),setTimeout(function(){t.wheelZoomCount--,!t.wheelZoomCount&&t.options.onZoomEnd&&t.options.onZoomEnd.call(t,e)},400));return}i=t.x+n,s=t.y+r,i>0?i=0:i<t.maxScrollX&&(i=t.maxScrollX),s>t.minScrollY?s=t.minScrollY:s<t.maxScrollY&&(s=t.maxScrollY),t.scrollTo(i,s,0)},_mouseout:function(e){var t=e.relatedTarget;if(!t){this._end(e);return}while(t=t.parentNode)if(t==this.wrapper)return;this._end(e)},_transitionEnd:function(e){var t=this;if(e.target!=t.scroller)return;t._unbind("webkitTransitionEnd"),t._startAni()},_startAni:function(){var t=this,n=t.x,r=t.y,i=Date.now(),s,o,u;if(t.animating)return;if(!t.steps.length){t._resetPos(400);return}s=t.steps.shift(),s.x==n&&s.y==r&&(s.time=0),t.animating=!0,t.moved=!0;if(t.options.useTransition){t._transitionTime(s.time),t._pos(s.x,s.y),t.animating=!1,s.time?t._bind("webkitTransitionEnd"):t._resetPos(0);return}u=function(){var a=Date.now(),f,l;if(a>=i+s.time){t._pos(s.x,s.y),t.animating=!1,t.options.onAnimationEnd&&t.options.onAnimationEnd.call(t),t._startAni();return}a=(a-i)/s.time-1,o=e.sqrt(1-a*a),f=(s.x-n)*o+n,l=(s.y-r)*o+r,t._pos(f,l),t.animating&&(t.aniTime=c(u))},u()},_transitionTime:function(e){e+="ms",this.scroller.style[n+"TransitionDuration"]=e,this.hScrollbar&&(this.hScrollbarIndicator.style[n+"TransitionDuration"]=e),this.vScrollbar&&(this.vScrollbarIndicator.style[n+"TransitionDuration"]=e)},_momentum:function(n,r,i,s,o){var u=6e-4,a=e.abs(n)/r,f=a*a/(2*u),l=0,c=0;return n>0&&f>i?(c=o/(6/(f/a*u)),i+=c,a=a*i/f,f=i):n<0&&f>s&&(c=o/(6/(f/a*u)),s+=c,a=a*s/f,f=s),f*=n<0?-1:1,l=a/u,{dist:f,time:t(l)}},_offset:function(e){var t=-e.offsetLeft,n=-e.offsetTop;while(e=e.offsetParent)t-=e.offsetLeft,n-=e.offsetTop;return e!=this.wrapper&&(t*=this.scale,n*=this.scale),{left:t,top:n}},_snap:function(n,r){var i=this,s,o,u,a,f,l;u=i.pagesX.length-1;for(s=0,o=i.pagesX.length;s<o;s++)if(n>=i.pagesX[s]){u=s;break}u==i.currPageX&&u>0&&i.dirX<0&&u--,n=i.pagesX[u],f=e.abs(n-i.pagesX[i.currPageX]),f=f?e.abs(i.x-n)/f*500:0,i.currPageX=u,u=i.pagesY.length-1;for(s=0;s<u;s++)if(r>=i.pagesY[s]){u=s;break}return u==i.currPageY&&u>0&&i.dirY<0&&u--,r=i.pagesY[u],l=e.abs(r-i.pagesY[i.currPageY]),l=l?e.abs(i.y-r)/l*500:0,i.currPageY=u,a=t(e.max(f,l))||200,{x:n,y:r,time:a}},_bind:function(e,t,n){(t||this.scroller).addEventListener(e,this,!!n)},_unbind:function(e,t,n){(t||this.scroller).removeEventListener(e,this,!!n)},destroy:function(){var e=this;e.scroller.style[n+"Transform"]="",e.hScrollbar=!1,e.vScrollbar=!1,e._scrollbar("h"),e._scrollbar("v"),e._unbind(p,window),e._unbind(d),e._unbind(v),e._unbind(m),e._unbind(g),e.options.hasTouch||(e._unbind("mouseout",e.wrapper),e._unbind(y)),e.options.useTransition&&e._unbind("webkitTransitionEnd"),e.options.checkDOMChanges&&clearInterval(e.checkDOMTime),e.options.onDestroy&&e.options.onDestroy.call(e)},refresh:function(){var e=this,r,i,s,o,u=0,a=0;e.scale<e.options.zoomMin&&(e.scale=e.options.zoomMin),e.wrapperW=e.wrapper.clientWidth||1,e.wrapperH=e.wrapper.clientHeight||1,e.minScrollY=-e.options.topOffset||0,e.scrollerW=t(e.scroller.offsetWidth*e.scale),e.scrollerH=t((e.scroller.offsetHeight+e.minScrollY)*e.scale),e.maxScrollX=e.wrapperW-e.scrollerW,e.maxScrollY=e.wrapperH-e.scrollerH+e.minScrollY,e.dirX=0,e.dirY=0,e.options.onRefresh&&e.options.onRefresh.call(e),e.hScroll=e.options.hScroll&&e.maxScrollX<0,e.vScroll=e.options.vScroll&&(!e.options.bounceLock&&!e.hScroll||e.scrollerH>e.wrapperH),e.hScrollbar=e.hScroll&&e.options.hScrollbar,e.vScrollbar=e.vScroll&&e.options.vScrollbar&&e.scrollerH>e.wrapperH,r=e._offset(e.wrapper),e.wrapperOffsetLeft=-r.left,e.wrapperOffsetTop=-r.top;if(typeof e.options.snap=="string"){e.pagesX=[],e.pagesY=[],o=e.scroller.querySelectorAll(e.options.snap);for(i=0,s=o.length;i<s;i++)u=e._offset(o[i]),u.left+=e.wrapperOffsetLeft,u.top+=e.wrapperOffsetTop,e.pagesX[i]=u.left<e.maxScrollX?e.maxScrollX:u.left*e.scale,e.pagesY[i]=u.top<e.maxScrollY?e.maxScrollY:u.top*e.scale}else if(e.options.snap){e.pagesX=[];while(u>=e.maxScrollX)e.pagesX[a]=u,u-=e.wrapperW,a++;e.maxScrollX%e.wrapperW&&(e.pagesX[e.pagesX.length]=e.maxScrollX-e.pagesX[e.pagesX.length-1]+e.pagesX[e.pagesX.length-1]),u=0,a=0,e.pagesY=[];while(u>=e.maxScrollY)e.pagesY[a]=u,u-=e.wrapperH,a++;e.maxScrollY%e.wrapperH&&(e.pagesY[e.pagesY.length]=e.maxScrollY-e.pagesY[e.pagesY.length-1]+e.pagesY[e.pagesY.length-1])}e._scrollbar("h"),e._scrollbar("v"),e.zoomed||(e.scroller.style[n+"TransitionDuration"]="0",e._resetPos(200))},scrollTo:function(e,t,n,r){var i=this,s=e,o,u;i.stop(),s.length||(s=[{x:e,y:t,time:n,relative:r}]);for(o=0,u=s.length;o<u;o++)s[o].relative&&(s[o].x=i.x-s[o].x,s[o].y=i.y-s[o].y),i.steps.push({x:s[o].x,y:s[o].y,time:s[o].time||0});i._startAni()},scrollToElement:function(t,n){var r=this,i;t=t.nodeType?t:r.scroller.querySelector(t);if(!t)return;i=r._offset(t),i.left+=r.wrapperOffsetLeft,i.top+=r.wrapperOffsetTop,i.left=i.left>0?0:i.left<r.maxScrollX?r.maxScrollX:i.left,i.top=i.top>r.minScrollY?r.minScrollY:i.top<r.maxScrollY?r.maxScrollY:i.top,n=n===undefined?e.max(e.abs(i.left)*2,e.abs(i.top)*2):n,r.scrollTo(i.left,i.top,n)},scrollToPage:function(e,t,n){var r=this,i,s;n=n===undefined?400:n,r.options.onScrollStart&&r.options.onScrollStart.call(r),r.options.snap?(e=e=="next"?r.currPageX+1:e=="prev"?r.currPageX-1:e,t=t=="next"?r.currPageY+1:t=="prev"?r.currPageY-1:t,e=e<0?0:e>r.pagesX.length-1?r.pagesX.length-1:e,t=t<0?0:t>r.pagesY.length-1?r.pagesY.length-1:t,r.currPageX=e,r.currPageY=t,i=r.pagesX[e],s=r.pagesY[t]):(i=-r.wrapperW*e,s=-r.wrapperH*t,i<r.maxScrollX&&(i=r.maxScrollX),s<r.maxScrollY&&(s=r.maxScrollY)),r.scrollTo(i,s,n)},disable:function(){this.stop(),this._resetPos(0),this.enabled=!1,this._unbind(v),this._unbind(m),this._unbind(g)},enable:function(){this.enabled=!0},stop:function(){this.options.useTransition?this._unbind("webkitTransitionEnd"):h(this.aniTime),this.steps=[],this.moved=!1,this.animating=!1},zoom:function(e,t,r,i){var s=this,o=r/s.scale;if(!s.options.useTransform)return;s.zoomed=!0,i=i===undefined?200:i,e=e-s.wrapperOffsetLeft-s.x,t=t-s.wrapperOffsetTop-s.y,s.x=e-e*o+s.x,s.y=t-t*o+s.y,s.scale=r,s.refresh(),s.x=s.x>0?0:s.x<s.maxScrollX?s.maxScrollX:s.x,s.y=s.y>s.minScrollY?s.minScrollY:s.y<s.maxScrollY?s.maxScrollY:s.y,s.scroller.style[n+"TransitionDuration"]=i+"ms",s.scroller.style[n+"Transform"]=b+s.x+"px,"+s.y+"px"+w+" scale("+r+")",s.zoomed=!1},isReady:function(){return!this.moved&&!this.zoomed&&!this.animating}},typeof exports!="undefined"?exports.iScroll=E:window.iScroll=E})();